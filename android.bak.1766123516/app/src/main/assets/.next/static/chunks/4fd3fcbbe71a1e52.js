(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,78716,e=>{"use strict";let t=(0,e.i(75254).default)("video",[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5",key:"ftymec"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2",key:"158x01"}]]);e.s(["Video",()=>t],78716)},84762,e=>{"use strict";var t=e.i(43476),r=e.i(71645),a=e.i(47163);let i=r.forwardRef(({className:e,...r},i)=>(0,t.jsx)("textarea",{className:(0,a.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),ref:i,...r}));i.displayName="Textarea",e.s(["Textarea",()=>i])},86536,e=>{"use strict";let t=(0,e.i(75254).default)("eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);e.s(["Eye",()=>t],86536)},10708,e=>{"use strict";var t=e.i(43476),r=e.i(71645),a=e.i(48425),i=r.forwardRef((e,r)=>(0,t.jsx)(a.Primitive.label,{...e,ref:r,onMouseDown:t=>{t.target.closest("button, input, select, textarea")||(e.onMouseDown?.(t),!t.defaultPrevented&&t.detail>1&&t.preventDefault())}}));i.displayName="Label";var l=e.i(25913),s=e.i(47163);let o=(0,l.cva)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),n=r.forwardRef(({className:e,...r},a)=>(0,t.jsx)(i,{ref:a,className:(0,s.cn)(o(),e),...r}));n.displayName=i.displayName,e.s(["Label",()=>n],10708)},31278,e=>{"use strict";let t=(0,e.i(75254).default)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);e.s(["Loader2",()=>t],31278)},94179,e=>{"use strict";var t=e.i(43476),r=e.i(25913),a=e.i(47163);let i=(0,r.cva)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground",success:"border-transparent bg-green-500 text-white hover:bg-green-600",warning:"border-transparent bg-yellow-500 text-white hover:bg-yellow-600",info:"border-transparent bg-blue-500 text-white hover:bg-blue-600"}},defaultVariants:{variant:"default"}});function l({className:e,variant:r,...l}){return(0,t.jsx)("div",{className:(0,a.cn)(i({variant:r}),e),...l})}e.s(["Badge",()=>l])},7233,e=>{"use strict";let t=(0,e.i(75254).default)("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);e.s(["Plus",()=>t],7233)},30374,e=>{"use strict";var t=e.i(43476),r=e.i(71645),a=e.i(26999),i=e.i(37727),l=e.i(47163);let s=a.Root,o=a.Trigger,n=a.Portal;a.Close;let d=r.forwardRef(({className:e,...r},i)=>(0,t.jsx)(a.Overlay,{ref:i,className:(0,l.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...r}));d.displayName=a.Overlay.displayName;let c=r.forwardRef(({className:e,children:r,...s},o)=>(0,t.jsxs)(n,{children:[(0,t.jsx)(d,{}),(0,t.jsxs)(a.Content,{ref:o,className:(0,l.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...s,children:[r,(0,t.jsxs)(a.Close,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,t.jsx)(i.X,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"sr-only",children:"Close"})]})]})]}));c.displayName=a.Content.displayName;let u=({className:e,...r})=>(0,t.jsx)("div",{className:(0,l.cn)("flex flex-col space-y-1.5 text-center sm:text-left",e),...r});u.displayName="DialogHeader";let f=({className:e,...r})=>(0,t.jsx)("div",{className:(0,l.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...r});f.displayName="DialogFooter";let g=r.forwardRef(({className:e,...r},i)=>(0,t.jsx)(a.Title,{ref:i,className:(0,l.cn)("text-lg font-semibold leading-none tracking-tight",e),...r}));g.displayName=a.Title.displayName;let p=r.forwardRef(({className:e,...r},i)=>(0,t.jsx)(a.Description,{ref:i,className:(0,l.cn)("text-sm text-muted-foreground",e),...r}));p.displayName=a.Description.displayName,e.s(["Dialog",()=>s,"DialogContent",()=>c,"DialogDescription",()=>p,"DialogFooter",()=>f,"DialogHeader",()=>u,"DialogTitle",()=>g,"DialogTrigger",()=>o])},73297,e=>{"use strict";let t={video_production:{value:"video_production",label:"Video Production",description:"Full-service video production from concept to final delivery",icon:"ðŸŽ¬",color:"from-purple-500 to-pink-500",bgColor:"bg-purple-100 dark:bg-purple-900/20",textColor:"text-purple-700 dark:text-purple-300",borderColor:"border-purple-300 dark:border-purple-700"},social_media:{value:"social_media",label:"Social Media",description:"Social media management, content creation, and strategy",icon:"ðŸ“±",color:"from-blue-500 to-cyan-500",bgColor:"bg-blue-100 dark:bg-blue-900/20",textColor:"text-blue-700 dark:text-blue-300",borderColor:"border-blue-300 dark:border-blue-700"},design_branding:{value:"design_branding",label:"Design & Branding",description:"Brand identity, graphic design, and creative services",icon:"ðŸŽ¨",color:"from-orange-500 to-red-500",bgColor:"bg-orange-100 dark:bg-orange-900/20",textColor:"text-orange-700 dark:text-orange-300",borderColor:"border-orange-300 dark:border-orange-700"}},r=Object.values(t);e.s(["SERVICE_TYPES",0,t,"SERVICE_TYPE_OPTIONS",0,r])},12426,e=>{"use strict";let t=(0,e.i(75254).default)("dollar-sign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]);e.s(["DollarSign",()=>t],12426)},87316,3116,e=>{"use strict";var t=e.i(75254);let r=(0,t.default)("calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);e.s(["Calendar",()=>r],87316);let a=(0,t.default)("clock",[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);e.s(["Clock",()=>a],3116)},25652,e=>{"use strict";let t=(0,e.i(75254).default)("trending-up",[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]]);e.s(["TrendingUp",()=>t],25652)},78892,e=>{"use strict";var t=e.i(43476),r=e.i(94179);function a({status:e}){return(0,t.jsx)(r.Badge,{variant:(e=>{switch(e){case"completed":case"done":case"paid":case"active":return"success";case"in_progress":case"in_review":case"sent":return"info";case"planning":case"pending":case"draft":return"warning";case"stuck":case"blocked":case"cancelled":case"overdue":case"inactive":return"destructive";default:return"default"}})(e),children:e.split("_").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" ")})}e.s(["StatusBadge",()=>a])},87336,e=>{"use strict";var t=e.i(43476),r=e.i(71645),a=e.i(30030),i=e.i(48425),l="Progress",[s,o]=(0,a.createContextScope)(l),[n,d]=s(l),c=r.forwardRef((e,r)=>{var a,l;let{__scopeProgress:s,value:o=null,max:d,getValueLabel:c=g,...u}=e;(d||0===d)&&!h(d)&&console.error((a=`${d}`,`Invalid prop \`max\` of value \`${a}\` supplied to \`Progress\`. Only numbers greater than 0 are valid max values. Defaulting to \`100\`.`));let f=h(d)?d:100;null===o||x(o,f)||console.error((l=`${o}`,`Invalid prop \`value\` of value \`${l}\` supplied to \`Progress\`. The \`value\` prop must be:
  - a positive number
  - less than the value passed to \`max\` (or 100 if no \`max\` prop is set)
  - \`null\` or \`undefined\` if the progress is indeterminate.

Defaulting to \`null\`.`));let v=x(o,f)?o:null,y=m(v)?c(v,f):void 0;return(0,t.jsx)(n,{scope:s,value:v,max:f,children:(0,t.jsx)(i.Primitive.div,{"aria-valuemax":f,"aria-valuemin":0,"aria-valuenow":m(v)?v:void 0,"aria-valuetext":y,role:"progressbar","data-state":p(v,f),"data-value":v??void 0,"data-max":f,...u,ref:r})})});c.displayName=l;var u="ProgressIndicator",f=r.forwardRef((e,r)=>{let{__scopeProgress:a,...l}=e,s=d(u,a);return(0,t.jsx)(i.Primitive.div,{"data-state":p(s.value,s.max),"data-value":s.value??void 0,"data-max":s.max,...l,ref:r})});function g(e,t){return`${Math.round(e/t*100)}%`}function p(e,t){return null==e?"indeterminate":e===t?"complete":"loading"}function m(e){return"number"==typeof e}function h(e){return m(e)&&!isNaN(e)&&e>0}function x(e,t){return m(e)&&!isNaN(e)&&e<=t&&e>=0}f.displayName=u;var v=e.i(47163);let y=r.forwardRef(({className:e,value:r,...a},i)=>(0,t.jsx)(c,{ref:i,className:(0,v.cn)("relative h-4 w-full overflow-hidden rounded-full bg-secondary",e),...a,children:(0,t.jsx)(f,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(r||0)}%)`}})}));y.displayName=c.displayName,e.s(["Progress",()=>y],87336)},56272,e=>{"use strict";let t=(0,e.i(75254).default)("square-check-big",[["path",{d:"M21 10.656V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h12.344",key:"2acyp4"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);e.s(["CheckSquare",()=>t],56272)},39951,e=>{"use strict";let t=(0,e.i(75254).default)("list-todo",[["path",{d:"M13 5h8",key:"a7qcls"}],["path",{d:"M13 12h8",key:"h98zly"}],["path",{d:"M13 19h8",key:"c3s6r1"}],["path",{d:"m3 17 2 2 4-4",key:"1jhpwq"}],["rect",{x:"3",y:"4",width:"6",height:"6",rx:"1",key:"cif1o7"}]]);e.s(["ListTodo",()=>t],39951)},90197,e=>{"use strict";let t={pdf:0xa00000,image:5242880,document:0xa00000,video:0x3200000,other:0xa00000};function r(e){let t=e.split(".").pop()?.toLowerCase();return t?["jpg","jpeg","png","gif","webp","svg"].includes(t)?"image":["mp4","mov","avi","mkv","webm"].includes(t)?"video":["doc","docx","txt","rtf"].includes(t)?"document":["pdf"].includes(t)?"pdf":"other":"other"}function a(e){return t[e]||t.other}function i(e){if(0===e)return"0 Bytes";let t=Math.floor(Math.log(e)/Math.log(1024));return Math.round(e/Math.pow(1024,t)*100)/100+" "+["Bytes","KB","MB","GB"][t]}function l(e){let t=r(e.name),l=a(t);return e.size>l?{valid:!1,error:`File size exceeds ${i(l)} limit for ${t} files`}:{valid:!0}}function s(e){for(let t of[/\/file\/d\/([a-zA-Z0-9_-]+)/,/id=([a-zA-Z0-9_-]+)/,/\/folders\/([a-zA-Z0-9_-]+)/]){let r=e.match(t);if(r)return r[1]}return null}function o(e){let t=s(e);return t?`https://drive.google.com/file/d/${t}/preview`:null}e.s(["FILE_CATEGORIES",0,{pre_production:{label:"Pre-Production",description:"Scripts, storyboards, shot lists"},production:{label:"Production",description:"Raw footage, dailies, BTS"},post_production:{label:"Post-Production",description:"Edits, graphics, music"},deliverables:{label:"Deliverables",description:"Final exports, client versions"},other:{label:"Other",description:"Miscellaneous files"}},"FILE_SIZE_LIMITS",0,t,"extractGoogleDriveFileId",()=>s,"formatFileSize",()=>i,"getFileType",()=>r,"getGoogleDriveEmbedUrl",()=>o,"getSizeLimit",()=>a,"validateFileSize",()=>l])},73708,94008,e=>{"use strict";var t=e.i(75254);let r=(0,t.default)("image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);e.s(["Image",()=>r],73708);let a=(0,t.default)("file",[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}]]);e.s(["File",()=>a],94008)},69074,21345,e=>{"use strict";var t=e.i(75254);let r=(0,t.default)("upload",[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]]);e.s(["Upload",()=>r],69074);let a=(0,t.default)("link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]);e.s(["Link",()=>a],21345)},7855,e=>{"use strict";var t=e.i(43476),r=e.i(71645),a=e.i(70065),i=e.i(67881),l=e.i(23750),s=e.i(10708),o=e.i(84762),n=e.i(62870),d=e.i(30374),c=e.i(94179),u=e.i(69074),f=e.i(21345),g=e.i(78583),p=e.i(73708),m=e.i(78716),h=e.i(94008);let x=(0,e.i(75254).default)("external-link",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);var v=e.i(27612),y=e.i(31278),b=e.i(86536),j=e.i(20755),_=e.i(76686),w=e.i(90197),N=e.i(61668),k=e.i(95187),C=(0,k.createServerReference)("609ad8544995b5847b0ce8a82278134f0856ad1454",k.callServer,void 0,k.findSourceMapURL,"getSignedProjectFileUrl"),E=e.i(93812);function D({projectId:e,driveFolderUrl:k,onDriveFolderUpdate:D}){let{user:F}=(0,N.useAuth)(),[S,L]=(0,r.useState)([]),[A,M]=(0,r.useState)(!1),[R,I]=(0,r.useState)(!1),[T,z]=(0,r.useState)(!1),[P,U]=(0,r.useState)(!1),[B,G]=(0,r.useState)(!1),[O,q]=(0,r.useState)(!1),[V,$]=(0,r.useState)(!1),[H,K]=(0,r.useState)(k||""),[Y,Z]=(0,r.useState)(!1),[X,W]=(0,r.useState)(null),J=(0,r.useRef)(!1),Q=(0,r.useRef)(!1),ee=(0,r.useRef)(!1),et=(0,r.useRef)(null),er=(0,r.useRef)(!0),[ea,ei]=(0,r.useState)(null),[el,es]=(0,r.useState)("other"),[eo,en]=(0,r.useState)(""),[ed,ec]=(0,r.useState)(""),[eu,ef]=(0,r.useState)(""),[eg,ep]=(0,r.useState)("other"),[em,eh]=(0,r.useState)("");async function ex(){if(A||!er.current||!e)return;M(!0);let t=(0,j.createClient)();try{_.debug.log("FILE_MANAGER","Fetching files...",{projectId:e});let{data:r,error:a}=await t.from("project_files").select("*").eq("project_id",e).order("created_at",{ascending:!1});if(a)throw a;er.current&&(L(r||[]),_.debug.success("FILE_MANAGER","Files fetched",{count:r?.length}))}catch(e){console.error("Error fetching files:",e),_.debug.error("FILE_MANAGER","Error fetching files",{message:e?.message,code:e?.code})}finally{er.current&&M(!1)}}async function ev(){if(Q.current)return void _.debug.log("FILE_MANAGER","Upload already in progress, ignoring");if(!ea)return;let t=(0,w.validateFileSize)(ea);if(!t.valid)return void alert(t.error);if(S.length>=20)return void alert("Maximum 20 files/links per project. Please delete some files before adding more.");Q.current=!0,I(!0);let r=(0,j.createClient)();try{_.debug.log("FILE_MANAGER","Upload start",{projectId:e,name:ea.name,size:ea.size,category:el});let t=`${e}/${Date.now()}-${ea.name}`,{error:a}=await r.storage.from("project-files").upload(t,ea);if(a)throw a;let{data:{publicUrl:i}}=r.storage.from("project-files").getPublicUrl(t),{data:l,error:s}=await r.from("project_files").insert({project_id:e,file_name:ea.name,file_type:(0,w.getFileType)(ea.name),file_category:el,storage_type:"supabase",file_url:i,file_size:ea.size,description:eo,uploaded_by:F?.id}).select().single();if(s)throw s;l&&L(e=>[l,...e]),(0,E.logAuditEvent)({action:"upload",entityType:"file",entityId:l?.id,entityName:ea.name,status:"success",newValues:{file_name:ea.name,file_type:(0,w.getFileType)(ea.name),file_category:el,file_size:ea.size},details:{project_id:e,description:eo}}).catch(e=>console.warn("Failed to log audit event:",e)),G(!1),ei(null),en(""),es("other"),I(!1),_.debug.success("FILE_MANAGER","Upload saved, added to list, dialog closed")}catch(t){console.error("Error uploading file:",t),(0,E.logAuditEvent)({action:"upload",entityType:"file",entityName:ea.name,status:"error",errorMessage:t?.message,details:{project_id:e,file_size:ea.size}}).catch(e=>console.warn("Failed to log audit event:",e)),_.debug.error("FILE_MANAGER","Upload error",{message:t?.message,code:t?.code,details:t?.details,hint:t?.hint}),alert(t.message||"Failed to upload file")}finally{I(!1),Q.current=!1,_.debug.log("FILE_MANAGER","Upload end - flags reset")}}async function ey(){if(!er.current)return;if(J.current||T)return void console.log("[handleAddLink] BLOCKED: already submitting");let t=ed.trim(),r=eu.trim();if(!t||!r)return void alert("Please provide both URL and file name");if(S.length>=20)return void alert("Maximum 20 files/links per project. Please delete some files before adding more.");J.current=!0,z(!0);let a=(0,j.createClient)();try{if(console.log("[handleAddLink] âœ… Starting submission"),!e||!F?.id)throw Error("Missing projectId or userId");let{data:i,error:l}=await a.from("project_files").insert({project_id:e,file_name:r,file_type:(0,w.getFileType)(r),file_category:eg,storage_type:"google_drive",file_url:t,description:em,uploaded_by:F.id}).select().single();if(l)throw l;if(!i)throw Error("No data returned from insert");console.log("[handleAddLink] âœ… Link inserted successfully"),er.current&&(L(e=>e.some(e=>e.id===i.id)?e:[i,...e]),q(!1),ec(""),ef(""),eh(""),ep("other")),_.debug.success("FILE_MANAGER","Link added successfully")}catch(t){console.error("[handleAddLink] âŒ Error:",t.message);let e=t?.message?.includes("row-level security")?"You do not have permissions to add links.":t?.message||"Failed to add link";er.current&&alert(e),_.debug.error("FILE_MANAGER","Add link failed",{message:t?.message})}finally{er.current&&z(!1),J.current=!1,console.log("[handleAddLink] âœ… Submission complete, guards reset")}}async function eb(){if(ee.current)return void _.debug.log("FILE_MANAGER","Drive folder save already in progress, ignoring");let t=H.trim();if(!t)return;if(!t.includes("drive.google.com"))return void alert("Please provide a valid Google Drive URL");ee.current=!0;let r=(0,j.createClient)();U(!0);try{_.debug.log("FILE_MANAGER","Saving drive folder",{projectId:e,url:t});let{error:a}=await r.from("projects").update({drive_folder_url:t}).eq("id",e);if(a)throw a;_.debug.success("FILE_MANAGER","Drive folder saved successfully"),K(t),$(!1),D?.(t)}catch(e){console.error("Error updating drive folder:",e),_.debug.error("FILE_MANAGER","Drive folder save error",{message:e?.message,code:e?.code}),alert(e.message||"Failed to update drive folder")}finally{U(!1),ee.current=!1,_.debug.log("FILE_MANAGER","Drive folder save end - flags reset")}}async function ej(t,r,a){if(!confirm("Are you sure you want to delete this file?"))return;let i=(0,j.createClient)();try{if("supabase"===a){let e=r.split("/").slice(-2).join("/");await i.storage.from("project-files").remove([e])}let{error:l}=await i.from("project_files").delete().eq("id",t);if(l)throw l;(0,E.logAuditEvent)({action:"delete",entityType:"file",entityId:t,status:"success",details:{project_id:e,storage_type:a}}).catch(e=>console.warn("Failed to log audit event:",e)),ex()}catch(r){console.error("Error deleting file:",r),(0,E.logAuditEvent)({action:"delete",entityType:"file",entityId:t,status:"error",errorMessage:r?.message,details:{project_id:e,storage_type:a}}).catch(e=>console.warn("Failed to log audit event:",e)),alert(r.message||"Failed to delete file")}}function e_(e){try{let t=new URL(e),r=t.pathname.match(/\/file\/d\/([^/]+)/);if(r)return r[1];let a=t.searchParams.get("id");if(a)return a;let i=t.searchParams.get("id");if(i)return i}catch{}return null}(0,r.useEffect)(()=>()=>{er.current=!1,et.current&&et.current.abort()},[]),(0,r.useEffect)(()=>{e&&er.current&&ex()},[e]),(0,r.useEffect)(()=>{V||K(k||"")},[k,V]),(0,r.useEffect)(()=>{B||(ei(null),en(""),es("other"),I(!1),Q.current=!1)},[B]),(0,r.useEffect)(()=>{O?console.log("[FileManager] Link dialog opened"):(console.log("[FileManager] Link dialog closed - resetting form"),ec(""),ef(""),eh(""),ep("other"),z(!1),J.current=!1,_.debug.log("FILE_MANAGER","Add link dialog closed and form reset"))},[O]),(0,r.useEffect)(()=>{V||(K(k||""),U(!1),ee.current=!1)},[V,k]);let[ew,eN]=(0,r.useState)(null);async function ek(e){if(W(e),eN(null),Z(!0),"supabase"===e.storage_type){let t=await C(e.file_url);!t.error&&t.signedUrl?eN(t.signedUrl):eN(e.file_url)}else eN(e.file_url)}async function eC(e){if("supabase"===e.storage_type){let t=await C(e.file_url);if(t.error||!t.signedUrl)return void window.open(e.file_url,"_blank");window.open(t.signedUrl,"_blank")}else window.open(e.file_url,"_blank")}function eE({file:e}){let[a,i]=(0,r.useState)(!1),[l,s]=(0,r.useState)(null),o=null;return("image"===e.file_type?o="supabase"===e.storage_type?l??e.file_url:e.file_url:"video"===e.file_type&&"google_drive"===e.storage_type&&(o=function(e,t=120){let r=e_(e);return r?`https://drive.google.com/thumbnail?id=${r}&sz=w${t}`:null}(e.file_url,160)),(0,r.useEffect)(()=>{let t=!1;return async function(){if("image"===e.file_type&&"supabase"===e.storage_type){let r=await C(e.file_url,300);t||r.error||!r.signedUrl||s(r.signedUrl),!t&&r.error&&s(null)}}(),()=>{t=!0}},[e.file_url,e.file_type,e.storage_type]),!o||a)?(0,t.jsx)("div",{className:"flex items-center justify-center h-8 w-8 rounded bg-muted",children:function(e){switch(e){case"image":return(0,t.jsx)(p.Image,{className:"h-4 w-4"});case"video":return(0,t.jsx)(m.Video,{className:"h-4 w-4"});case"pdf":case"document":return(0,t.jsx)(g.FileText,{className:"h-4 w-4"});default:return(0,t.jsx)(h.File,{className:"h-4 w-4"})}}(e.file_type)}):(0,t.jsx)("img",{src:o,alt:e.file_name,className:"h-8 w-8 rounded object-cover",onError:()=>i(!0)})}let eD=S.reduce((e,t)=>(e[t.file_category]||(e[t.file_category]=[]),e[t.file_category].push(t),e),{});return(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)(a.Card,{children:[(0,t.jsx)(a.CardHeader,{children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(a.CardTitle,{className:"text-lg",children:"Google Drive Folder"}),(0,t.jsx)(a.CardDescription,{children:"Main project folder for large files"})]}),(0,t.jsxs)(i.Button,{variant:"outline",size:"sm",onClick:()=>$(!0),children:[k?"Update":"Add"," Folder"]})]})}),k&&(0,t.jsx)(a.CardContent,{children:(0,t.jsxs)("a",{href:k,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 text-blue-600 hover:underline",children:[(0,t.jsx)(x,{className:"h-4 w-4"}),"Open Drive Folder"]})})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsxs)(i.Button,{onClick:()=>{_.debug.log("FILE_MANAGER","Open upload dialog"),G(!0)},disabled:S.length>=20,children:[(0,t.jsx)(u.Upload,{className:"h-4 w-4 mr-2"}),"Upload File"]}),(0,t.jsxs)(i.Button,{onClick:()=>{J.current||Q.current||(_.debug.log("FILE_MANAGER","Open add link dialog"),q(!0))},disabled:S.length>=20||T||R,children:[(0,t.jsx)(f.Link,{className:"h-4 w-4 mr-2"}),"Add Drive Link"]})]}),(0,t.jsxs)("p",{className:`text-sm ${S.length>=20?"text-red-600 font-medium":"text-muted-foreground"}`,children:[S.length,"/20 files"]})]}),S.length>=20&&(0,t.jsx)("p",{className:"text-sm text-red-600",children:"Maximum file limit reached. Delete some files to add more."})]}),Object.entries(w.FILE_CATEGORIES).map(([e,r])=>{let l=eD[e]||[];return 0===l.length?null:(0,t.jsxs)(a.Card,{children:[(0,t.jsxs)(a.CardHeader,{children:[(0,t.jsx)(a.CardTitle,{className:"text-lg",children:r.label}),(0,t.jsx)(a.CardDescription,{children:r.description})]}),(0,t.jsx)(a.CardContent,{children:(0,t.jsx)("div",{className:"space-y-2",children:l.map(e=>(0,t.jsxs)("div",{className:"flex items-center justify-between p-3 rounded-lg border hover:bg-accent transition-colors",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 flex-1",children:[(0,t.jsx)(eE,{file:e}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)("p",{className:"font-medium truncate",children:e.file_name}),(0,t.jsxs)("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[(0,t.jsx)(c.Badge,{variant:"outline",className:"text-xs",children:"supabase"===e.storage_type?"Uploaded":"Drive Link"}),e.file_size&&(0,t.jsx)("span",{children:(0,w.formatFileSize)(e.file_size)})]}),e.description&&(0,t.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:e.description})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(i.Button,{variant:"ghost",size:"sm",onClick:()=>ek(e),children:(0,t.jsx)(b.Eye,{className:"h-4 w-4"})}),(0,t.jsx)(i.Button,{variant:"ghost",size:"sm",onClick:()=>eC(e),children:(0,t.jsx)(x,{className:"h-4 w-4"})}),(0,t.jsx)(i.Button,{variant:"ghost",size:"sm",onClick:()=>ej(e.id,e.file_url,e.storage_type),children:(0,t.jsx)(v.Trash2,{className:"h-4 w-4 text-destructive"})})]})]},e.id))})})]},e)}),0===S.length&&(0,t.jsx)(a.Card,{children:(0,t.jsxs)(a.CardContent,{className:"text-center py-12",children:[(0,t.jsx)(g.FileText,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4 opacity-50"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"No files uploaded yet"})]})}),(0,t.jsx)(d.Dialog,{open:B,onOpenChange:G,children:(0,t.jsx)(d.DialogContent,{children:(0,t.jsxs)("form",{onSubmit:e=>{e.preventDefault(),ev()},children:[(0,t.jsxs)(d.DialogHeader,{children:[(0,t.jsx)(d.DialogTitle,{children:"Upload File"}),(0,t.jsx)(d.DialogDescription,{children:"Upload documents, images, and small videos to Supabase storage"})]}),(0,t.jsxs)("div",{className:"space-y-4 py-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(s.Label,{children:"File"}),(0,t.jsx)(l.Input,{type:"file",onChange:e=>ei(e.target.files?.[0]||null),className:"mt-1",required:!0}),ea&&(0,t.jsxs)("p",{className:"text-xs text-muted-foreground mt-1",children:[(0,w.formatFileSize)(ea.size)," - Max: ",(0,w.formatFileSize)(0x3b9ac9ff*!!(0,w.validateFileSize)(ea).valid)]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(s.Label,{children:"Category"}),(0,t.jsxs)(n.Select,{value:el,onValueChange:e=>es(e),children:[(0,t.jsx)(n.SelectTrigger,{className:"mt-1",children:(0,t.jsx)(n.SelectValue,{})}),(0,t.jsx)(n.SelectContent,{children:Object.entries(w.FILE_CATEGORIES).map(([e,r])=>(0,t.jsx)(n.SelectItem,{value:e,children:r.label},e))})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(s.Label,{children:"Description (Optional)"}),(0,t.jsx)(o.Textarea,{value:eo,onChange:e=>en(e.target.value),className:"mt-1",placeholder:"Brief description"})]})]}),(0,t.jsxs)(d.DialogFooter,{children:[(0,t.jsx)(i.Button,{type:"button",variant:"outline",onClick:()=>G(!1),disabled:R,children:"Cancel"}),(0,t.jsxs)(i.Button,{type:"submit",disabled:!ea||R,children:[R&&(0,t.jsx)(y.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),R?"Uploading...":"Upload"]})]})]})})}),(0,t.jsx)(d.Dialog,{open:O,onOpenChange:e=>{!e&&J.current?console.log("[Dialog] BLOCKED: Cannot close while submitting"):q(e)},children:(0,t.jsx)(d.DialogContent,{children:(0,t.jsxs)("form",{onSubmit:e=>{e.preventDefault(),ey()},children:[(0,t.jsxs)(d.DialogHeader,{children:[(0,t.jsx)(d.DialogTitle,{children:"Add Google Drive Link"}),(0,t.jsx)(d.DialogDescription,{children:"Add a link to a file stored in Google Drive"})]}),(0,t.jsxs)("div",{className:"space-y-4 py-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(s.Label,{children:"File Name"}),(0,t.jsx)(l.Input,{value:eu,onChange:e=>ef(e.target.value),className:"mt-1",placeholder:"Final_Edit_v3.mp4",required:!0})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(s.Label,{children:"Google Drive URL"}),(0,t.jsx)(l.Input,{value:ed,onChange:e=>ec(e.target.value),className:"mt-1",placeholder:"https://drive.google.com/file/d/...",required:!0})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(s.Label,{children:"Category"}),(0,t.jsxs)(n.Select,{value:eg,onValueChange:e=>ep(e),children:[(0,t.jsx)(n.SelectTrigger,{className:"mt-1",children:(0,t.jsx)(n.SelectValue,{})}),(0,t.jsx)(n.SelectContent,{children:Object.entries(w.FILE_CATEGORIES).map(([e,r])=>(0,t.jsx)(n.SelectItem,{value:e,children:r.label},e))})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(s.Label,{children:"Description (Optional)"}),(0,t.jsx)(o.Textarea,{value:em,onChange:e=>eh(e.target.value),className:"mt-1",placeholder:"Brief description"})]})]}),(0,t.jsxs)(d.DialogFooter,{children:[(0,t.jsx)(i.Button,{type:"button",variant:"outline",onClick:()=>q(!1),disabled:T,children:"Cancel"}),(0,t.jsxs)(i.Button,{type:"submit",disabled:!ed.trim()||!eu.trim()||T,children:[T&&(0,t.jsx)(y.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),T?"Adding...":"Add Link"]})]})]})})}),(0,t.jsx)(d.Dialog,{open:V,onOpenChange:$,children:(0,t.jsx)(d.DialogContent,{children:(0,t.jsxs)("form",{onSubmit:e=>{e.preventDefault(),eb()},children:[(0,t.jsxs)(d.DialogHeader,{children:[(0,t.jsx)(d.DialogTitle,{children:"Set Google Drive Folder"}),(0,t.jsx)(d.DialogDescription,{children:"Add the main project folder URL from Google Drive"})]}),(0,t.jsxs)("div",{className:"py-4",children:[(0,t.jsx)(s.Label,{children:"Folder URL"}),(0,t.jsx)(l.Input,{value:H,onChange:e=>K(e.target.value),className:"mt-1",placeholder:"https://drive.google.com/drive/folders/...",required:!0})]}),(0,t.jsxs)(d.DialogFooter,{children:[(0,t.jsx)(i.Button,{type:"button",variant:"outline",onClick:()=>$(!1),disabled:P,children:"Cancel"}),(0,t.jsxs)(i.Button,{type:"submit",disabled:!H.trim()||!H.includes("drive.google.com")||P,children:[P&&(0,t.jsx)(y.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),P?"Saving...":"Save"]})]})]})})}),(0,t.jsx)(d.Dialog,{open:Y,onOpenChange:Z,children:(0,t.jsxs)(d.DialogContent,{className:"max-w-3xl",children:[(0,t.jsxs)(d.DialogHeader,{children:[(0,t.jsx)(d.DialogTitle,{children:"Preview"}),(0,t.jsx)(d.DialogDescription,{children:X?.file_name})]}),(0,t.jsx)("div",{className:"mt-2",children:X&&(()=>{let e=X.file_type,r=ew||X.file_url,a=X.storage_type;if("supabase"===a&&!ew)return(0,t.jsx)("div",{className:"text-sm text-muted-foreground p-6 text-center",children:"Generating secure preview link..."});if("image"===e)return(0,t.jsx)("img",{src:r,alt:X.file_name,className:"max-h-[70vh] w-auto mx-auto rounded"});if("video"===e){if("google_drive"===a){let e,a=(e=e_(r))?`https://drive.google.com/file/d/${e}/preview`:null;if(a)return(0,t.jsx)("iframe",{src:a,className:"w-full h-[70vh] rounded",allow:"autoplay",allowFullScreen:!0})}return(0,t.jsxs)("video",{controls:!0,className:"w-full max-h-[70vh] rounded",children:[(0,t.jsx)("source",{src:r}),"Your browser does not support the video tag."]})}return"pdf"===e||r.endsWith(".pdf")?(0,t.jsx)("iframe",{src:r,className:"w-full h-[70vh] rounded"}):(0,t.jsx)("div",{className:"text-center text-sm text-muted-foreground",children:"Preview not available. Use the open link to view the file."})})()}),(0,t.jsxs)(d.DialogFooter,{children:[(0,t.jsx)(i.Button,{variant:"outline",onClick:()=>Z(!1),children:"Close"}),X&&("supabase"===X.storage_type?(0,t.jsx)(i.Button,{onClick:()=>eC(X),children:"Open in new tab"}):(0,t.jsx)(i.Button,{asChild:!0,children:(0,t.jsx)("a",{href:X.file_url,target:"_blank",rel:"noopener noreferrer",children:"Open in new tab"})}))]})]})})]})}e.s(["FileManager",()=>D],7855)},90185,e=>{e.v(t=>Promise.all(["static/chunks/73afe6ffaa91f0a9.js"].map(t=>e.l(t))).then(()=>t(6169)))},86712,e=>{e.v(e=>Promise.resolve().then(()=>e(90197)))},90015,e=>{e.v(e=>Promise.resolve().then(()=>e(20755)))}]);