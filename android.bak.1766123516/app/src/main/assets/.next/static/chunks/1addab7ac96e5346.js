(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,63727,e=>{"use strict";let t=(0,e.i(75254).default)("briefcase",[["path",{d:"M16 20V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"jecpp"}],["rect",{width:"20",height:"14",x:"2",y:"6",rx:"2",key:"i6l2r4"}]]);e.s(["Briefcase",()=>t],63727)},95468,e=>{"use strict";let t=(0,e.i(75254).default)("circle-check",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);e.s(["CheckCircle2",()=>t],95468)},84762,e=>{"use strict";var t=e.i(43476),s=e.i(71645),a=e.i(47163);let r=s.forwardRef(({className:e,...s},r)=>(0,t.jsx)("textarea",{className:(0,a.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),ref:r,...s}));r.displayName="Textarea",e.s(["Textarea",()=>r])},86536,e=>{"use strict";let t=(0,e.i(75254).default)("eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);e.s(["Eye",()=>t],86536)},10708,e=>{"use strict";var t=e.i(43476),s=e.i(71645),a=e.i(48425),r=s.forwardRef((e,s)=>(0,t.jsx)(a.Primitive.label,{...e,ref:s,onMouseDown:t=>{t.target.closest("button, input, select, textarea")||(e.onMouseDown?.(t),!t.defaultPrevented&&t.detail>1&&t.preventDefault())}}));r.displayName="Label";var l=e.i(25913),i=e.i(47163);let n=(0,l.cva)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),d=s.forwardRef(({className:e,...s},a)=>(0,t.jsx)(r,{ref:a,className:(0,i.cn)(n(),e),...s}));d.displayName=r.displayName,e.s(["Label",()=>d],10708)},31278,e=>{"use strict";let t=(0,e.i(75254).default)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);e.s(["Loader2",()=>t],31278)},94179,e=>{"use strict";var t=e.i(43476),s=e.i(25913),a=e.i(47163);let r=(0,s.cva)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground",success:"border-transparent bg-green-500 text-white hover:bg-green-600",warning:"border-transparent bg-yellow-500 text-white hover:bg-yellow-600",info:"border-transparent bg-blue-500 text-white hover:bg-blue-600"}},defaultVariants:{variant:"default"}});function l({className:e,variant:s,...l}){return(0,t.jsx)("div",{className:(0,a.cn)(r({variant:s}),e),...l})}e.s(["Badge",()=>l])},7233,e=>{"use strict";let t=(0,e.i(75254).default)("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);e.s(["Plus",()=>t],7233)},30374,e=>{"use strict";var t=e.i(43476),s=e.i(71645),a=e.i(26999),r=e.i(37727),l=e.i(47163);let i=a.Root,n=a.Trigger,d=a.Portal;a.Close;let o=s.forwardRef(({className:e,...s},r)=>(0,t.jsx)(a.Overlay,{ref:r,className:(0,l.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...s}));o.displayName=a.Overlay.displayName;let c=s.forwardRef(({className:e,children:s,...i},n)=>(0,t.jsxs)(d,{children:[(0,t.jsx)(o,{}),(0,t.jsxs)(a.Content,{ref:n,className:(0,l.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...i,children:[s,(0,t.jsxs)(a.Close,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,t.jsx)(r.X,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"sr-only",children:"Close"})]})]})]}));c.displayName=a.Content.displayName;let u=({className:e,...s})=>(0,t.jsx)("div",{className:(0,l.cn)("flex flex-col space-y-1.5 text-center sm:text-left",e),...s});u.displayName="DialogHeader";let m=({className:e,...s})=>(0,t.jsx)("div",{className:(0,l.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...s});m.displayName="DialogFooter";let p=s.forwardRef(({className:e,...s},r)=>(0,t.jsx)(a.Title,{ref:r,className:(0,l.cn)("text-lg font-semibold leading-none tracking-tight",e),...s}));p.displayName=a.Title.displayName;let x=s.forwardRef(({className:e,...s},r)=>(0,t.jsx)(a.Description,{ref:r,className:(0,l.cn)("text-sm text-muted-foreground",e),...s}));x.displayName=a.Description.displayName,e.s(["Dialog",()=>i,"DialogContent",()=>c,"DialogDescription",()=>x,"DialogFooter",()=>m,"DialogHeader",()=>u,"DialogTitle",()=>p,"DialogTrigger",()=>n])},78894,e=>{"use strict";let t=(0,e.i(75254).default)("triangle-alert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);e.s(["AlertTriangle",()=>t],78894)},81518,e=>{"use strict";var t=e.i(43476),s=e.i(70065),a=e.i(25652);let r=(0,e.i(75254).default)("trending-down",[["path",{d:"M16 17h6v-6",key:"t6n2it"}],["path",{d:"m22 17-8.5-8.5-5 5L2 7",key:"x473p"}]]);var l=e.i(47163);function i({title:e,value:i,change:n,trend:d="neutral",icon:o,iconClassName:c}){return(0,t.jsxs)(s.Card,{children:[(0,t.jsxs)(s.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,t.jsx)(s.CardTitle,{className:"text-sm font-medium",children:e}),o&&(0,t.jsx)(o,{className:(0,l.cn)("h-4 w-4 text-muted-foreground",c)})]}),(0,t.jsxs)(s.CardContent,{children:[(0,t.jsx)("div",{className:"text-2xl font-bold",children:i}),n&&(0,t.jsxs)("div",{className:"flex items-center gap-1 text-xs",children:["up"===d&&(0,t.jsx)(a.TrendingUp,{className:"h-3 w-3 text-green-500"}),"down"===d&&(0,t.jsx)(r,{className:"h-3 w-3 text-red-500"}),(0,t.jsx)("span",{className:(0,l.cn)("up"===d&&"text-green-500","down"===d&&"text-red-500","neutral"===d&&"text-muted-foreground"),children:n}),(0,t.jsx)("span",{className:"text-muted-foreground",children:"from last period"})]})]})]})}e.s(["StatCard",()=>i],81518)},59208,e=>{"use strict";let t=(0,e.i(75254).default)("calendar-clock",[["path",{d:"M16 14v2.2l1.6 1",key:"fo4ql5"}],["path",{d:"M16 2v4",key:"4m81vk"}],["path",{d:"M21 7.5V6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h3.5",key:"1osxxc"}],["path",{d:"M3 10h5",key:"r794hk"}],["path",{d:"M8 2v4",key:"1cmpym"}],["circle",{cx:"16",cy:"16",r:"6",key:"qoo3c4"}]]);e.s(["CalendarClock",()=>t],59208)},87316,3116,e=>{"use strict";var t=e.i(75254);let s=(0,t.default)("calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);e.s(["Calendar",()=>s],87316);let a=(0,t.default)("clock",[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);e.s(["Clock",()=>a],3116)},25652,e=>{"use strict";let t=(0,e.i(75254).default)("trending-up",[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]]);e.s(["TrendingUp",()=>t],25652)},78892,e=>{"use strict";var t=e.i(43476),s=e.i(94179);function a({status:e}){return(0,t.jsx)(s.Badge,{variant:(e=>{switch(e){case"completed":case"done":case"paid":case"active":return"success";case"in_progress":case"in_review":case"sent":return"info";case"planning":case"pending":case"draft":return"warning";case"stuck":case"blocked":case"cancelled":case"overdue":case"inactive":return"destructive";default:return"default"}})(e),children:e.split("_").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" ")})}e.s(["StatusBadge",()=>a])},87336,e=>{"use strict";var t=e.i(43476),s=e.i(71645),a=e.i(30030),r=e.i(48425),l="Progress",[i,n]=(0,a.createContextScope)(l),[d,o]=i(l),c=s.forwardRef((e,s)=>{var a,l;let{__scopeProgress:i,value:n=null,max:o,getValueLabel:c=p,...u}=e;(o||0===o)&&!g(o)&&console.error((a=`${o}`,`Invalid prop \`max\` of value \`${a}\` supplied to \`Progress\`. Only numbers greater than 0 are valid max values. Defaulting to \`100\`.`));let m=g(o)?o:100;null===n||f(n,m)||console.error((l=`${n}`,`Invalid prop \`value\` of value \`${l}\` supplied to \`Progress\`. The \`value\` prop must be:
  - a positive number
  - less than the value passed to \`max\` (or 100 if no \`max\` prop is set)
  - \`null\` or \`undefined\` if the progress is indeterminate.

Defaulting to \`null\`.`));let j=f(n,m)?n:null,v=h(j)?c(j,m):void 0;return(0,t.jsx)(d,{scope:i,value:j,max:m,children:(0,t.jsx)(r.Primitive.div,{"aria-valuemax":m,"aria-valuemin":0,"aria-valuenow":h(j)?j:void 0,"aria-valuetext":v,role:"progressbar","data-state":x(j,m),"data-value":j??void 0,"data-max":m,...u,ref:s})})});c.displayName=l;var u="ProgressIndicator",m=s.forwardRef((e,s)=>{let{__scopeProgress:a,...l}=e,i=o(u,a);return(0,t.jsx)(r.Primitive.div,{"data-state":x(i.value,i.max),"data-value":i.value??void 0,"data-max":i.max,...l,ref:s})});function p(e,t){return`${Math.round(e/t*100)}%`}function x(e,t){return null==e?"indeterminate":e===t?"complete":"loading"}function h(e){return"number"==typeof e}function g(e){return h(e)&&!isNaN(e)&&e>0}function f(e,t){return h(e)&&!isNaN(e)&&e<=t&&e>=0}m.displayName=u;var j=e.i(47163);let v=s.forwardRef(({className:e,value:s,...a},r)=>(0,t.jsx)(c,{ref:r,className:(0,j.cn)("relative h-4 w-full overflow-hidden rounded-full bg-secondary",e),...a,children:(0,t.jsx)(m,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(s||0)}%)`}})}));v.displayName=c.displayName,e.s(["Progress",()=>v],87336)},39951,e=>{"use strict";let t=(0,e.i(75254).default)("list-todo",[["path",{d:"M13 5h8",key:"a7qcls"}],["path",{d:"M13 12h8",key:"h98zly"}],["path",{d:"M13 19h8",key:"c3s6r1"}],["path",{d:"m3 17 2 2 4-4",key:"1jhpwq"}],["rect",{x:"3",y:"4",width:"6",height:"6",rx:"1",key:"cif1o7"}]]);e.s(["ListTodo",()=>t],39951)},56272,e=>{"use strict";let t=(0,e.i(75254).default)("square-check-big",[["path",{d:"M21 10.656V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h12.344",key:"2acyp4"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);e.s(["CheckSquare",()=>t],56272)},90197,e=>{"use strict";let t={pdf:0xa00000,image:5242880,document:0xa00000,video:0x3200000,other:0xa00000};function s(e){let t=e.split(".").pop()?.toLowerCase();return t?["jpg","jpeg","png","gif","webp","svg"].includes(t)?"image":["mp4","mov","avi","mkv","webm"].includes(t)?"video":["doc","docx","txt","rtf"].includes(t)?"document":["pdf"].includes(t)?"pdf":"other":"other"}function a(e){return t[e]||t.other}function r(e){if(0===e)return"0 Bytes";let t=Math.floor(Math.log(e)/Math.log(1024));return Math.round(e/Math.pow(1024,t)*100)/100+" "+["Bytes","KB","MB","GB"][t]}function l(e){let t=s(e.name),l=a(t);return e.size>l?{valid:!1,error:`File size exceeds ${r(l)} limit for ${t} files`}:{valid:!0}}function i(e){for(let t of[/\/file\/d\/([a-zA-Z0-9_-]+)/,/id=([a-zA-Z0-9_-]+)/,/\/folders\/([a-zA-Z0-9_-]+)/]){let s=e.match(t);if(s)return s[1]}return null}function n(e){let t=i(e);return t?`https://drive.google.com/file/d/${t}/preview`:null}e.s(["FILE_CATEGORIES",0,{pre_production:{label:"Pre-Production",description:"Scripts, storyboards, shot lists"},production:{label:"Production",description:"Raw footage, dailies, BTS"},post_production:{label:"Post-Production",description:"Edits, graphics, music"},deliverables:{label:"Deliverables",description:"Final exports, client versions"},other:{label:"Other",description:"Miscellaneous files"}},"FILE_SIZE_LIMITS",0,t,"extractGoogleDriveFileId",()=>i,"formatFileSize",()=>r,"getFileType",()=>s,"getGoogleDriveEmbedUrl",()=>n,"getSizeLimit",()=>a,"validateFileSize",()=>l])},69074,21345,e=>{"use strict";var t=e.i(75254);let s=(0,t.default)("upload",[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]]);e.s(["Upload",()=>s],69074);let a=(0,t.default)("link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]);e.s(["Link",()=>a],21345)},73708,94008,e=>{"use strict";var t=e.i(75254);let s=(0,t.default)("image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);e.s(["Image",()=>s],73708);let a=(0,t.default)("file",[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}]]);e.s(["File",()=>a],94008)},7855,e=>{"use strict";var t=e.i(43476),s=e.i(71645),a=e.i(70065),r=e.i(67881),l=e.i(23750),i=e.i(10708),n=e.i(84762),d=e.i(62870),o=e.i(30374),c=e.i(94179),u=e.i(69074),m=e.i(21345),p=e.i(78583),x=e.i(73708),h=e.i(78716),g=e.i(94008);let f=(0,e.i(75254).default)("external-link",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);var j=e.i(27612),v=e.i(31278),y=e.i(86536),_=e.i(20755),N=e.i(76686),b=e.i(90197),w=e.i(61668),k=e.i(95187),C=(0,k.createServerReference)("609ad8544995b5847b0ce8a82278134f0856ad1454",k.callServer,void 0,k.findSourceMapURL,"getSignedProjectFileUrl"),S=e.i(93812);function D({projectId:e,driveFolderUrl:k,onDriveFolderUpdate:D}){let{user:T}=(0,w.useAuth)(),[M,L]=(0,s.useState)([]),[E,A]=(0,s.useState)(!1),[F,I]=(0,s.useState)(!1),[R,P]=(0,s.useState)(!1),[B,U]=(0,s.useState)(!1),[z,q]=(0,s.useState)(!1),[O,G]=(0,s.useState)(!1),[V,$]=(0,s.useState)(!1),[H,K]=(0,s.useState)(k||""),[Y,Z]=(0,s.useState)(!1),[W,X]=(0,s.useState)(null),J=(0,s.useRef)(!1),Q=(0,s.useRef)(!1),ee=(0,s.useRef)(!1),et=(0,s.useRef)(null),es=(0,s.useRef)(!0),[ea,er]=(0,s.useState)(null),[el,ei]=(0,s.useState)("other"),[en,ed]=(0,s.useState)(""),[eo,ec]=(0,s.useState)(""),[eu,em]=(0,s.useState)(""),[ep,ex]=(0,s.useState)("other"),[eh,eg]=(0,s.useState)("");async function ef(){if(E||!es.current||!e)return;A(!0);let t=(0,_.createClient)();try{N.debug.log("FILE_MANAGER","Fetching files...",{projectId:e});let{data:s,error:a}=await t.from("project_files").select("*").eq("project_id",e).order("created_at",{ascending:!1});if(a)throw a;es.current&&(L(s||[]),N.debug.success("FILE_MANAGER","Files fetched",{count:s?.length}))}catch(e){console.error("Error fetching files:",e),N.debug.error("FILE_MANAGER","Error fetching files",{message:e?.message,code:e?.code})}finally{es.current&&A(!1)}}async function ej(){if(Q.current)return void N.debug.log("FILE_MANAGER","Upload already in progress, ignoring");if(!ea)return;let t=(0,b.validateFileSize)(ea);if(!t.valid)return void alert(t.error);if(M.length>=20)return void alert("Maximum 20 files/links per project. Please delete some files before adding more.");Q.current=!0,I(!0);let s=(0,_.createClient)();try{N.debug.log("FILE_MANAGER","Upload start",{projectId:e,name:ea.name,size:ea.size,category:el});let t=`${e}/${Date.now()}-${ea.name}`,{error:a}=await s.storage.from("project-files").upload(t,ea);if(a)throw a;let{data:{publicUrl:r}}=s.storage.from("project-files").getPublicUrl(t),{data:l,error:i}=await s.from("project_files").insert({project_id:e,file_name:ea.name,file_type:(0,b.getFileType)(ea.name),file_category:el,storage_type:"supabase",file_url:r,file_size:ea.size,description:en,uploaded_by:T?.id}).select().single();if(i)throw i;l&&L(e=>[l,...e]),(0,S.logAuditEvent)({action:"upload",entityType:"file",entityId:l?.id,entityName:ea.name,status:"success",newValues:{file_name:ea.name,file_type:(0,b.getFileType)(ea.name),file_category:el,file_size:ea.size},details:{project_id:e,description:en}}).catch(e=>console.warn("Failed to log audit event:",e)),q(!1),er(null),ed(""),ei("other"),I(!1),N.debug.success("FILE_MANAGER","Upload saved, added to list, dialog closed")}catch(t){console.error("Error uploading file:",t),(0,S.logAuditEvent)({action:"upload",entityType:"file",entityName:ea.name,status:"error",errorMessage:t?.message,details:{project_id:e,file_size:ea.size}}).catch(e=>console.warn("Failed to log audit event:",e)),N.debug.error("FILE_MANAGER","Upload error",{message:t?.message,code:t?.code,details:t?.details,hint:t?.hint}),alert(t.message||"Failed to upload file")}finally{I(!1),Q.current=!1,N.debug.log("FILE_MANAGER","Upload end - flags reset")}}async function ev(){if(!es.current)return;if(J.current||R)return void console.log("[handleAddLink] BLOCKED: already submitting");let t=eo.trim(),s=eu.trim();if(!t||!s)return void alert("Please provide both URL and file name");if(M.length>=20)return void alert("Maximum 20 files/links per project. Please delete some files before adding more.");J.current=!0,P(!0);let a=(0,_.createClient)();try{if(console.log("[handleAddLink] âœ… Starting submission"),!e||!T?.id)throw Error("Missing projectId or userId");let{data:r,error:l}=await a.from("project_files").insert({project_id:e,file_name:s,file_type:(0,b.getFileType)(s),file_category:ep,storage_type:"google_drive",file_url:t,description:eh,uploaded_by:T.id}).select().single();if(l)throw l;if(!r)throw Error("No data returned from insert");console.log("[handleAddLink] âœ… Link inserted successfully"),es.current&&(L(e=>e.some(e=>e.id===r.id)?e:[r,...e]),G(!1),ec(""),em(""),eg(""),ex("other")),N.debug.success("FILE_MANAGER","Link added successfully")}catch(t){console.error("[handleAddLink] âŒ Error:",t.message);let e=t?.message?.includes("row-level security")?"You do not have permissions to add links.":t?.message||"Failed to add link";es.current&&alert(e),N.debug.error("FILE_MANAGER","Add link failed",{message:t?.message})}finally{es.current&&P(!1),J.current=!1,console.log("[handleAddLink] âœ… Submission complete, guards reset")}}async function ey(){if(ee.current)return void N.debug.log("FILE_MANAGER","Drive folder save already in progress, ignoring");let t=H.trim();if(!t)return;if(!t.includes("drive.google.com"))return void alert("Please provide a valid Google Drive URL");ee.current=!0;let s=(0,_.createClient)();U(!0);try{N.debug.log("FILE_MANAGER","Saving drive folder",{projectId:e,url:t});let{error:a}=await s.from("projects").update({drive_folder_url:t}).eq("id",e);if(a)throw a;N.debug.success("FILE_MANAGER","Drive folder saved successfully"),K(t),$(!1),D?.(t)}catch(e){console.error("Error updating drive folder:",e),N.debug.error("FILE_MANAGER","Drive folder save error",{message:e?.message,code:e?.code}),alert(e.message||"Failed to update drive folder")}finally{U(!1),ee.current=!1,N.debug.log("FILE_MANAGER","Drive folder save end - flags reset")}}async function e_(t,s,a){if(!confirm("Are you sure you want to delete this file?"))return;let r=(0,_.createClient)();try{if("supabase"===a){let e=s.split("/").slice(-2).join("/");await r.storage.from("project-files").remove([e])}let{error:l}=await r.from("project_files").delete().eq("id",t);if(l)throw l;(0,S.logAuditEvent)({action:"delete",entityType:"file",entityId:t,status:"success",details:{project_id:e,storage_type:a}}).catch(e=>console.warn("Failed to log audit event:",e)),ef()}catch(s){console.error("Error deleting file:",s),(0,S.logAuditEvent)({action:"delete",entityType:"file",entityId:t,status:"error",errorMessage:s?.message,details:{project_id:e,storage_type:a}}).catch(e=>console.warn("Failed to log audit event:",e)),alert(s.message||"Failed to delete file")}}function eN(e){try{let t=new URL(e),s=t.pathname.match(/\/file\/d\/([^/]+)/);if(s)return s[1];let a=t.searchParams.get("id");if(a)return a;let r=t.searchParams.get("id");if(r)return r}catch{}return null}(0,s.useEffect)(()=>()=>{es.current=!1,et.current&&et.current.abort()},[]),(0,s.useEffect)(()=>{e&&es.current&&ef()},[e]),(0,s.useEffect)(()=>{V||K(k||"")},[k,V]),(0,s.useEffect)(()=>{z||(er(null),ed(""),ei("other"),I(!1),Q.current=!1)},[z]),(0,s.useEffect)(()=>{O?console.log("[FileManager] Link dialog opened"):(console.log("[FileManager] Link dialog closed - resetting form"),ec(""),em(""),eg(""),ex("other"),P(!1),J.current=!1,N.debug.log("FILE_MANAGER","Add link dialog closed and form reset"))},[O]),(0,s.useEffect)(()=>{V||(K(k||""),U(!1),ee.current=!1)},[V,k]);let[eb,ew]=(0,s.useState)(null);async function ek(e){if(X(e),ew(null),Z(!0),"supabase"===e.storage_type){let t=await C(e.file_url);!t.error&&t.signedUrl?ew(t.signedUrl):ew(e.file_url)}else ew(e.file_url)}async function eC(e){if("supabase"===e.storage_type){let t=await C(e.file_url);if(t.error||!t.signedUrl)return void window.open(e.file_url,"_blank");window.open(t.signedUrl,"_blank")}else window.open(e.file_url,"_blank")}function eS({file:e}){let[a,r]=(0,s.useState)(!1),[l,i]=(0,s.useState)(null),n=null;return("image"===e.file_type?n="supabase"===e.storage_type?l??e.file_url:e.file_url:"video"===e.file_type&&"google_drive"===e.storage_type&&(n=function(e,t=120){let s=eN(e);return s?`https://drive.google.com/thumbnail?id=${s}&sz=w${t}`:null}(e.file_url,160)),(0,s.useEffect)(()=>{let t=!1;return async function(){if("image"===e.file_type&&"supabase"===e.storage_type){let s=await C(e.file_url,300);t||s.error||!s.signedUrl||i(s.signedUrl),!t&&s.error&&i(null)}}(),()=>{t=!0}},[e.file_url,e.file_type,e.storage_type]),!n||a)?(0,t.jsx)("div",{className:"flex items-center justify-center h-8 w-8 rounded bg-muted",children:function(e){switch(e){case"image":return(0,t.jsx)(x.Image,{className:"h-4 w-4"});case"video":return(0,t.jsx)(h.Video,{className:"h-4 w-4"});case"pdf":case"document":return(0,t.jsx)(p.FileText,{className:"h-4 w-4"});default:return(0,t.jsx)(g.File,{className:"h-4 w-4"})}}(e.file_type)}):(0,t.jsx)("img",{src:n,alt:e.file_name,className:"h-8 w-8 rounded object-cover",onError:()=>r(!0)})}let eD=M.reduce((e,t)=>(e[t.file_category]||(e[t.file_category]=[]),e[t.file_category].push(t),e),{});return(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)(a.Card,{children:[(0,t.jsx)(a.CardHeader,{children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(a.CardTitle,{className:"text-lg",children:"Google Drive Folder"}),(0,t.jsx)(a.CardDescription,{children:"Main project folder for large files"})]}),(0,t.jsxs)(r.Button,{variant:"outline",size:"sm",onClick:()=>$(!0),children:[k?"Update":"Add"," Folder"]})]})}),k&&(0,t.jsx)(a.CardContent,{children:(0,t.jsxs)("a",{href:k,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 text-blue-600 hover:underline",children:[(0,t.jsx)(f,{className:"h-4 w-4"}),"Open Drive Folder"]})})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsxs)(r.Button,{onClick:()=>{N.debug.log("FILE_MANAGER","Open upload dialog"),q(!0)},disabled:M.length>=20,children:[(0,t.jsx)(u.Upload,{className:"h-4 w-4 mr-2"}),"Upload File"]}),(0,t.jsxs)(r.Button,{onClick:()=>{J.current||Q.current||(N.debug.log("FILE_MANAGER","Open add link dialog"),G(!0))},disabled:M.length>=20||R||F,children:[(0,t.jsx)(m.Link,{className:"h-4 w-4 mr-2"}),"Add Drive Link"]})]}),(0,t.jsxs)("p",{className:`text-sm ${M.length>=20?"text-red-600 font-medium":"text-muted-foreground"}`,children:[M.length,"/20 files"]})]}),M.length>=20&&(0,t.jsx)("p",{className:"text-sm text-red-600",children:"Maximum file limit reached. Delete some files to add more."})]}),Object.entries(b.FILE_CATEGORIES).map(([e,s])=>{let l=eD[e]||[];return 0===l.length?null:(0,t.jsxs)(a.Card,{children:[(0,t.jsxs)(a.CardHeader,{children:[(0,t.jsx)(a.CardTitle,{className:"text-lg",children:s.label}),(0,t.jsx)(a.CardDescription,{children:s.description})]}),(0,t.jsx)(a.CardContent,{children:(0,t.jsx)("div",{className:"space-y-2",children:l.map(e=>(0,t.jsxs)("div",{className:"flex items-center justify-between p-3 rounded-lg border hover:bg-accent transition-colors",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 flex-1",children:[(0,t.jsx)(eS,{file:e}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)("p",{className:"font-medium truncate",children:e.file_name}),(0,t.jsxs)("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[(0,t.jsx)(c.Badge,{variant:"outline",className:"text-xs",children:"supabase"===e.storage_type?"Uploaded":"Drive Link"}),e.file_size&&(0,t.jsx)("span",{children:(0,b.formatFileSize)(e.file_size)})]}),e.description&&(0,t.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:e.description})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(r.Button,{variant:"ghost",size:"sm",onClick:()=>ek(e),children:(0,t.jsx)(y.Eye,{className:"h-4 w-4"})}),(0,t.jsx)(r.Button,{variant:"ghost",size:"sm",onClick:()=>eC(e),children:(0,t.jsx)(f,{className:"h-4 w-4"})}),(0,t.jsx)(r.Button,{variant:"ghost",size:"sm",onClick:()=>e_(e.id,e.file_url,e.storage_type),children:(0,t.jsx)(j.Trash2,{className:"h-4 w-4 text-destructive"})})]})]},e.id))})})]},e)}),0===M.length&&(0,t.jsx)(a.Card,{children:(0,t.jsxs)(a.CardContent,{className:"text-center py-12",children:[(0,t.jsx)(p.FileText,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4 opacity-50"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"No files uploaded yet"})]})}),(0,t.jsx)(o.Dialog,{open:z,onOpenChange:q,children:(0,t.jsx)(o.DialogContent,{children:(0,t.jsxs)("form",{onSubmit:e=>{e.preventDefault(),ej()},children:[(0,t.jsxs)(o.DialogHeader,{children:[(0,t.jsx)(o.DialogTitle,{children:"Upload File"}),(0,t.jsx)(o.DialogDescription,{children:"Upload documents, images, and small videos to Supabase storage"})]}),(0,t.jsxs)("div",{className:"space-y-4 py-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(i.Label,{children:"File"}),(0,t.jsx)(l.Input,{type:"file",onChange:e=>er(e.target.files?.[0]||null),className:"mt-1",required:!0}),ea&&(0,t.jsxs)("p",{className:"text-xs text-muted-foreground mt-1",children:[(0,b.formatFileSize)(ea.size)," - Max: ",(0,b.formatFileSize)(0x3b9ac9ff*!!(0,b.validateFileSize)(ea).valid)]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(i.Label,{children:"Category"}),(0,t.jsxs)(d.Select,{value:el,onValueChange:e=>ei(e),children:[(0,t.jsx)(d.SelectTrigger,{className:"mt-1",children:(0,t.jsx)(d.SelectValue,{})}),(0,t.jsx)(d.SelectContent,{children:Object.entries(b.FILE_CATEGORIES).map(([e,s])=>(0,t.jsx)(d.SelectItem,{value:e,children:s.label},e))})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(i.Label,{children:"Description (Optional)"}),(0,t.jsx)(n.Textarea,{value:en,onChange:e=>ed(e.target.value),className:"mt-1",placeholder:"Brief description"})]})]}),(0,t.jsxs)(o.DialogFooter,{children:[(0,t.jsx)(r.Button,{type:"button",variant:"outline",onClick:()=>q(!1),disabled:F,children:"Cancel"}),(0,t.jsxs)(r.Button,{type:"submit",disabled:!ea||F,children:[F&&(0,t.jsx)(v.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),F?"Uploading...":"Upload"]})]})]})})}),(0,t.jsx)(o.Dialog,{open:O,onOpenChange:e=>{!e&&J.current?console.log("[Dialog] BLOCKED: Cannot close while submitting"):G(e)},children:(0,t.jsx)(o.DialogContent,{children:(0,t.jsxs)("form",{onSubmit:e=>{e.preventDefault(),ev()},children:[(0,t.jsxs)(o.DialogHeader,{children:[(0,t.jsx)(o.DialogTitle,{children:"Add Google Drive Link"}),(0,t.jsx)(o.DialogDescription,{children:"Add a link to a file stored in Google Drive"})]}),(0,t.jsxs)("div",{className:"space-y-4 py-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(i.Label,{children:"File Name"}),(0,t.jsx)(l.Input,{value:eu,onChange:e=>em(e.target.value),className:"mt-1",placeholder:"Final_Edit_v3.mp4",required:!0})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(i.Label,{children:"Google Drive URL"}),(0,t.jsx)(l.Input,{value:eo,onChange:e=>ec(e.target.value),className:"mt-1",placeholder:"https://drive.google.com/file/d/...",required:!0})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(i.Label,{children:"Category"}),(0,t.jsxs)(d.Select,{value:ep,onValueChange:e=>ex(e),children:[(0,t.jsx)(d.SelectTrigger,{className:"mt-1",children:(0,t.jsx)(d.SelectValue,{})}),(0,t.jsx)(d.SelectContent,{children:Object.entries(b.FILE_CATEGORIES).map(([e,s])=>(0,t.jsx)(d.SelectItem,{value:e,children:s.label},e))})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(i.Label,{children:"Description (Optional)"}),(0,t.jsx)(n.Textarea,{value:eh,onChange:e=>eg(e.target.value),className:"mt-1",placeholder:"Brief description"})]})]}),(0,t.jsxs)(o.DialogFooter,{children:[(0,t.jsx)(r.Button,{type:"button",variant:"outline",onClick:()=>G(!1),disabled:R,children:"Cancel"}),(0,t.jsxs)(r.Button,{type:"submit",disabled:!eo.trim()||!eu.trim()||R,children:[R&&(0,t.jsx)(v.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),R?"Adding...":"Add Link"]})]})]})})}),(0,t.jsx)(o.Dialog,{open:V,onOpenChange:$,children:(0,t.jsx)(o.DialogContent,{children:(0,t.jsxs)("form",{onSubmit:e=>{e.preventDefault(),ey()},children:[(0,t.jsxs)(o.DialogHeader,{children:[(0,t.jsx)(o.DialogTitle,{children:"Set Google Drive Folder"}),(0,t.jsx)(o.DialogDescription,{children:"Add the main project folder URL from Google Drive"})]}),(0,t.jsxs)("div",{className:"py-4",children:[(0,t.jsx)(i.Label,{children:"Folder URL"}),(0,t.jsx)(l.Input,{value:H,onChange:e=>K(e.target.value),className:"mt-1",placeholder:"https://drive.google.com/drive/folders/...",required:!0})]}),(0,t.jsxs)(o.DialogFooter,{children:[(0,t.jsx)(r.Button,{type:"button",variant:"outline",onClick:()=>$(!1),disabled:B,children:"Cancel"}),(0,t.jsxs)(r.Button,{type:"submit",disabled:!H.trim()||!H.includes("drive.google.com")||B,children:[B&&(0,t.jsx)(v.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),B?"Saving...":"Save"]})]})]})})}),(0,t.jsx)(o.Dialog,{open:Y,onOpenChange:Z,children:(0,t.jsxs)(o.DialogContent,{className:"max-w-3xl",children:[(0,t.jsxs)(o.DialogHeader,{children:[(0,t.jsx)(o.DialogTitle,{children:"Preview"}),(0,t.jsx)(o.DialogDescription,{children:W?.file_name})]}),(0,t.jsx)("div",{className:"mt-2",children:W&&(()=>{let e=W.file_type,s=eb||W.file_url,a=W.storage_type;if("supabase"===a&&!eb)return(0,t.jsx)("div",{className:"text-sm text-muted-foreground p-6 text-center",children:"Generating secure preview link..."});if("image"===e)return(0,t.jsx)("img",{src:s,alt:W.file_name,className:"max-h-[70vh] w-auto mx-auto rounded"});if("video"===e){if("google_drive"===a){let e,a=(e=eN(s))?`https://drive.google.com/file/d/${e}/preview`:null;if(a)return(0,t.jsx)("iframe",{src:a,className:"w-full h-[70vh] rounded",allow:"autoplay",allowFullScreen:!0})}return(0,t.jsxs)("video",{controls:!0,className:"w-full max-h-[70vh] rounded",children:[(0,t.jsx)("source",{src:s}),"Your browser does not support the video tag."]})}return"pdf"===e||s.endsWith(".pdf")?(0,t.jsx)("iframe",{src:s,className:"w-full h-[70vh] rounded"}):(0,t.jsx)("div",{className:"text-center text-sm text-muted-foreground",children:"Preview not available. Use the open link to view the file."})})()}),(0,t.jsxs)(o.DialogFooter,{children:[(0,t.jsx)(r.Button,{variant:"outline",onClick:()=>Z(!1),children:"Close"}),W&&("supabase"===W.storage_type?(0,t.jsx)(r.Button,{onClick:()=>eC(W),children:"Open in new tab"}):(0,t.jsx)(r.Button,{asChild:!0,children:(0,t.jsx)("a",{href:W.file_url,target:"_blank",rel:"noopener noreferrer",children:"Open in new tab"})}))]})]})})]})}e.s(["FileManager",()=>D],7855)},71923,e=>{"use strict";var t=e.i(43476),s=e.i(61668),a=e.i(71645),r=e.i(18566),l=e.i(81518),i=e.i(70065),n=e.i(94179),d=e.i(67881),o=e.i(87336),c=e.i(30374),u=e.i(62870),m=e.i(23750),p=e.i(84762),x=e.i(10708),h=e.i(7233),g=e.i(95468),f=e.i(14683),j=e.i(63209),v=e.i(27612),y=e.i(95187),_=(0,y.createServerReference)("407077dfde7a116ae486d76ab40cd50a1dba0a0bf7",y.callServer,void 0,y.findSourceMapURL,"createTask"),N=(0,y.createServerReference)("609962e915a2b373a08c0bbbfedde9f0e153e565b9",y.callServer,void 0,y.findSourceMapURL,"updateTask"),b=(0,y.createServerReference)("405aa6ef311de4fc1dcf524a8ec77eb1514a4cd5e6",y.callServer,void 0,y.findSourceMapURL,"deleteTask"),w=(0,y.createServerReference)("00572e83ec2be9ea7f5328beb33ed7049696a51b55",y.callServer,void 0,y.findSourceMapURL,"getTodayTasks"),k=(0,y.createServerReference)("002677cfdd008f5d83d9c5f60a6f9cdb9be67678b3",y.callServer,void 0,y.findSourceMapURL,"getOverdueTasks"),C=e.i(20755);let S={low:"bg-blue-100 text-blue-800",medium:"bg-yellow-100 text-yellow-800",high:"bg-orange-100 text-orange-800",urgent:"bg-red-100 text-red-800"},D={todo:f.Circle,in_progress:j.AlertCircle,completed:g.CheckCircle2,blocked:j.AlertCircle,cancelled:f.Circle};function T(){let[e,s]=(0,a.useState)([]),[r,l]=(0,a.useState)([]),[o,g]=(0,a.useState)(!0),[j,y]=(0,a.useState)(!1),[T,M]=(0,a.useState)([]),[L,E]=(0,a.useState)(!1),[A,F]=(0,a.useState)(null),[I,R]=(0,a.useState)({title:"",description:"",priority:"medium",due_date:"",project_id:"",proposed_project_name:"",proposed_project_vertical:""}),[P,B]=(0,a.useState)(!1);async function U(){E(!0);let e=(0,C.createClient)();try{let[{data:t},{data:s}]=await Promise.all([e.from("projects").select("id, name").order("created_at",{ascending:!1}).limit(50),e.from("project_team").select("projects(id, name)").limit(50)]),a=[],r=e=>{e&&!a.find(t=>t.id===e.id)&&a.push({id:e.id,name:e.name})},l=Array.isArray(t)?t:[],i=(Array.isArray(s)?s:[]).map(e=>e.projects).filter(Boolean);l.forEach(r),i.forEach(r),M(a)}catch(e){console.error("loadProjects error",e)}finally{E(!1)}}async function z(){g(!0);let[e,t]=await Promise.all([w(),k()]);console.log("[TaskManager] Today tasks response:",e),console.log("[TaskManager] Overdue tasks response:",t),e.data&&(console.log("[TaskManager] Tasks with proposals:",e.data.filter(e=>e.proposed_project_name)),console.log("[TaskManager] Setting tasks state with:",e.data),s(e.data)),t.data&&(console.log("[TaskManager] Setting overdue tasks state with:",t.data),l(t.data)),g(!1)}async function q(e){e.preventDefault();let t={title:I.title,description:I.description,priority:I.priority,due_date:I.due_date,project_id:I.project_id||void 0,proposed_project_name:P?I.proposed_project_name:void 0,proposed_project_vertical:I.proposed_project_vertical||void 0},s=await _(t);s.error?alert(s.error):(y(!1),R({title:"",description:"",priority:"medium",due_date:"",project_id:"",proposed_project_name:"",proposed_project_vertical:""}),B(!1),await z())}async function O(e){let t="completed"===e.status?"todo":"completed",s=await N(e.id,{status:t});s.error?alert(s.error):await z()}async function G(e){if(confirm("Delete this task?")){F(e),console.log("[handleDeleteTask] ðŸ”µ START - Deleting task:",e);try{let t=await b(e);console.log("[handleDeleteTask] Result:",t),t.error?(console.error("[handleDeleteTask] âŒ Error:",t.error),alert("Failed to delete task: "+t.error)):(console.log("[handleDeleteTask] âœ… Task deleted, reloading..."),await z(),console.log("[handleDeleteTask] âœ… Tasks reloaded"))}catch(e){console.error("[handleDeleteTask] âŒ Exception:",e),alert("Error deleting task: "+String(e))}finally{F(null)}}}if((0,a.useEffect)(()=>{console.log("[TaskManager] Component mounted, loading tasks..."),z(),U()},[]),(0,a.useEffect)(()=>{console.log("[TaskManager] Tasks state changed:",e),console.log("[TaskManager] Overdue tasks state changed:",r)},[e,r]),o)return(0,t.jsx)(i.Card,{children:(0,t.jsx)(i.CardContent,{className:"pt-6",children:(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Loading tasks..."})})});let V=[...r,...e];return(0,t.jsxs)(i.Card,{children:[(0,t.jsxs)(i.CardHeader,{className:"relative",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(i.CardTitle,{children:"My Tasks"}),(0,t.jsx)(i.CardDescription,{children:"Today's priorities and overdue items"})]}),(0,t.jsxs)(c.Dialog,{open:j,onOpenChange:y,children:[(0,t.jsx)(c.DialogTrigger,{asChild:!0,children:(0,t.jsxs)(d.Button,{size:"sm",className:"absolute top-4 right-4",children:[(0,t.jsx)(h.Plus,{className:"h-4 w-4 mr-2"}),"Add Task"]})}),(0,t.jsxs)(c.DialogContent,{children:[(0,t.jsxs)(c.DialogHeader,{children:[(0,t.jsx)(c.DialogTitle,{children:"Create New Task"}),(0,t.jsx)(c.DialogDescription,{children:"Add a new task to your list. You can propose a new project if needed."})]}),(0,t.jsxs)("form",{onSubmit:q,className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(x.Label,{htmlFor:"title",children:"Task Title"}),(0,t.jsx)(m.Input,{id:"title",value:I.title,onChange:e=>R({...I,title:e.target.value}),required:!0})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(x.Label,{htmlFor:"description",children:"Description"}),(0,t.jsx)(p.Textarea,{id:"description",value:I.description,onChange:e=>R({...I,description:e.target.value}),rows:3})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(x.Label,{htmlFor:"priority",children:"Priority"}),(0,t.jsxs)(u.Select,{value:I.priority,onValueChange:e=>R({...I,priority:e}),children:[(0,t.jsx)(u.SelectTrigger,{children:(0,t.jsx)(u.SelectValue,{})}),(0,t.jsxs)(u.SelectContent,{children:[(0,t.jsx)(u.SelectItem,{value:"low",children:"Low"}),(0,t.jsx)(u.SelectItem,{value:"medium",children:"Medium"}),(0,t.jsx)(u.SelectItem,{value:"high",children:"High"}),(0,t.jsx)(u.SelectItem,{value:"urgent",children:"Urgent"})]})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(x.Label,{htmlFor:"due_date",children:"Due Date"}),(0,t.jsx)(m.Input,{id:"due_date",type:"date",value:I.due_date,onChange:e=>R({...I,due_date:e.target.value})})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(x.Label,{children:"Project"}),(0,t.jsxs)(u.Select,{value:P?"propose_new":I.project_id||"",onValueChange:e=>{"propose_new"===e?(B(!0),R({...I,project_id:"",proposed_project_name:""})):(B(!1),R({...I,project_id:e,proposed_project_name:""}))},disabled:L,children:[(0,t.jsx)(u.SelectTrigger,{children:(0,t.jsx)(u.SelectValue,{placeholder:L?"Loading projects...":"Select project"})}),(0,t.jsxs)(u.SelectContent,{children:[T.map(e=>(0,t.jsx)(u.SelectItem,{value:e.id,children:e.name},e.id)),(0,t.jsx)(u.SelectItem,{value:"propose_new",children:"+ Propose new project"})]})]}),P&&(0,t.jsxs)("div",{className:"mt-2 space-y-2",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(x.Label,{htmlFor:"proposed_project_name",children:"Proposed Project Name"}),(0,t.jsx)(m.Input,{id:"proposed_project_name",value:I.proposed_project_name,onChange:e=>R({...I,proposed_project_name:e.target.value}),placeholder:"e.g., New Client Campaign",required:!0})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(x.Label,{htmlFor:"proposed_project_vertical",children:"Vertical"}),(0,t.jsxs)(u.Select,{value:I.proposed_project_vertical,onValueChange:e=>R({...I,proposed_project_vertical:e}),children:[(0,t.jsx)(u.SelectTrigger,{id:"proposed_project_vertical",children:(0,t.jsx)(u.SelectValue,{placeholder:"Select vertical"})}),(0,t.jsxs)(u.SelectContent,{children:[(0,t.jsx)(u.SelectItem,{value:"video_production",children:"ðŸŽ¬ Video Production"}),(0,t.jsx)(u.SelectItem,{value:"social_media",children:"ðŸ“± Social Media"}),(0,t.jsx)(u.SelectItem,{value:"design_branding",children:"ðŸŽ¨ Design & Branding"})]})]})]})]})]}),(0,t.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,t.jsx)(d.Button,{type:"button",variant:"outline",onClick:()=>y(!1),children:"Cancel"}),(0,t.jsx)(d.Button,{type:"submit",children:"Create Task"})]})]})]})]})]}),(0,t.jsx)(i.CardContent,{children:0===V.length?(0,t.jsx)("p",{className:"text-sm text-muted-foreground text-center py-8",children:"No tasks for today. Create one to get started!"}):(0,t.jsx)("div",{className:"space-y-3",children:V.map(e=>{let s=D[e.status]||f.Circle,a=e.due_date&&new Date(e.due_date)<new Date&&"completed"!==e.status;return(0,t.jsxs)("div",{className:`flex items-start gap-3 p-3 border rounded-lg hover:bg-accent transition-colors ${"completed"===e.status?"opacity-60":""}`,children:[(0,t.jsx)("button",{onClick:()=>O(e),className:"mt-1",children:(0,t.jsx)(s,{className:`h-5 w-5 ${"completed"===e.status?"text-green-600":"text-muted-foreground"}`})}),(0,t.jsx)("div",{className:"flex-1 min-w-0",children:(0,t.jsxs)("div",{className:"flex items-start justify-between gap-2",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("p",{className:`font-medium ${"completed"===e.status?"line-through":""}`,children:e.title}),e.description&&(0,t.jsx)("p",{className:"text-sm text-muted-foreground mt-1 line-clamp-2",children:e.description}),(0,t.jsxs)("div",{className:"flex items-center gap-2 mt-2",children:[(0,t.jsx)(n.Badge,{className:S[e.priority],children:e.priority}),e.due_date&&(0,t.jsxs)("span",{className:`text-xs ${a?"text-red-600 font-medium":"text-muted-foreground"}`,children:[a?"Overdue: ":"Due: ",new Date(e.due_date).toLocaleDateString()]}),e.proposed_project_name&&(0,t.jsxs)(n.Badge,{variant:"outline",className:"text-[11px]",children:["Pending project: ",e.proposed_project_name," (",e.proposed_project_status||"pending",")"]}),(e.proposed_project_name||e.proposed_project_status)&&console.log("[TaskManager] Task with proposal:",e.id,e.proposed_project_name,e.proposed_project_status),e.projects?.name&&(0,t.jsxs)("span",{className:"text-xs text-muted-foreground",children:["â€¢ ",e.projects.name]})]})]}),(0,t.jsx)(d.Button,{variant:"ghost",size:"sm",onClick:()=>G(e.id),disabled:A===e.id,children:A===e.id?(0,t.jsx)("span",{className:"text-xs",children:"Deleting..."}):(0,t.jsx)(v.Trash2,{className:"h-4 w-4 text-muted-foreground"})})]})})]},e.id)})})})]})}var M=e.i(78892),L=e.i(7855),E=e.i(63727),A=e.i(39951),F=e.i(78894),I=e.i(59208),R=e.i(67236),P=e.i(87316),B=e.i(63059),U=e.i(25652),z=e.i(3116),q=e.i(78716),O=e.i(82293),G=e.i(61911),V=e.i(56272),$=e.i(94008);function H(){let{user:e,loading:m}=(0,s.useAuth)(),p=(0,r.useRouter)(),[x,g]=(0,a.useState)(!0),[f,v]=(0,a.useState)([]),[y,_]=(0,a.useState)([]),[N,b]=(0,a.useState)(null),[w,k]=(0,a.useState)(null),[S,D]=(0,a.useState)([]),[H,K]=(0,a.useState)([]),[Y,Z]=(0,a.useState)([]),[W,X]=(0,a.useState)([]),[J,Q]=(0,a.useState)(),[ee,et]=(0,a.useState)(!1),[es,ea]=(0,a.useState)(!1),[er,el]=(0,a.useState)({activeProjects:0,tasksToday:0,overdueTasks:0,upcomingMilestones:0});(0,a.useEffect)(()=>{!async function(){if(!e||m)return;g(!0);let t=(0,C.createClient)(),s=new Date().toISOString().split("T")[0];try{let[a,r]=await Promise.all([t.from("projects").select("id,name,status,deadline,progress_percentage,start_date,description,clients(company_name)").eq("created_by",e.id).limit(10),t.from("project_team").select("project_id,projects(id,name,status,deadline,progress_percentage,start_date,description,clients(company_name))").eq("user_id",e.id).limit(10)]),l=[],i=a.data||[],n=(r.data||[]).map(e=>e.projects).filter(Boolean),d=e=>({...e,clients:Array.isArray(e.clients)?e.clients[0]:e.clients});for(let e of i){let t=d(e);l.find(e=>e.id===t.id)||l.push(t)}for(let e of n){let t=d(e);l.find(e=>e.id===t.id)||l.push(t)}let o=l.map(e=>e.id),c=o.length?t.from("milestones").select("id,title,due_date,status,project_id,projects(name)").in("project_id",o).in("status",["pending","in_progress"]).order("due_date",{ascending:!0}).limit(5):Promise.resolve({data:[]}),[u,m,p]=await Promise.all([t.from("employee_tasks").select("id").eq("user_id",e.id).or(`due_date.eq.${s},status.eq.in_progress`),t.from("employee_tasks").select("id").eq("user_id",e.id).lt("due_date",s).neq("status","completed").neq("status","cancelled"),c]);v(l),_(p.data||[]),el({activeProjects:l.filter(e=>"completed"!==e.status&&"cancelled"!==e.status).length,tasksToday:u.data?.length||0,overdueTasks:m.data?.length||0,upcomingMilestones:p.data?.length||0})}catch(e){console.error("Failed to load employee dashboard",e)}finally{g(!1)}}()},[e?.id,m]),(0,a.useEffect)(()=>{w&&console.log("[employee-view] detailProject set",{id:w.id,name:w.name,drive_folder_url:w.drive_folder_url})},[w]),(0,a.useEffect)(()=>{console.log("[employee-view] detailFiles updated",W)},[W]),(0,a.useEffect)(()=>{console.log("[employee-view] detailTeam updated",Y)},[Y]);let ei=async t=>{et(!0);let s=(0,C.createClient)();try{console.log("[employee-view] loadProjectDetails start",t);let{data:a}=await s.from("projects").select("*, clients(company_name)").eq("id",t).single();a&&(console.log("[employee-view] projectData",a),k(a));let{data:r}=await s.from("milestones").select("*").eq("project_id",t).order("due_date",{ascending:!0});r&&(console.log("[employee-view] milestonesData",r),D(r));let{data:l}=await s.from("sub_projects").select("*, assigned_user:users!sub_projects_assigned_to_fkey(id, email, full_name)").eq("parent_project_id",t);l&&(console.log("[employee-view] subProjectsData",l),K(l));let{data:i}=await s.from("project_files").select("id, project_id, file_name, file_url, file_type, file_category, storage_type, file_size, created_at, description").eq("project_id",t).order("created_at",{ascending:!1});i&&(console.log("[employee-view] filesData",i),X(i));let{data:n,error:d}=await s.from("project_team").select("project_id, user_id, users:users!project_team_user_id_fkey(id, email, full_name, role)").eq("project_id",t);if(d&&(console.error("[employee-view] team fetch error",{projectId:t,teamError:d}),Q({projectId:t,viewerId:e?.id,rows:0,error:d.message})),n){console.log("[employee-view] raw teamData",n);let s=n.map(e=>e.users).filter(Boolean);console.log("[employee-view] teamData mapped",s),Z(s),0===s.length&&console.warn("[employee-view] teamData mapped is empty",{projectId:t,userId:e?.id}),Q({projectId:t,viewerId:e?.id,rows:s.length,error:void 0})}}catch(s){console.error("Error loading project details:",s),Q({projectId:t,viewerId:e?.id,rows:0,error:s.message})}finally{et(!1)}},en=async(t,s)=>{ea(!0);let a=(0,C.createClient)();try{let{error:r}=await a.from("sub_projects").update({status:s}).eq("id",t);if(!r){K(H.map(e=>e.id===t?{...e,status:s}:e));let r=H.find(e=>e.id===t);if(r&&r.assigned_to===e?.id){let t=r.project_id||r.parent_project_id||w?.id;t&&await a.from("employee_tasks").update({status:s}).eq("project_id",t).eq("user_id",e?.id).eq("title",r.name)}}}catch(e){console.error("Error updating status:",e)}finally{ea(!1)}},ed=async(t,s)=>{ea(!0);let a=(0,C.createClient)();try{let{error:r}=await a.from("sub_projects").update({progress_percentage:s}).eq("id",t);if(!r){K(H.map(e=>e.id===t?{...e,progress_percentage:s}:e));let r=H.find(e=>e.id===t);if(r&&r.assigned_to===e?.id){let t=r.project_id||r.parent_project_id||w?.id;t&&await a.from("employee_tasks").update({progress_percentage:s}).eq("project_id",t).eq("user_id",e?.id).eq("title",r.name)}}}catch(e){console.error("Error updating progress:",e)}finally{ea(!1)}};if(m||x)return(0,t.jsx)("div",{className:"flex items-center justify-center h-96",children:(0,t.jsx)("p",{className:"text-muted-foreground",children:"Loading your dashboard..."})});let eo=f.slice(0,5);return(0,t.jsxs)("div",{className:"flex flex-col gap-4 md:gap-6",children:[(0,t.jsxs)("div",{className:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-2xl md:text-3xl font-bold tracking-tight",children:"My Work"}),(0,t.jsx)("p",{className:"text-sm md:text-base text-muted-foreground mt-1",children:"Welcome back! Here's an overview of your tasks and projects."})]}),(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row gap-2",children:[(0,t.jsxs)(d.Button,{onClick:()=>p.push("/dashboard/projects"),className:"w-full sm:w-auto",children:[(0,t.jsx)(R.FolderKanban,{className:"h-4 w-4 mr-2"}),"My Projects"]}),(0,t.jsxs)(d.Button,{variant:"outline",onClick:()=>p.push("/dashboard/settings"),className:"w-full sm:w-auto",children:[(0,t.jsx)(h.Plus,{className:"h-4 w-4 mr-2"}),"Settings"]})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-3",children:[(0,t.jsx)(l.StatCard,{title:"Active Projects",value:er.activeProjects.toString(),icon:E.Briefcase}),(0,t.jsx)(l.StatCard,{title:"Today's Tasks",value:er.tasksToday.toString(),icon:A.ListTodo}),(0,t.jsx)(l.StatCard,{title:"Overdue Tasks",value:er.overdueTasks.toString(),icon:F.AlertTriangle,iconClassName:"text-amber-500"}),(0,t.jsx)(l.StatCard,{title:"Upcoming Milestones",value:er.upcomingMilestones.toString(),icon:I.CalendarClock})]}),(0,t.jsx)(T,{}),(0,t.jsxs)(i.Card,{children:[(0,t.jsxs)(i.CardHeader,{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(i.CardTitle,{className:"text-lg md:text-xl",children:"My Projects"}),(0,t.jsx)(i.CardDescription,{className:"text-xs md:text-sm",children:"Projects you're currently assigned to"})]}),(0,t.jsxs)(d.Button,{variant:"ghost",size:"sm",className:"self-start sm:self-auto",onClick:()=>p.push("/dashboard/projects"),children:["View All",(0,t.jsx)(B.ChevronRight,{className:"h-4 w-4 ml-1"})]})]}),(0,t.jsx)(i.CardContent,{children:0===eo.length?(0,t.jsxs)("div",{className:"text-center py-8",children:[(0,t.jsx)(R.FolderKanban,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"No projects assigned yet"})]}):(0,t.jsx)("div",{className:"space-y-3",children:eo.map(e=>(0,t.jsxs)("div",{className:"flex items-center justify-between p-3 rounded-lg border hover:bg-accent cursor-pointer transition-colors",onClick:()=>{b(e),ei(e.id)},children:[(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)("p",{className:"font-medium truncate",children:e.name}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground truncate",children:e.clients?.company_name||"No client"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-3 flex-shrink-0",children:[null!==e.progress_percentage&&void 0!==e.progress_percentage&&(0,t.jsxs)("div",{className:"text-right",children:[(0,t.jsxs)("p",{className:"text-xs font-medium",children:[e.progress_percentage,"%"]}),(0,t.jsx)(o.Progress,{value:e.progress_percentage,className:"h-1.5 w-16 mt-1"})]}),(0,t.jsx)(M.StatusBadge,{status:e.status||"planning"})]})]},e.id))})})]}),y.length>0&&(0,t.jsxs)(i.Card,{children:[(0,t.jsxs)(i.CardHeader,{children:[(0,t.jsx)(i.CardTitle,{children:"Upcoming Milestones"}),(0,t.jsx)(i.CardDescription,{children:"Important deadlines to track"})]}),(0,t.jsx)(i.CardContent,{children:(0,t.jsx)("div",{className:"space-y-3",children:y.map(e=>(0,t.jsxs)("div",{className:"flex items-center justify-between p-3 rounded-lg border",children:[(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)(P.Calendar,{className:"h-4 w-4 mt-1 text-muted-foreground flex-shrink-0"}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)("p",{className:"font-medium truncate",children:e.title}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground truncate",children:e.projects?.name||"No project"})]})]}),(0,t.jsxs)("div",{className:"text-right flex-shrink-0",children:[(0,t.jsx)("p",{className:"text-sm font-medium",children:e.due_date?new Date(e.due_date).toLocaleDateString():"No date"}),(0,t.jsx)(n.Badge,{variant:"outline",className:"text-xs mt-1",children:e.status})]})]},e.id))})})]}),er.overdueTasks>0&&(0,t.jsxs)(i.Card,{className:"border-red-500/50 bg-red-500/5",children:[(0,t.jsxs)(i.CardHeader,{children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(j.AlertCircle,{className:"h-5 w-5 text-red-500"}),(0,t.jsx)(i.CardTitle,{className:"text-red-500",children:"Overdue Tasks"})]}),(0,t.jsxs)(i.CardDescription,{children:["You have ",er.overdueTasks," task",1!==er.overdueTasks?"s":""," past their due date"]})]}),(0,t.jsx)(i.CardContent,{children:(0,t.jsx)(d.Button,{variant:"outline",className:"w-full border-red-500/20 text-red-500 hover:bg-red-500/10",onClick:()=>p.push("/dashboard/employee?tab=tasks"),children:"View Overdue Tasks"})})]}),(0,t.jsx)(c.Dialog,{open:!!N,onOpenChange:e=>{e||(b(null),k(null),D([]),K([]),Z([]),X([]))},children:(0,t.jsx)(c.DialogContent,{className:"max-w-4xl max-h-[85vh] overflow-y-auto",children:N&&(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsx)(c.DialogHeader,{children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(c.DialogTitle,{className:"text-2xl",children:w?.name||N.name}),(0,t.jsxs)(c.DialogDescription,{className:"mt-2",children:["Client: ",w?.clients?.company_name||N.clients?.company_name||"No client"]})]}),(0,t.jsx)(M.StatusBadge,{status:w?.status||N.status||"planning"})]})}),ee?(0,t.jsx)("div",{className:"flex items-center justify-center py-10",children:(0,t.jsx)("div",{className:"text-sm text-muted-foreground",children:"Loading project details..."})}):w?(0,t.jsxs)("div",{className:"space-y-6 pb-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"font-semibold mb-3",children:"Project Overview"}),(0,t.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[w.start_date&&(0,t.jsxs)("div",{className:"p-3 rounded-lg border",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 text-xs text-muted-foreground mb-1",children:[(0,t.jsx)(P.Calendar,{className:"h-3 w-3"}),"Start Date"]}),(0,t.jsx)("p",{className:"font-semibold text-sm",children:new Date(w.start_date).toLocaleDateString()})]}),w.deadline&&(0,t.jsxs)("div",{className:"p-3 rounded-lg border",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 text-xs text-muted-foreground mb-1",children:[(0,t.jsx)(z.Clock,{className:"h-3 w-3"}),"Deadline"]}),(0,t.jsx)("p",{className:"font-semibold text-sm",children:new Date(w.deadline).toLocaleDateString()})]}),(0,t.jsxs)("div",{className:"p-3 rounded-lg border",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 text-xs text-muted-foreground mb-1",children:[(0,t.jsx)(U.TrendingUp,{className:"h-3 w-3"}),"Progress"]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(o.Progress,{value:w.progress_percentage??0,className:"h-2 flex-1"}),(0,t.jsxs)("span",{className:"font-semibold text-sm",children:[w.progress_percentage??0,"%"]})]})]})]})]}),w.description&&(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"font-semibold mb-2",children:"Description"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:w.description})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"flex items-center justify-between mb-3",children:(0,t.jsxs)("h3",{className:"font-semibold flex items-center gap-2",children:[(0,t.jsx)(A.ListTodo,{className:"h-4 w-4"}),"Sub-Projects / Tasks"]})}),H.length>0?(0,t.jsx)("div",{className:"space-y-2",children:H.map(s=>(0,t.jsx)(i.Card,{className:"hover:border-primary/50 transition-colors",children:(0,t.jsx)(i.CardContent,{className:"p-4",children:(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"flex items-start justify-between",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,t.jsx)("h4",{className:"font-medium",children:s.name}),(0,t.jsx)(M.StatusBadge,{status:s.status||"planning"})]}),s.description&&(0,t.jsx)("p",{className:"text-sm text-muted-foreground mb-2",children:s.description}),s.video_url&&(0,t.jsx)("div",{className:"mb-2",children:(0,t.jsxs)("a",{href:s.video_url,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 text-sm text-primary hover:underline",children:[(0,t.jsx)(q.Video,{className:"h-3 w-3"}),"View Video"]})}),(0,t.jsxs)("div",{className:"flex flex-wrap gap-3 text-xs text-muted-foreground",children:[s.assigned_user&&(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)(O.UserCheck,{className:"h-3 w-3"}),s.assigned_user.full_name||s.assigned_user.email]}),s.due_date&&(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)(P.Calendar,{className:"h-3 w-3"}),new Date(s.due_date).toLocaleDateString()]})]})]}),s.assigned_to===e?.id&&(0,t.jsxs)(u.Select,{value:s.status||"planning",onValueChange:e=>en(s.id,e),disabled:es,children:[(0,t.jsx)(u.SelectTrigger,{className:"w-[130px]",children:(0,t.jsx)(u.SelectValue,{})}),(0,t.jsxs)(u.SelectContent,{children:[(0,t.jsx)(u.SelectItem,{value:"planning",children:"Planning"}),(0,t.jsx)(u.SelectItem,{value:"in_progress",children:"In Progress"}),(0,t.jsx)(u.SelectItem,{value:"in_review",children:"In Review"}),(0,t.jsx)(u.SelectItem,{value:"completed",children:"Completed"}),(0,t.jsx)(u.SelectItem,{value:"stuck",children:"Stuck"})]})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(o.Progress,{value:s.progress_percentage??0,className:"h-2 flex-1"}),(0,t.jsxs)("span",{className:"text-xs font-medium w-10 text-right",children:[s.progress_percentage??0,"%"]})]}),s.assigned_to===e?.id&&(0,t.jsx)("input",{type:"range",min:0,max:100,step:1,value:s.progress_percentage??0,onChange:e=>ed(s.id,Number(e.target.value)),className:"w-full cursor-pointer",disabled:es})]})]})})},s.id))}):(0,t.jsx)(i.Card,{children:(0,t.jsx)(i.CardContent,{className:"pt-6",children:(0,t.jsxs)("div",{className:"text-center py-8 text-muted-foreground text-sm",children:[(0,t.jsx)(A.ListTodo,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),"No tasks yet for this project."]})})})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"flex items-center justify-between mb-3",children:(0,t.jsx)("h3",{className:"font-semibold",children:"Milestones"})}),S.length>0?(0,t.jsx)("div",{className:"space-y-2",children:S.map(e=>(0,t.jsx)(i.Card,{children:(0,t.jsx)(i.CardContent,{className:"p-4",children:(0,t.jsx)("div",{className:"flex items-start justify-between",children:(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,t.jsx)("h4",{className:"font-medium",children:e.title}),(0,t.jsx)(M.StatusBadge,{status:e.status})]}),e.description&&(0,t.jsx)("p",{className:"text-sm text-muted-foreground mb-2",children:e.description}),e.due_date&&(0,t.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Due: ",new Date(e.due_date).toLocaleDateString()]})]})})})},e.id))}):(0,t.jsx)(i.Card,{children:(0,t.jsx)(i.CardContent,{className:"pt-6",children:(0,t.jsxs)("div",{className:"text-center py-8 text-muted-foreground text-sm",children:[(0,t.jsx)(V.CheckSquare,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),"No milestones yet for this project."]})})})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"flex items-center justify-between mb-3",children:(0,t.jsx)("h3",{className:"font-semibold",children:"Team Members"})}),Y.length>0?(0,t.jsx)("div",{className:"space-y-2",children:Y.map(e=>(0,t.jsx)(i.Card,{children:(0,t.jsx)(i.CardContent,{className:"p-4",children:(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"h-10 w-10 rounded-full bg-primary/10 flex items-center justify-center",children:(0,t.jsx)("span",{className:"text-sm font-medium",children:e.full_name?.charAt(0)||e.email.charAt(0)})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-medium",children:e.full_name||e.email}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground capitalize",children:e.role?.replace("_"," ")})]})]})})},e.id))}):(0,t.jsx)(i.Card,{children:(0,t.jsx)(i.CardContent,{className:"pt-6",children:(0,t.jsxs)("div",{className:"text-center py-8 text-muted-foreground text-sm",children:[(0,t.jsx)(G.Users,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),"No team members assigned yet.",(0,t.jsxs)("div",{className:"mt-2 text-xs",children:["Debug: projectId ",w?.id||N.id,", viewer ",e?.id,", rows ",J?.rows??"n/a",J?.error?`, error ${J.error}`:""]})]})})})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"flex items-center justify-between mb-3",children:(0,t.jsxs)("h3",{className:"font-semibold flex items-center gap-2",children:[(0,t.jsx)($.File,{className:"h-4 w-4"}),"Files"]})}),(0,t.jsx)(L.FileManager,{projectId:w.id,driveFolderUrl:w.drive_folder_url,onDriveFolderUpdate:e=>{console.log("[employee-view] Drive folder updated:",e),w.id&&ei(w.id)}})]})]}):(0,t.jsx)("div",{className:"flex items-center justify-center py-10",children:(0,t.jsx)("div",{className:"text-sm text-muted-foreground",children:"Project not found."})})]})})})]})}function K(){let{loading:e}=(0,s.useAuth)();return e?(0,t.jsx)("div",{className:"flex items-center justify-center h-96",children:(0,t.jsx)("p",{className:"text-muted-foreground",children:"Loading..."})}):(0,t.jsx)(H,{})}e.s(["default",()=>K],71923)}]);