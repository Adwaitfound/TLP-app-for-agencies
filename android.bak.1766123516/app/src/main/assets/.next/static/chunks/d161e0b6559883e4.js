(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,48425,e=>{"use strict";var t=e.i(71645);e.i(74080);var r=e.i(91918),a=e.i(43476),i=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"].reduce((e,i)=>{let o=(0,r.createSlot)(`Primitive.${i}`),s=t.forwardRef((e,t)=>{let{asChild:r,...s}=e;return"undefined"!=typeof window&&(window[Symbol.for("radix-ui")]=!0),(0,a.jsx)(r?o:i,{...s,ref:t})});return s.displayName=`Primitive.${i}`,{...e,[i]:s}},{});e.s(["Primitive",()=>i])},23750,e=>{"use strict";var t=e.i(43476),r=e.i(71645),a=e.i(47163);let i=r.forwardRef(({className:e,type:r,...i},o)=>(0,t.jsx)("input",{type:r,className:(0,a.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),ref:o,...i}));i.displayName="Input",e.s(["Input",()=>i])},10708,e=>{"use strict";var t=e.i(43476),r=e.i(71645),a=e.i(48425),i=r.forwardRef((e,r)=>(0,t.jsx)(a.Primitive.label,{...e,ref:r,onMouseDown:t=>{t.target.closest("button, input, select, textarea")||(e.onMouseDown?.(t),!t.defaultPrevented&&t.detail>1&&t.preventDefault())}}));i.displayName="Label";var o=e.i(25913),s=e.i(47163);let l=(0,o.cva)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),n=r.forwardRef(({className:e,...r},a)=>(0,t.jsx)(i,{ref:a,className:(0,s.cn)(l(),e),...r}));n.displayName=i.displayName,e.s(["Label",()=>n],10708)},78716,e=>{"use strict";let t=(0,e.i(75254).default)("video",[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5",key:"ftymec"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2",key:"158x01"}]]);e.s(["Video",()=>t],78716)},15562,e=>{"use strict";var t=e.i(95187),r=(0,t.createServerReference)("407dfc82b3267d99c51cea5a0a0ab48bad3c28a250",t.callServer,void 0,t.findSourceMapURL,"forceConfirmEmail");e.s(["forceConfirmEmail",()=>r])},86822,e=>{"use strict";var t=e.i(95187),r=(0,t.createServerReference)("40ccf2a3dde700e871dd0ca51628e0652e1064d905",t.callServer,void 0,t.findSourceMapURL,"registerPendingUser");e.s(["registerPendingUser",()=>r])},89954,e=>{"use strict";var t=e.i(43476),r=e.i(71645),a=e.i(18566),i=e.i(70065),o=e.i(67881),s=e.i(23750),l=e.i(10708),n=e.i(78716),d=e.i(20755),c=e.i(76686),u=e.i(15562),m=e.i(86822);function p(){let[e,p]=(0,r.useState)(""),[f,g]=(0,r.useState)(""),[h,b]=(0,r.useState)(!1),[y,v]=(0,r.useState)(null),x=(0,a.useRouter)(),w=(0,d.createClient)();(0,r.useEffect)(()=>((async()=>{try{await w.auth.signOut()}catch(e){c.debug.warn("LOGIN","Initial signOut on login mount failed",{message:e?.message})}})(),setTimeout(()=>{p(""),g("");let e=document.getElementById("email"),t=document.getElementById("password");e&&(e.value=""),t&&(t.value="")},100),()=>{p(""),g("")}),[]);let j=async t=>{t.preventDefault(),b(!0),v(null);let r=setTimeout(()=>{console.error("Login timeout - taking longer than expected"),b(!1),v("Login is taking too long. Please try again.")},1e4);try{await w.auth.signOut(),console.log("Step 1: Attempting login with:",e),c.debug.log("LOGIN","Attempting login",{email:e});let{data:t,error:a}=await w.auth.signInWithPassword({email:e,password:f});if(console.log("Step 2: Auth response received",{authError:a?.message,userId:t?.user?.id,authenticatedEmail:t?.user?.email}),a){if(a?.code==="email_not_confirmed"){c.debug.warn("LOGIN","Email not confirmed, attempting server-side confirm",{email:e});let r=await (0,u.forceConfirmEmail)(e);if(r.success){c.debug.success("LOGIN","Email confirmed server-side, retrying login",{userId:r.userId});let i=await w.auth.signInWithPassword({email:e,password:f});t=i.data,a=i.error}}if(a)throw console.error("Auth error:",a),a}if(!t.user)throw Error("No user returned from authentication");console.log("Step 3: User authenticated:",t.user.id),c.debug.success("LOGIN","User authenticated",{userId:t.user.id}),console.log("Step 4: Fetching user profile...");let{data:i,error:o}=await w.from("users").select("*").eq("id",t.user.id);console.log("Step 5: User profile response",{error:o?.message,rowCount:i?.length,role:i?.[0]?.role}),o&&console.error("User data error:",{message:o.message,code:o.code,details:o.details});let s=i&&i.length>0?i[0]:null;if(!s){console.error("User profile not found by id; trying email lookup:",t.user.id);let{data:r}=await w.from("users").select("*").eq("email",t.user.email).limit(1);if(r&&r.length>0)s=r[0];else{let r=t.user.user_metadata?.role||"project_manager",a=await (0,m.registerPendingUser)({id:t.user.id,email:t.user.email,full_name:t.user.user_metadata?.full_name||e.split("@")[0],role:r,company_name:t.user.user_metadata?.company_name||null});if(!a.success)throw console.error("Failed to create user profile via server action:",a.error),Error("Failed to create user profile. Please contact support.");let{data:i}=await w.from("users").select("*").eq("id",t.user.id).limit(1);if(!(s=i?.[0]||null))throw Error("Profile creation completed but could not load profile. Please retry.")}}if(console.log("Step 6: User data fetched, redirecting based on role:",s.role),c.debug.success("LOGIN","Profile fetched",{role:s.role,email:s.email}),"client"===s.role){let e=s.status||"pending";if("approved"!==e){c.debug.warn("LOGIN","Blocked pending/rejected client",{status:e,email:s.email}),await w.auth.signOut(),clearTimeout(r),v("rejected"===e?"Your account was rejected. Please contact support.":"Your account is pending admin approval. Please wait for an approval email.");return}}await new Promise(e=>setTimeout(e,500)),"admin"===s.role?(console.log("Redirecting to admin dashboard"),x.push("/dashboard")):"client"===s.role?(console.log("Redirecting to client dashboard"),x.push("/dashboard/client")):(console.log("Redirecting to employee dashboard"),x.push("/dashboard/employee")),clearTimeout(r)}catch(r){let e;console.error("Login error:",r);let t="invalid_grant"===(e=r?.code||r?.status)||r?.message?.toLowerCase().includes("invalid login")?"Invalid email or password":"email_not_confirmed"===e?"Please verify your email before logging in":"rate_limit_exceeded"===e?"Too many attempts. Please wait and try again.":r?.message||"Failed to log in";c.debug.error("LOGIN","Login failed",{message:t,code:r?.code}),v(t)}finally{clearTimeout(r),b(!1)}};return(0,t.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 to-indigo-100 dark:from-gray-900 dark:to-gray-800 p-4",children:(0,t.jsxs)(i.Card,{className:"w-full max-w-md",children:[(0,t.jsxs)(i.CardHeader,{className:"text-center",children:[(0,t.jsx)("div",{className:"mx-auto mb-4 w-16 h-16 rounded-full bg-primary/10 flex items-center justify-center",children:(0,t.jsx)(n.Video,{className:"w-8 h-8 text-primary"})}),(0,t.jsx)(i.CardTitle,{className:"text-2xl",children:"Welcome Back"}),(0,t.jsx)(i.CardDescription,{children:"Sign in to your video production account"})]}),(0,t.jsx)(i.CardContent,{children:(0,t.jsxs)("form",{onSubmit:j,className:"space-y-4",autoComplete:"off",children:[(0,t.jsx)("input",{type:"text",style:{display:"none"},tabIndex:-1,autoComplete:"off"}),(0,t.jsx)("input",{type:"password",style:{display:"none"},tabIndex:-1,autoComplete:"off"}),y&&(0,t.jsx)("div",{className:"p-3 text-sm text-red-500 bg-red-50 dark:bg-red-900/20 rounded-md",children:y}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(l.Label,{htmlFor:"email",children:"Email"}),(0,t.jsx)(s.Input,{id:"email",name:"user-email-login",type:"email",placeholder:"you@example.com",value:e,onChange:e=>p(e.target.value),autoComplete:"off","data-lpignore":"true","data-form-type":"other",required:!0})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(l.Label,{htmlFor:"password",children:"Password"}),(0,t.jsx)(s.Input,{id:"password",name:"user-password-login",type:"password",placeholder:"••••••••",value:f,onChange:e=>g(e.target.value),autoComplete:"new-password","data-lpignore":"true","data-form-type":"other",required:!0})]}),(0,t.jsx)(o.Button,{type:"submit",className:"w-full",disabled:h,children:h?"Signing in...":"Sign In"}),(0,t.jsxs)("div",{className:"text-center text-sm text-muted-foreground space-y-2",children:[(0,t.jsxs)("div",{children:["Don't have an account?"," ",(0,t.jsx)(o.Button,{type:"button",variant:"link",onClick:()=>x.push("/signup"),className:"text-primary p-0 h-auto font-normal",children:"Sign up here"})]}),(0,t.jsx)("div",{children:(0,t.jsx)(o.Button,{type:"button",variant:"link",onClick:()=>x.push("/"),className:"text-muted-foreground",children:"← Back to Home"})})]})]})})]})})}e.s(["default",()=>p])}]);