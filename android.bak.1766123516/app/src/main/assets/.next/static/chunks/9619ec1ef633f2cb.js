(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,86536,e=>{"use strict";let t=(0,e.i(75254).default)("eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);e.s(["Eye",()=>t],86536)},10708,e=>{"use strict";var t=e.i(43476),a=e.i(71645),r=e.i(48425),l=a.forwardRef((e,a)=>(0,t.jsx)(r.Primitive.label,{...e,ref:a,onMouseDown:t=>{t.target.closest("button, input, select, textarea")||(e.onMouseDown?.(t),!t.defaultPrevented&&t.detail>1&&t.preventDefault())}}));l.displayName="Label";var s=e.i(25913),i=e.i(47163);let n=(0,s.cva)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),d=a.forwardRef(({className:e,...a},r)=>(0,t.jsx)(l,{ref:r,className:(0,i.cn)(n(),e),...a}));d.displayName=l.displayName,e.s(["Label",()=>d],10708)},31278,e=>{"use strict";let t=(0,e.i(75254).default)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);e.s(["Loader2",()=>t],31278)},94179,e=>{"use strict";var t=e.i(43476),a=e.i(25913),r=e.i(47163);let l=(0,a.cva)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground",success:"border-transparent bg-green-500 text-white hover:bg-green-600",warning:"border-transparent bg-yellow-500 text-white hover:bg-yellow-600",info:"border-transparent bg-blue-500 text-white hover:bg-blue-600"}},defaultVariants:{variant:"default"}});function s({className:e,variant:a,...s}){return(0,t.jsx)("div",{className:(0,r.cn)(l({variant:a}),e),...s})}e.s(["Badge",()=>s])},7233,e=>{"use strict";let t=(0,e.i(75254).default)("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);e.s(["Plus",()=>t],7233)},30374,e=>{"use strict";var t=e.i(43476),a=e.i(71645),r=e.i(26999),l=e.i(37727),s=e.i(47163);let i=r.Root,n=r.Trigger,d=r.Portal;r.Close;let o=a.forwardRef(({className:e,...a},l)=>(0,t.jsx)(r.Overlay,{ref:l,className:(0,s.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...a}));o.displayName=r.Overlay.displayName;let c=a.forwardRef(({className:e,children:a,...i},n)=>(0,t.jsxs)(d,{children:[(0,t.jsx)(o,{}),(0,t.jsxs)(r.Content,{ref:n,className:(0,s.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...i,children:[a,(0,t.jsxs)(r.Close,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,t.jsx)(l.X,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"sr-only",children:"Close"})]})]})]}));c.displayName=r.Content.displayName;let u=({className:e,...a})=>(0,t.jsx)("div",{className:(0,s.cn)("flex flex-col space-y-1.5 text-center sm:text-left",e),...a});u.displayName="DialogHeader";let m=({className:e,...a})=>(0,t.jsx)("div",{className:(0,s.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...a});m.displayName="DialogFooter";let f=a.forwardRef(({className:e,...a},l)=>(0,t.jsx)(r.Title,{ref:l,className:(0,s.cn)("text-lg font-semibold leading-none tracking-tight",e),...a}));f.displayName=r.Title.displayName;let x=a.forwardRef(({className:e,...a},l)=>(0,t.jsx)(r.Description,{ref:l,className:(0,s.cn)("text-sm text-muted-foreground",e),...a}));x.displayName=r.Description.displayName,e.s(["Dialog",()=>i,"DialogContent",()=>c,"DialogDescription",()=>x,"DialogFooter",()=>m,"DialogHeader",()=>u,"DialogTitle",()=>f,"DialogTrigger",()=>n])},47627,e=>{"use strict";var t=e.i(43476),a=e.i(71645),r=e.i(47163);let l=a.forwardRef(({className:e,...a},l)=>(0,t.jsx)("div",{className:"relative w-full overflow-auto",children:(0,t.jsx)("table",{ref:l,className:(0,r.cn)("w-full caption-bottom text-sm",e),...a})}));l.displayName="Table";let s=a.forwardRef(({className:e,...a},l)=>(0,t.jsx)("thead",{ref:l,className:(0,r.cn)("[&_tr]:border-b",e),...a}));s.displayName="TableHeader";let i=a.forwardRef(({className:e,...a},l)=>(0,t.jsx)("tbody",{ref:l,className:(0,r.cn)("[&_tr:last-child]:border-0",e),...a}));i.displayName="TableBody",a.forwardRef(({className:e,...a},l)=>(0,t.jsx)("tfoot",{ref:l,className:(0,r.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",e),...a})).displayName="TableFooter";let n=a.forwardRef(({className:e,...a},l)=>(0,t.jsx)("tr",{ref:l,className:(0,r.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",e),...a}));n.displayName="TableRow";let d=a.forwardRef(({className:e,...a},l)=>(0,t.jsx)("th",{ref:l,className:(0,r.cn)("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",e),...a}));d.displayName="TableHead";let o=a.forwardRef(({className:e,...a},l)=>(0,t.jsx)("td",{ref:l,className:(0,r.cn)("p-4 align-middle [&:has([role=checkbox])]:pr-0",e),...a}));o.displayName="TableCell",a.forwardRef(({className:e,...a},l)=>(0,t.jsx)("caption",{ref:l,className:(0,r.cn)("mt-4 text-sm text-muted-foreground",e),...a})).displayName="TableCaption",e.s(["Table",()=>l,"TableBody",()=>i,"TableCell",()=>o,"TableHead",()=>d,"TableHeader",()=>s,"TableRow",()=>n])},63289,e=>{"use strict";var t=e.i(43476),a=e.i(71645),r=e.i(70065),l=e.i(67881),s=e.i(23750),i=e.i(10708),n=e.i(94179),d=e.i(62870),o=e.i(30374),c=e.i(47627),u=e.i(86536),m=e.i(78583),f=e.i(31278),x=e.i(7233),h=e.i(27612),p=e.i(40160),v=e.i(20755),g=e.i(61668),j=e.i(95187),b=(0,j.createServerReference)("40f54ce617644a4784493e827870e17a65e9273ef2",j.callServer,void 0,j.findSourceMapURL,"uploadInvoiceFile"),y=(0,j.createServerReference)("005e4c4e42c0c2763b1f47fcf35b742542a8e3595f",j.callServer,void 0,j.findSourceMapURL,"fetchInvoicesData"),N=(0,j.createServerReference)("60a1647e99863c4a9ca254b5e3376492d2265241a0",j.callServer,void 0,j.findSourceMapURL,"updateInvoiceStatus"),w=(0,j.createServerReference)("6080e6bd584b0a9051540e8465bc2512b088944e84",j.callServer,void 0,j.findSourceMapURL,"deleteInvoice"),S=(0,j.createServerReference)("400ac50675809b5125de28467cacbc1423e833b418",j.callServer,void 0,j.findSourceMapURL,"getSignedInvoiceUrl");let T={draft:{label:"Draft",variant:"secondary"},sent:{label:"Sent",variant:"default"},paid:{label:"Paid",variant:"default"},overdue:{label:"Overdue",variant:"destructive"},cancelled:{label:"Cancelled",variant:"secondary"}};function C(){let{user:e,loading:j}=(0,g.useAuth)(),[C,D]=(0,a.useState)([]),[R,I]=(0,a.useState)([]),[_,U]=(0,a.useState)([]),[P,k]=(0,a.useState)(!0),[F,L]=(0,a.useState)(!1),[H,B]=(0,a.useState)(!1),z=(0,a.useRef)(!1),M=(0,a.useRef)(null),[O,E]=(0,a.useState)(null),[V,A]=(0,a.useState)(null),[q,K]=(0,a.useState)(""),[W,X]=(0,a.useState)(""),[$,G]=(0,a.useState)(""),J=e?.email==="adwait@thelostproject.in";function Q(e,t="success"){M.current&&clearTimeout(M.current),E({message:e,type:t}),M.current=setTimeout(()=>E(null),3e3)}(0,a.useEffect)(()=>{if(!j){if(!J)return void k(!1);ee()}},[j,J]);let Y=_.filter(e=>!q||e.client_id===q);async function Z(e,t){let a=await S(e);if(a.error||!a.signedUrl)return void Q(a.error||"Unable to generate signed URL","error");if(t){let e=document.createElement("a");e.href=a.signedUrl,e.download="invoice.pdf",document.body.appendChild(e),e.click(),document.body.removeChild(e),Q("Download started","success")}else window.open(a.signedUrl,"_blank"),Q("Opening invoice","success")}async function ee(){k(!0);try{let e=await y();if(e.error)throw console.error("Fetch error:",e.error),Error(e.error);D(e.invoices||[]),I(e.clients||[]),U(e.projects||[])}catch(e){console.error("Error loading invoices:",e),Q(e.message||"Failed to load invoices","error")}finally{k(!1)}}async function et(e){if(e.preventDefault(),!J)return void alert("Access restricted to adwait@thelostproject.in");if(z.current)return;if(!V)return void alert("Please select an invoice PDF to upload");if(!q||!$.trim())return void alert("Please fill in all required fields");if(!V.name.toLowerCase().endsWith(".pdf"))return void alert("Please upload a PDF file");z.current=!0,B(!0);let t=(0,v.createClient)();try{let e=new FormData;e.append("file",V),e.append("invoiceNumber",$);let a=await b(e);if(!a.success||a.error)throw Error(a.error||"Upload failed");let{publicUrl:r}=a,l=new Date().toISOString().split("T")[0],{data:s,error:i}=await t.from("invoices").insert({client_id:q,project_id:W||null,invoice_number:$,invoice_file_url:r,issue_date:l,due_date:l,status:"draft"}).select("*, clients(company_name), projects(name)").single();if(i)throw console.error("DB insert error details:",i),i;s&&D(e=>[s,...e]),Q("Invoice uploaded","success"),L(!1),A(null),K(""),X(""),G("")}catch(e){console.error("Error uploading invoice:",e),Q(e.message||"Failed to upload invoice","error")}finally{B(!1),z.current=!1}}async function ea(e,t){if(confirm("Are you sure you want to delete this invoice?"))try{let a=await w(e,t);if(a.error)throw Error(a.error);D(t=>t.filter(t=>t.id!==e)),Q("Invoice deleted","success")}catch(e){console.error("Error deleting invoice:",e),Q(e.message||"Failed to delete invoice","error")}}return j?(0,t.jsx)("div",{className:"flex h-96 items-center justify-center",children:(0,t.jsx)("p",{className:"text-muted-foreground",children:"Loading..."})}):J?(0,t.jsxs)("div",{className:"space-y-6",children:[O?(0,t.jsx)("div",{className:`fixed bottom-4 right-4 z-50 rounded-md px-4 py-3 shadow-lg text-sm text-white ${"success"===O.type?"bg-green-600":"bg-red-600"}`,role:"status",children:O.message}):null,(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-3xl font-bold tracking-tight",children:"Invoices"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"Upload and manage client invoices"})]}),(0,t.jsxs)(l.Button,{onClick:()=>L(!0),children:[(0,t.jsx)(x.Plus,{className:"mr-2 h-4 w-4"}),"Upload Invoice"]})]}),(0,t.jsx)("div",{className:"grid gap-4 md:grid-cols-3",children:(0,t.jsxs)(r.Card,{children:[(0,t.jsxs)(r.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,t.jsx)(r.CardTitle,{className:"text-sm font-medium",children:"Total Invoices"}),(0,t.jsx)(m.FileText,{className:"h-4 w-4 text-muted-foreground"})]}),(0,t.jsx)(r.CardContent,{children:(0,t.jsx)("div",{className:"text-2xl font-bold",children:C.length})})]})}),(0,t.jsxs)(r.Card,{children:[(0,t.jsxs)(r.CardHeader,{children:[(0,t.jsx)(r.CardTitle,{children:"All Invoices"}),(0,t.jsx)(r.CardDescription,{children:"View and manage uploaded invoices"})]}),(0,t.jsx)(r.CardContent,{children:P?(0,t.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,t.jsx)(f.Loader2,{className:"h-8 w-8 animate-spin text-muted-foreground"})}):0===C.length?(0,t.jsxs)("div",{className:"py-12 text-center",children:[(0,t.jsx)(m.FileText,{className:"mx-auto mb-4 h-12 w-12 text-muted-foreground opacity-50"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"No invoices uploaded yet"})]}):(0,t.jsxs)(c.Table,{children:[(0,t.jsx)(c.TableHeader,{children:(0,t.jsxs)(c.TableRow,{children:[(0,t.jsx)(c.TableHead,{children:"Invoice #"}),(0,t.jsx)(c.TableHead,{children:"Client"}),(0,t.jsx)(c.TableHead,{children:"Project"}),(0,t.jsx)(c.TableHead,{children:"Status"}),(0,t.jsx)(c.TableHead,{children:"Uploaded"}),(0,t.jsx)(c.TableHead,{className:"text-right",children:"Actions"})]})}),(0,t.jsx)(c.TableBody,{children:C.map(e=>(0,t.jsxs)(c.TableRow,{children:[(0,t.jsx)(c.TableCell,{className:"font-medium",children:e.invoice_number}),(0,t.jsx)(c.TableCell,{children:e.clients?.company_name}),(0,t.jsx)(c.TableCell,{children:e.projects?.name||(0,t.jsx)("span",{className:"text-muted-foreground",children:"â€”"})}),(0,t.jsx)(c.TableCell,{children:(0,t.jsxs)(d.Select,{value:e.status,onValueChange:t=>N(e.id,t).then(t=>{t.error?Q(t.error,"error"):t.data&&(D(a=>a.map(a=>a.id===e.id?t.data:a)),Q("Status updated","success"))}),children:[(0,t.jsx)(d.SelectTrigger,{className:"w-auto border-0 bg-transparent",children:(0,t.jsx)(n.Badge,{variant:T[e.status].variant,children:T[e.status].label})}),(0,t.jsxs)(d.SelectContent,{children:[(0,t.jsx)(d.SelectItem,{value:"draft",children:"Draft"}),(0,t.jsx)(d.SelectItem,{value:"sent",children:"Sent"}),(0,t.jsx)(d.SelectItem,{value:"paid",children:"Paid"}),(0,t.jsx)(d.SelectItem,{value:"overdue",children:"Overdue"}),(0,t.jsx)(d.SelectItem,{value:"cancelled",children:"Cancelled"})]})]})}),(0,t.jsx)(c.TableCell,{children:new Date(e.created_at).toLocaleDateString()}),(0,t.jsx)(c.TableCell,{className:"text-right",children:(0,t.jsxs)("div",{className:"flex items-center justify-end gap-2",children:[(0,t.jsx)(l.Button,{variant:"ghost",size:"sm",onClick:()=>Z(e.invoice_file_url),title:"View PDF",children:(0,t.jsx)(u.Eye,{className:"h-4 w-4"})}),(0,t.jsx)(l.Button,{variant:"ghost",size:"sm",onClick:()=>Z(e.invoice_file_url,!0),title:"Download PDF",children:(0,t.jsx)(p.Download,{className:"h-4 w-4"})}),(0,t.jsx)(l.Button,{variant:"ghost",size:"sm",onClick:()=>ea(e.id,e.invoice_file_url),title:"Delete invoice",children:(0,t.jsx)(h.Trash2,{className:"h-4 w-4"})})]})})]},e.id))})]})})]}),(0,t.jsx)(o.Dialog,{open:F,onOpenChange:e=>{e||(A(null),K(""),X(""),G(""),B(!1),z.current=!1),L(e)},children:(0,t.jsx)(o.DialogContent,{className:"max-w-md",children:(0,t.jsxs)("form",{onSubmit:et,children:[(0,t.jsxs)(o.DialogHeader,{children:[(0,t.jsx)(o.DialogTitle,{children:"Upload Invoice"}),(0,t.jsx)(o.DialogDescription,{children:"Upload an invoice PDF and select the client and project"})]}),(0,t.jsxs)("div",{className:"space-y-4 py-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(i.Label,{children:"Invoice PDF *"}),(0,t.jsx)(s.Input,{type:"file",accept:".pdf",onChange:e=>A(e.target.files?.[0]||null),className:"mt-1",required:!0}),V&&(0,t.jsxs)("p",{className:"mt-1 text-xs text-muted-foreground",children:[V.name," (",(V.size/1024).toFixed(2)," KB)"]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(i.Label,{children:"Invoice Number *"}),(0,t.jsx)(s.Input,{value:$,onChange:e=>G(e.target.value),className:"mt-1",placeholder:"INV-2024-001",required:!0})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(i.Label,{children:"Client *"}),(0,t.jsxs)(d.Select,{value:q,onValueChange:e=>{K(e),X("")},required:!0,children:[(0,t.jsx)(d.SelectTrigger,{className:"mt-1",children:(0,t.jsx)(d.SelectValue,{placeholder:"Select client"})}),(0,t.jsx)(d.SelectContent,{children:R.map(e=>(0,t.jsx)(d.SelectItem,{value:e.id,children:e.company_name},e.id))})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(i.Label,{children:"Project (Optional)"}),(0,t.jsxs)(d.Select,{value:W,onValueChange:X,disabled:!q,children:[(0,t.jsx)(d.SelectTrigger,{className:"mt-1",children:(0,t.jsx)(d.SelectValue,{placeholder:q?"Select project":"Select client first"})}),(0,t.jsx)(d.SelectContent,{children:Y.map(e=>(0,t.jsx)(d.SelectItem,{value:e.id,children:e.name},e.id))})]})]})]}),(0,t.jsxs)(o.DialogFooter,{children:[(0,t.jsx)(l.Button,{type:"button",variant:"outline",onClick:()=>L(!1),disabled:H,children:"Cancel"}),(0,t.jsxs)(l.Button,{type:"submit",disabled:H||!V,children:[H&&(0,t.jsx)(f.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),H?"Uploading...":"Upload Invoice"]})]})]})})})]}):(0,t.jsx)("div",{className:"flex h-96 items-center justify-center",children:(0,t.jsxs)("div",{className:"max-w-md space-y-2 text-center",children:[(0,t.jsx)("h2",{className:"text-xl font-semibold",children:"Access restricted"}),(0,t.jsx)("p",{className:"text-muted-foreground text-sm",children:"Only adwait@thelostproject.in can manage invoices here."})]})})}e.s(["default",()=>C],63289)}]);