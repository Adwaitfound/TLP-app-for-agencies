(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,6234,e=>{"use strict";var s=e.i(95187),t=(0,s.createServerReference)("405c5bdfe2a43767b9832e1c2375adb8b49762ba71",s.callServer,void 0,s.findSourceMapURL,"assignCommentToEmployee");e.s(["assignCommentToEmployee",()=>t])},38368,e=>{"use strict";var s=e.i(43476),t=e.i(71645),a=e.i(20755),i=e.i(61668),r=e.i(70065),n=e.i(67881),l=e.i(62870),c=e.i(6234),d=e.i(23750);function o(){let{user:e}=(0,i.useAuth)(),[o,m]=(0,t.useState)([]),[u,x]=(0,t.useState)([]),[p,j]=(0,t.useState)({}),[h,f]=(0,t.useState)({}),[_,g]=(0,t.useState)("all"),[v,C]=(0,t.useState)(""),[S,y]=(0,t.useState)(!0);(0,t.useEffect)(()=>{!async function(){if(!e)return;let s=(0,a.createClient)();y(!0);try{let{data:e}=await s.from("projects").select("id, name, client_id, clients(company_name)").order("created_at",{ascending:!1}),{data:t}=await s.from("project_comments").select(`
                        id,
                        project_id,
                        user_id,
                        comment_text,
                        assigned_user_id,
                        status,
                        created_at,
                        author:user_id(full_name, email),
                        assignee:assigned_user_id(full_name, email),
                        projects(name, clients(company_name))
                    `).order("created_at",{ascending:!1}).limit(200),a=e?.map(e=>e.id)||[],{data:i}=await s.from("project_team").select("project_id, user_id, users(full_name, email)").in("project_id",a),r=(i||[]).reduce((e,s)=>(e[s.project_id]=e[s.project_id]||[],e[s.project_id].push(s),e),{});x(e||[]),m(t||[]),j(r)}catch(e){console.error("Failed to fetch comments admin view",e)}finally{y(!1)}}()},[e?.id]);let N=(0,t.useMemo)(()=>o.filter(e=>{let s="all"===_||e.project_id===_,t=`${e.comment_text||""} ${e.projects?.name||""} ${e.author?.full_name||""} ${e.author?.email||""}`.toLowerCase().includes(v.toLowerCase());return s&&t}),[o,_,v]),w=async(e,s)=>{if(!s)return;let t=await (0,c.assignCommentToEmployee)({commentId:e,userId:s});t.success&&m(a=>a.map(a=>a.id===e?{...a,assigned_user_id:s,assignee:t.comment?.assignee}:a))};return(0,s.jsx)("div",{className:"space-y-4",children:(0,s.jsxs)(r.Card,{children:[(0,s.jsxs)(r.CardHeader,{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(r.CardTitle,{children:"Project Comments"}),(0,s.jsx)(r.CardDescription,{children:"Admin/PM view of all comments across projects"})]}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsxs)(l.Select,{value:_,onValueChange:g,children:[(0,s.jsx)(l.SelectTrigger,{className:"w-40",children:(0,s.jsx)(l.SelectValue,{placeholder:"Filter by project"})}),(0,s.jsxs)(l.SelectContent,{children:[(0,s.jsx)(l.SelectItem,{value:"all",children:"All projects"}),u.map(e=>(0,s.jsx)(l.SelectItem,{value:e.id,children:e.name},e.id))]})]}),(0,s.jsx)(d.Input,{placeholder:"Search comments or authors",value:v,onChange:e=>C(e.target.value),className:"w-60"})]})]}),(0,s.jsx)(r.CardContent,{className:"space-y-3",children:S?(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"Loadingâ€¦"}):0===N.length?(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"No comments found"}):N.map(e=>(0,s.jsxs)("div",{className:"p-3 border rounded-lg space-y-2",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between text-xs text-muted-foreground",children:[(0,s.jsx)("span",{children:e.author?.full_name||e.author?.email||"Unknown user"}),(0,s.jsx)("span",{children:new Date(e.created_at).toLocaleString()})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-medium text-sm",children:e.projects?.name||"Project"}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:e.projects?.clients?.company_name})]}),(0,s.jsx)("span",{className:"text-xs text-muted-foreground",children:e.status})]}),(0,s.jsx)("p",{className:"text-sm",children:e.comment_text}),e.assignee&&(0,s.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Assigned to ",e.assignee.full_name||e.assignee.email]}),p[e.project_id]?.length?(0,s.jsxs)("div",{className:"flex items-center gap-2 pt-1",children:[(0,s.jsxs)("select",{className:"border rounded px-2 py-1 text-sm",value:h[e.id]??e.assigned_user_id??"",onChange:s=>f(t=>({...t,[e.id]:s.target.value})),children:[(0,s.jsx)("option",{value:"",children:"Select assignee"}),p[e.project_id].map(e=>(0,s.jsx)("option",{value:e.user_id,children:e.users?.full_name||e.users?.email||"Member"},e.user_id))]}),(0,s.jsx)(n.Button,{size:"sm",variant:"outline",onClick:()=>h[e.id]&&w(e.id,h[e.id]),children:"Assign"})]}):null]},e.id))})]})})}e.s(["default",()=>o])}]);