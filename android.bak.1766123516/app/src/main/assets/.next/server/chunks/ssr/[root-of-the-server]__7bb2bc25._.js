module.exports=[22461,a=>{"use strict";var b=a.i(74779),c=a.i(37936),d=a.i(98310),e=a.i(13095);async function f(a){let b=await (0,d.createClient)(),c=(0,d.createServiceClient)(),{data:{user:e},error:f}=await b.auth.getUser();if(f||!e)return{error:"Unauthorized"};if("adwait@thelostproject.in"!==e.email)return{error:"Access restricted to adwait@thelostproject.in"};let g=a.get("file"),h=a.get("invoiceNumber");if(!g)return{error:"No file provided"};if(!g.name.toLowerCase().endsWith(".pdf"))return{error:"Only PDF files are allowed"};try{let a=`${h.replace(/[^a-zA-Z0-9]/g,"_")}_${Date.now()}_${Math.random().toString(36).substring(7)}.pdf`,b=`invoices/${a}`,{error:d}=await c.storage.from("project-files").upload(b,g);if(d)return console.error("Storage upload error:",d),{error:`Upload failed: ${d.message}`};let{data:{publicUrl:e}}=c.storage.from("project-files").getPublicUrl(b);return{success:!0,filePath:b,publicUrl:e}}catch(a){return console.error("Upload error:",a),{error:a.message||"Upload failed"}}}function g(a){let b="project-files/",c=a.indexOf(b);return(c>=0?a.slice(c+b.length):a).replace(/^public\//,"").replace(/^\//,"")}async function h(){let a=await (0,d.createClient)(),{data:{user:b},error:c}=await a.auth.getUser();if(c||!b)return{error:"Unauthorized"};if("adwait@thelostproject.in"!==b.email)return{error:"Access restricted to adwait@thelostproject.in"};try{let{data:b,error:c}=await a.from("invoices").select("*, clients(company_name), projects(name)").order("created_at",{ascending:!1});if(c)throw c;let{data:d,error:e}=await a.from("clients").select("*").order("company_name");if(e)throw e;let{data:f,error:g}=await a.from("projects").select("*").order("name");if(g)throw g;return{invoices:b||[],clients:d||[],projects:f||[]}}catch(a){return console.error("Fetch error:",a),{error:a.message||"Failed to fetch data"}}}async function i(a,b){let c=await (0,d.createClient)(),{data:{user:e},error:f}=await c.auth.getUser();if(f||!e)return{error:"Unauthorized"};if("adwait@thelostproject.in"!==e.email)return{error:"Access restricted to adwait@thelostproject.in"};try{let{data:d,error:e}=await c.from("invoices").update({status:b}).eq("id",a).select("*, clients(company_name), projects(name)").single();if(e)throw e;return{success:!0,data:d}}catch(a){return console.error("Update error:",a),{error:a.message||"Failed to update invoice"}}}async function j(a,b){let c=await (0,d.createClient)(),e=(0,d.createServiceClient)(),{data:{user:f},error:h}=await c.auth.getUser();if(h||!f)return{error:"Unauthorized"};if("adwait@thelostproject.in"!==f.email)return{error:"Access restricted to adwait@thelostproject.in"};try{let d=g(b);await e.storage.from("project-files").remove([d]);let{error:f}=await c.from("invoices").delete().eq("id",a);if(f)throw f;return{success:!0}}catch(a){return console.error("Delete error:",a),{error:a.message||"Failed to delete invoice"}}}async function k(a){let b=await (0,d.createClient)(),c=(0,d.createServiceClient)(),{data:{user:e},error:f}=await b.auth.getUser();if(f||!e)return{error:"Unauthorized"};if("adwait@thelostproject.in"!==e.email)return{error:"Access restricted to adwait@thelostproject.in"};try{let b=g(a),{data:d,error:e}=await c.storage.from("project-files").createSignedUrl(b,3600);if(e)throw e;return{signedUrl:d?.signedUrl}}catch(a){return console.error("Signed URL error:",a),{error:a.message||"Failed to generate signed URL"}}}(0,e.ensureServerEntryExports)([f]),(0,c.registerServerReference)(f,"40f54ce617644a4784493e827870e17a65e9273ef2",null),(0,e.ensureServerEntryExports)([h,i,j,k]),(0,c.registerServerReference)(h,"005e4c4e42c0c2763b1f47fcf35b742542a8e3595f",null),(0,c.registerServerReference)(i,"60a1647e99863c4a9ca254b5e3376492d2265241a0",null),(0,c.registerServerReference)(j,"6080e6bd584b0a9051540e8465bc2512b088944e84",null),(0,c.registerServerReference)(k,"400ac50675809b5125de28467cacbc1423e833b418",null),a.s([],79780),a.i(79780),a.s(["005e4c4e42c0c2763b1f47fcf35b742542a8e3595f",()=>h,"4001860d967ff1d29143ee49c09c9bbdff4d1af8fb",()=>b.logAuditEvent,"400ac50675809b5125de28467cacbc1423e833b418",()=>k,"40f54ce617644a4784493e827870e17a65e9273ef2",()=>f,"6080e6bd584b0a9051540e8465bc2512b088944e84",()=>j,"60a1647e99863c4a9ca254b5e3376492d2265241a0",()=>i],22461)},85685,a=>{a.v(b=>Promise.all(["server/chunks/ssr/[externals]_crypto_c412f66b._.js"].map(b=>a.l(b))).then(()=>b(54799)))}];

//# sourceMappingURL=%5Broot-of-the-server%5D__7bb2bc25._.js.map