module.exports=[1034,a=>{"use strict";var b=a.i(74779),c=a.i(37936),d=a.i(45618),e=a.i(13095);async function f(a){try{let b;console.log("[SERVER] createClientAccount called with:",{company_name:a.company_name,email:a.email});let c=process.env.SUPABASE_SERVICE_ROLE_KEY;if(!c)return console.error("[SERVER] Missing SUPABASE_SERVICE_ROLE_KEY"),{success:!1,error:"SUPABASE_SERVICE_ROLE_KEY is not configured"};console.log("[SERVER] Creating admin client...");let e=(0,d.createClient)("https://frinqtylwgzquoxvqhxb.supabase.co",c,{auth:{autoRefreshToken:!1,persistSession:!1}}),f=Math.random().toString(36).slice(-10)+Math.random().toString(36).slice(-10).toUpperCase();console.log("[SERVER] Checking if auth user already exists...");let{data:g}=await e.auth.admin.listUsers();if(g?.users?.some(b=>b.email===a.email)){console.log("[SERVER] Auth user already exists, finding existing user ID...");let{data:{users:c},error:d}=await e.auth.admin.listUsers(),f=c?.find(b=>b.email===a.email);if(!f?.id)return{success:!1,error:"User exists but could not retrieve ID"};b=f.id,console.log("[SERVER] Using existing auth user:",b)}else{console.log("[SERVER] Creating new auth user...");let{data:c,error:d}=await e.auth.admin.createUser({email:a.email,password:f,email_confirm:!0,user_metadata:{full_name:a.contact_person,role:"client"}});if(d)return console.error("[SERVER] Auth error:",d),{success:!1,error:`Auth error: ${d.message}`};if(!c.user?.id)return console.error("[SERVER] No user ID returned from auth"),{success:!1,error:"Failed to create auth user"};b=c.user.id,console.log("[SERVER] Auth user created:",b)}console.log("[SERVER] Checking if user record exists...");let{data:h}=await e.from("users").select("id").eq("id",b).single();if(h)console.log("[SERVER] User record already exists");else{console.log("[SERVER] Inserting user record...");let{error:c}=await e.from("users").insert({id:b,email:a.email,full_name:a.contact_person,role:"client",status:"approved",company_name:a.company_name});if(c)return console.error("[SERVER] User insert error:",c),{success:!1,error:`User insert error: ${c.message}`};console.log("[SERVER] User record created")}console.log("[SERVER] Inserting client record...");let{error:i}=await e.from("clients").insert([{user_id:b,company_name:a.company_name,contact_person:a.contact_person,email:a.email,phone:a.phone||"",address:a.address||"",status:"active",total_projects:0,total_revenue:0}]);if(i)return console.error("[SERVER] Client insert error:",i),{success:!1,error:`Client insert error: ${i.message}`};console.log("[SERVER] Client record created successfully");let j={success:!0,credentials:{email:a.email,password:f}};return console.log("[SERVER] Returning success result"),j}catch(a){return console.error("[SERVER] Caught exception:",a?.message||String(a)),{success:!1,error:`Exception: ${a?.message||String(a)}`}}}async function g(a){try{console.log("[SERVER] deleteClient called for client:",a);let b=process.env.SUPABASE_SERVICE_ROLE_KEY;if(!b)return console.error("[SERVER] Missing SUPABASE_SERVICE_ROLE_KEY"),{success:!1,error:"SUPABASE_SERVICE_ROLE_KEY is not configured"};let c=(0,d.createClient)("https://frinqtylwgzquoxvqhxb.supabase.co",b,{auth:{autoRefreshToken:!1,persistSession:!1}}),{data:e,error:f}=await c.from("clients").select("user_id").eq("id",a).single();if(f)return console.error("[SERVER] Error fetching client:",f),{success:!1,error:"Client not found"};let g=e?.user_id,{error:h}=await c.from("clients").delete().eq("id",a);if(h)return console.error("[SERVER] Error deleting client:",h),{success:!1,error:h.message};if(g){let{error:a}=await c.auth.admin.deleteUser(g);a&&console.error("[SERVER] Error deleting user account:",a)}return console.log("[SERVER] Client deleted successfully:",a),{success:!0}}catch(a){return console.error("[SERVER] Unexpected error:",a),{success:!1,error:a?.message||"An unexpected error occurred"}}}(0,e.ensureServerEntryExports)([f]),(0,c.registerServerReference)(f,"40a8276182358e0473daf518fe2722245d125a62c6",null),(0,e.ensureServerEntryExports)([g]),(0,c.registerServerReference)(g,"4093ee1a78e1b6192e9a5026676301b1f60fb07d0c",null),a.s([],71567),a.i(71567),a.s(["4001860d967ff1d29143ee49c09c9bbdff4d1af8fb",()=>b.logAuditEvent,"4093ee1a78e1b6192e9a5026676301b1f60fb07d0c",()=>g,"40a8276182358e0473daf518fe2722245d125a62c6",()=>f],1034)},85685,a=>{a.v(b=>Promise.all(["server/chunks/ssr/[externals]_crypto_c412f66b._.js"].map(b=>a.l(b))).then(()=>b(54799)))}];

//# sourceMappingURL=%5Broot-of-the-server%5D__9f81e412._.js.map