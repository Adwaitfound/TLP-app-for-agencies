{"version":3,"sources":["../../../../.next-internal/server/app/dashboard/team/page/actions.js%20%28server%20actions%20loader%29","../../../../app/actions/create-team-member.ts"],"sourcesContent":["export {logAuditEvent as '4001860d967ff1d29143ee49c09c9bbdff4d1af8fb'} from 'ACTIONS_MODULE0'\nexport {createTeamMember as '40cc7236ea0e9d536a40a43673d7c8d15f6f1f5ada'} from 'ACTIONS_MODULE1'\n","'use server'\n\nimport { createClient } from '@supabase/supabase-js'\n\nexport async function createTeamMember(formData: {\n    email: string\n    full_name: string\n    role: 'admin' | 'project_manager' | 'employee'\n    password: string\n}) {\n    try {\n        // Validate environment variables\n        if (!process.env.NEXT_PUBLIC_SUPABASE_URL) {\n            throw new Error('NEXT_PUBLIC_SUPABASE_URL is not configured')\n        }\n        if (!process.env.SUPABASE_SERVICE_ROLE_KEY) {\n            throw new Error('SUPABASE_SERVICE_ROLE_KEY is not configured. Please add it to your .env.local file.')\n        }\n\n        const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL\n        const supabaseServiceKey = process.env.SUPABASE_SERVICE_ROLE_KEY\n\n        // Create admin client with service role key (bypasses RLS and email confirmation)\n        const supabaseAdmin = createClient(supabaseUrl, supabaseServiceKey, {\n            auth: {\n                autoRefreshToken: false,\n                persistSession: false\n            }\n        })\n\n        // Create user with admin client - this bypasses email confirmation\n        const { data: authData, error: authError } = await supabaseAdmin.auth.admin.createUser({\n            email: formData.email,\n            password: formData.password,\n            email_confirm: true, // Auto-confirm email\n            user_metadata: {\n                full_name: formData.full_name,\n                role: formData.role,\n            }\n        })\n\n        if (authError) {\n            console.error('Auth error:', authError)\n            return { error: authError.message }\n        }\n\n        if (!authData.user) {\n            return { error: 'Failed to create user' }\n        }\n\n        // Update the users table with the role and full name\n        const { error: updateError } = await supabaseAdmin\n            .from('users')\n            .update({\n                full_name: formData.full_name,\n                role: formData.role,\n            })\n            .eq('id', authData.user.id)\n\n        if (updateError) {\n            console.error('Update error:', updateError)\n            // Don't fail completely if update fails, user is already created\n            console.warn('User created but profile update failed:', updateError.message)\n        }\n\n        return {\n            success: true,\n            user: {\n                id: authData.user.id,\n                email: authData.user.email,\n                full_name: formData.full_name,\n                role: formData.role\n            }\n        }\n    } catch (error: any) {\n        console.error('Error creating team member:', error)\n        return { error: error?.message || String(error) || 'Failed to create team member' }\n    }\n}\n"],"names":[],"mappings":"uCAAA,IAAA,EAAA,EAAA,CAAA,CAAA,oBCEA,EAAA,EAAA,CAAA,CAAA,OAEO,eAAe,EAAiB,CAKtC,EACG,GAAI,CAKA,GAAI,CAAC,QAAQ,GAAG,CAAC,yBAAyB,CACtC,CADwC,KAClC,AAAI,MAAM,uFAIpB,IAAM,EAAqB,QAAQ,GAAG,CAAC,yBAAyB,CAG1D,EAAgB,CAAA,EAAA,EAAA,YAAA,AAAY,EAAC,AAJ7B,2CAI0C,EAAoB,CAChE,KAAM,CACF,iBAAkB,GAClB,gBAAgB,CACpB,CACJ,GAGM,CAAE,KAAM,CAAQ,CAAE,MAAO,CAAS,CAAE,CAAG,MAAM,EAAc,IAAI,CAAC,KAAK,CAAC,UAAU,CAAC,CACnF,MAAO,EAAS,KAAK,CACrB,SAAU,EAAS,QAAQ,CAC3B,eAAe,EACf,cAAe,CACX,UAAW,EAAS,SAAS,CAC7B,KAAM,EAAS,IAAI,AACvB,CACJ,GAEA,GAAI,EAEA,OADA,EADW,MACH,KAAK,CAAC,cAAe,GACtB,CAAE,MAAO,EAAU,OAAO,AAAC,EAGtC,GAAI,CAAC,EAAS,IAAI,CACd,CADgB,KACT,CAAE,MAAO,uBAAwB,EAI5C,GAAM,CAAE,MAAO,CAAW,CAAE,CAAG,MAAM,EAChC,IAAI,CAAC,SACL,MAAM,CAAC,CACJ,UAAW,EAAS,SAAS,CAC7B,KAAM,EAAS,IAAI,AACvB,GACC,EAAE,CAAC,KAAM,EAAS,IAAI,CAAC,EAAE,EAQ9B,OANI,IACA,QAAQ,CADK,IACA,CAAC,gBAAiB,GAE/B,QAAQ,IAAI,CAAC,0CAA2C,EAAY,OAAO,GAGxE,CACH,SAAS,EACT,KAAM,CACF,GAAI,EAAS,IAAI,CAAC,EAAE,CACpB,MAAO,EAAS,IAAI,CAAC,KAAK,CAC1B,UAAW,EAAS,SAAS,CAC7B,KAAM,EAAS,IAAI,AACvB,CACJ,CACJ,CAAE,MAAO,EAAY,CAEjB,OADA,QAAQ,KAAK,CAAC,8BAA+B,GACtC,CAAE,MAAO,GAAO,SAAW,OAAO,IAAU,8BAA+B,CACtF,CACJ,0CA1EsB,IAAA,CAAA,EAAA,EAAA,uBAAA,EAAA,EAAA,6CAAA"}