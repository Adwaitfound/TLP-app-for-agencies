module.exports=[87073,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(3130),e=a.i(40695),f=a.i(5522),g=a.i(17171),h=a.i(87682),i=a.i(65733),j=a.i(15618),k=a.i(87532),l=a.i(96221),m=a.i(60246),n=a.i(92258),o=a.i(46864),p=a.i(3314),q=a.i(41961),r=a.i(81560),s=a.i(69240),t=a.i(38422),u=a.i(54161),v=a.i(5050),w=(0,v.createServerReference)("40cc7236ea0e9d536a40a43673d7c8d15f6f1f5ada",v.callServer,void 0,v.findSourceMapURL,"createTeamMember"),x=a.i(94861);function y(){let{user:a}=(0,t.useAuth)(),[v,y]=(0,c.useState)([]),[z,A]=(0,c.useState)([]),[B,C]=(0,c.useState)(!0),[D,E]=(0,c.useState)(""),[F,G]=(0,c.useState)("all"),[H,I]=(0,c.useState)(!1),[J,K]=(0,c.useState)(!1),[L,M]=(0,c.useState)(null),[N,O]=(0,c.useState)(""),[P,Q]=(0,c.useState)(""),[R,S]=(0,c.useState)(!1),[T,U]=(0,c.useState)({email:"",full_name:"",role:"project_manager",password:""});async function V(){let a=(0,s.createClient)();C(!0);try{x.debug.log("TEAM","Fetching team members...");let{data:b,error:c}=await a.from("users").select("*").in("role",["admin","project_manager","employee"]).order("full_name");if(c)throw x.debug.error("TEAM","Fetch users error",{message:c.message,code:c.code}),c;if(x.debug.success("TEAM","Team members fetched",{count:b?.length}),c)throw c;let{data:d,error:e}=await a.from("project_team").select("user_id, project_id, role, projects(name, status)");e&&console.warn("Project team table not available:",e.message);let{data:f,error:g}=await a.from("projects").select("*").order("name");if(g)throw g;let h=(d||[]).reduce((a,b)=>(a[b.user_id]||(a[b.user_id]=[]),a[b.user_id].push(b),a),{}),i=(b||[]).map(a=>({...a,projects:h[a.id]||[]}));y(i),A(f||[])}catch(a){console.error("Error fetching team data:",{message:a?.message,code:a?.code,details:a?.details,hint:a?.hint})}finally{C(!1)}}async function W(b){if(b.preventDefault(),!L||!N||R)return;S(!0);let c=(0,s.createClient)();try{let{error:b}=await c.from("project_team").insert({project_id:N,user_id:L.id,role:P||null,assigned_by:a?.id});if(b)throw b;I(!1),O(""),Q(""),await V()}catch(a){console.error("Error assigning project:",{message:a?.message,code:a?.code,details:a?.details,hint:a?.hint}),alert(a?.message||"Failed to assign project. The project_team table may not exist yet. Please run migration 008.")}finally{S(!1)}}async function X(a,b){if(!confirm("Remove this team member from the project?"))return;let c=(0,s.createClient)();try{let{error:d}=await c.from("project_team").delete().eq("user_id",a).eq("project_id",b);if(d)throw d;await V()}catch(a){console.error("Error removing assignment:",{message:a?.message,code:a?.code,details:a?.details,hint:a?.hint}),alert(a?.message||"Failed to remove assignment")}}async function Y(a){if(a.preventDefault(),!R){S(!0);try{let a=await w({email:T.email,full_name:T.full_name,role:T.role,password:T.password});if(a.error)throw Error(a.error);K(!1),U({email:"",full_name:"",role:"project_manager",password:""}),await V(),alert(`âœ… Team member added successfully!

Email: ${T.email}
Name: ${T.full_name}
Role: ${"admin"===T.role?"Admin":"Project Manager"}

The team member can now log in immediately at:
${window.location.origin}/login

Login credentials:
â€¢ Email: ${T.email}
â€¢ Password: (the password you just set)

ðŸ’¡ Tip: Share these credentials securely and recommend they change their password in Settings after first login.`)}catch(b){console.error("Error adding team member:",{message:b?.message,code:b?.code,details:b?.details,hint:b?.hint});let a="Failed to add team member.";b?.message?.includes("already registered")||b?.message?.includes("already exists")?a="This email is already registered. Please use a different email.":b?.message&&(a=b.message),alert(a)}finally{S(!1)}}}(0,c.useEffect)(()=>{a?.role==="admin"&&V()},[a]);let Z=v.filter(a=>{let b=a.full_name?.toLowerCase().includes(D.toLowerCase())||a.email.toLowerCase().includes(D.toLowerCase()),c="all"===F||a.role===F;return b&&c});return a?.role!=="admin"?(0,b.jsxs)("div",{className:"flex flex-col items-center justify-center py-12",children:[(0,b.jsx)(p.Shield,{className:"h-12 w-12 text-muted-foreground mb-4"}),(0,b.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Admin Access Required"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Only administrators can manage team members"})]}):(0,b.jsxs)("div",{className:"flex flex-col gap-4 md:gap-6",children:[(0,b.jsxs)("div",{className:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-2xl md:text-3xl font-bold tracking-tight",children:"Team Members"}),(0,b.jsx)("p",{className:"text-sm md:text-base text-muted-foreground",children:"Manage team members and project assignments"})]}),(0,b.jsxs)(e.Button,{onClick:()=>K(!0),children:[(0,b.jsx)(j.Plus,{className:"mr-2 h-4 w-4"}),"Add Team Member"]})]}),!B&&v.length>0&&(0,b.jsxs)("div",{className:"grid gap-4 grid-cols-2 md:grid-cols-3",children:[(0,b.jsxs)(d.Card,{children:[(0,b.jsxs)(d.CardHeader,{className:"pb-2",children:[(0,b.jsx)(d.CardDescription,{className:"text-xs",children:"Total Members"}),(0,b.jsx)(d.CardTitle,{className:"text-2xl",children:v.length})]}),(0,b.jsx)(d.CardContent,{children:(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"Active team members"})})]}),(0,b.jsxs)(d.Card,{children:[(0,b.jsxs)(d.CardHeader,{className:"pb-2",children:[(0,b.jsx)(d.CardDescription,{className:"text-xs",children:"Admins"}),(0,b.jsx)(d.CardTitle,{className:"text-2xl",children:v.filter(a=>"admin"===a.role).length})]}),(0,b.jsx)(d.CardContent,{children:(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"System administrators"})})]}),(0,b.jsxs)(d.Card,{children:[(0,b.jsxs)(d.CardHeader,{className:"pb-2",children:[(0,b.jsx)(d.CardDescription,{className:"text-xs",children:"Project Managers"}),(0,b.jsx)(d.CardTitle,{className:"text-2xl",children:v.filter(a=>"project_manager"===a.role).length})]}),(0,b.jsx)(d.CardContent,{children:(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"Project leads"})})]})]}),(0,b.jsxs)("div",{className:"flex flex-col gap-4 md:flex-row md:items-center",children:[(0,b.jsxs)("div",{className:"relative flex-1",children:[(0,b.jsx)(k.Search,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),(0,b.jsx)(f.Input,{placeholder:"Search team members...",className:"pl-8",value:D,onChange:a=>E(a.target.value)})]}),(0,b.jsxs)(h.Select,{value:F,onValueChange:G,children:[(0,b.jsx)(h.SelectTrigger,{className:"w-full md:w-[200px]",children:(0,b.jsx)(h.SelectValue,{placeholder:"Filter by role"})}),(0,b.jsxs)(h.SelectContent,{children:[(0,b.jsx)(h.SelectItem,{value:"all",children:"All Roles"}),(0,b.jsx)(h.SelectItem,{value:"admin",children:"Admins"}),(0,b.jsx)(h.SelectItem,{value:"project_manager",children:"Project Managers"}),(0,b.jsx)(h.SelectItem,{value:"employee",children:"Employees"})]})]})]}),B?(0,b.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,b.jsx)(l.Loader2,{className:"h-8 w-8 animate-spin text-muted-foreground"})}):0===v.length?(0,b.jsx)(d.Card,{children:(0,b.jsxs)(d.CardContent,{className:"flex flex-col items-center justify-center py-12",children:[(0,b.jsx)(m.Users,{className:"h-12 w-12 text-muted-foreground mb-4"}),(0,b.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"No team members yet"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Team members will appear here"})]})}):(0,b.jsx)("div",{className:"grid gap-4",children:0===Z.length?(0,b.jsx)(d.Card,{children:(0,b.jsx)(d.CardContent,{className:"flex flex-col items-center justify-center py-12",children:(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"No team members match your search"})})}):Z.map(a=>(0,b.jsxs)(d.Card,{className:"hover:bg-accent/50 transition-colors",children:[(0,b.jsx)(d.CardHeader,{children:(0,b.jsxs)("div",{className:"flex items-start justify-between",children:[(0,b.jsxs)("div",{className:"flex items-start gap-4",children:[(0,b.jsx)("div",{className:"h-12 w-12 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0",children:(0,b.jsx)("span",{className:"text-lg font-medium",children:a.full_name?.charAt(0)||a.email.charAt(0).toUpperCase()})}),(0,b.jsxs)("div",{children:[(0,b.jsx)(d.CardTitle,{className:"text-xl",children:a.full_name||"Unnamed User"}),(0,b.jsxs)(d.CardDescription,{className:"flex items-center gap-2 mt-1",children:[(0,b.jsx)(n.Mail,{className:"h-3 w-3"}),a.email]})]})]}),(0,b.jsxs)(u.Badge,{className:(a=>{switch(a){case"admin":return"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200";case"project_manager":return"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200";default:return"bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-200"}})(a.role),children:[(0,b.jsx)("span",{className:"mr-1",children:(a=>{switch(a){case"admin":return(0,b.jsx)(p.Shield,{className:"h-4 w-4"});case"project_manager":return(0,b.jsx)(q.Briefcase,{className:"h-4 w-4"});default:return(0,b.jsx)(o.UserCheck,{className:"h-4 w-4"})}})(a.role)}),a.role.replace("_"," ")]})]})}),(0,b.jsx)(d.CardContent,{className:"space-y-4",children:(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,b.jsx)("h4",{className:"text-sm font-semibold",children:"Project Assignments"}),(0,b.jsxs)(e.Button,{size:"sm",variant:"outline",onClick:()=>{M(a),I(!0)},children:[(0,b.jsx)(j.Plus,{className:"h-3 w-3 mr-1"}),"Assign Project"]})]}),a.projects&&a.projects.length>0?(0,b.jsx)("div",{className:"space-y-2",children:a.projects.map(c=>(0,b.jsxs)("div",{className:"flex items-center justify-between rounded-lg border px-3 py-2",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm font-medium",children:c.projects?.name||"Unknown Project"}),c.role&&(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:c.role})]}),(0,b.jsx)(e.Button,{variant:"ghost",size:"sm",onClick:()=>X(a.id,c.project_id),children:(0,b.jsx)(r.Trash2,{className:"h-4 w-4 text-destructive"})})]},c.project_id))}):(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"No project assignments yet"})]})})]},a.id))}),(0,b.jsx)(i.Dialog,{open:H,onOpenChange:I,children:(0,b.jsx)(i.DialogContent,{children:(0,b.jsxs)("form",{onSubmit:W,children:[(0,b.jsxs)(i.DialogHeader,{children:[(0,b.jsx)(i.DialogTitle,{children:"Assign Project"}),(0,b.jsxs)(i.DialogDescription,{children:["Assign ",L?.full_name||L?.email," to a project"]})]}),(0,b.jsxs)("div",{className:"grid gap-4 py-4",children:[(0,b.jsxs)("div",{className:"grid gap-2",children:[(0,b.jsx)(g.Label,{htmlFor:"project",children:"Project *"}),(0,b.jsxs)(h.Select,{value:N,onValueChange:O,required:!0,children:[(0,b.jsx)(h.SelectTrigger,{id:"project",children:(0,b.jsx)(h.SelectValue,{placeholder:"Select a project"})}),(0,b.jsx)(h.SelectContent,{children:0===z.length?(0,b.jsx)(h.SelectItem,{value:"none",disabled:!0,children:"No projects available"}):z.filter(a=>!L?.projects?.find(b=>b.project_id===a.id)).map(a=>(0,b.jsx)(h.SelectItem,{value:a.id,children:a.name},a.id))})]})]}),(0,b.jsxs)("div",{className:"grid gap-2",children:[(0,b.jsx)(g.Label,{htmlFor:"project-role",children:"Role (Optional)"}),(0,b.jsx)(f.Input,{id:"project-role",placeholder:"e.g., Lead Editor, Designer",value:P,onChange:a=>Q(a.target.value)})]})]}),(0,b.jsxs)(i.DialogFooter,{children:[(0,b.jsx)(e.Button,{type:"button",variant:"outline",onClick:()=>I(!1),disabled:R,children:"Cancel"}),(0,b.jsxs)(e.Button,{type:"submit",disabled:R||!N,children:[R&&(0,b.jsx)(l.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Assign Project"]})]})]})})}),(0,b.jsx)(i.Dialog,{open:J,onOpenChange:K,children:(0,b.jsx)(i.DialogContent,{children:(0,b.jsxs)("form",{onSubmit:Y,children:[(0,b.jsxs)(i.DialogHeader,{children:[(0,b.jsx)(i.DialogTitle,{children:"Add Team Member"}),(0,b.jsx)(i.DialogDescription,{children:"Create a new team member account. They can log in immediately after creation."})]}),(0,b.jsxs)("div",{className:"grid gap-4 py-4",children:[(0,b.jsxs)("div",{className:"grid gap-2",children:[(0,b.jsx)(g.Label,{htmlFor:"member-email",children:"Email *"}),(0,b.jsx)(f.Input,{id:"member-email",type:"email",placeholder:"john@example.com",required:!0,value:T.email,onChange:a=>U({...T,email:a.target.value})})]}),(0,b.jsxs)("div",{className:"grid gap-2",children:[(0,b.jsx)(g.Label,{htmlFor:"member-name",children:"Full Name *"}),(0,b.jsx)(f.Input,{id:"member-name",placeholder:"John Doe",required:!0,value:T.full_name,onChange:a=>U({...T,full_name:a.target.value})})]}),(0,b.jsxs)("div",{className:"grid gap-2",children:[(0,b.jsx)(g.Label,{htmlFor:"member-role",children:"Role *"}),(0,b.jsxs)(h.Select,{value:T.role,onValueChange:a=>U({...T,role:a}),required:!0,children:[(0,b.jsx)(h.SelectTrigger,{id:"member-role",children:(0,b.jsx)(h.SelectValue,{placeholder:"Select a role"})}),(0,b.jsxs)(h.SelectContent,{children:[(0,b.jsx)(h.SelectItem,{value:"project_manager",children:"Project Manager"}),(0,b.jsx)(h.SelectItem,{value:"admin",children:"Admin"}),(0,b.jsx)(h.SelectItem,{value:"employee",children:"Employee"})]})]})]}),(0,b.jsxs)("div",{className:"grid gap-2",children:[(0,b.jsx)(g.Label,{htmlFor:"member-password",children:"Temporary Password *"}),(0,b.jsx)(f.Input,{id:"member-password",type:"password",placeholder:"Minimum 6 characters",required:!0,minLength:6,value:T.password,onChange:a=>U({...T,password:a.target.value})}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"Set a temporary password. User should change it after first login."})]}),(0,b.jsx)("div",{className:"rounded-lg bg-muted p-3",children:(0,b.jsxs)("p",{className:"text-xs text-muted-foreground",children:[(0,b.jsx)("strong",{children:"âœ¨ Instant Access:"}),(0,b.jsx)("br",{}),"â€¢ Account is created and ready immediately",(0,b.jsx)("br",{}),"â€¢ No email confirmation required",(0,b.jsx)("br",{}),"â€¢ User can log in right away",(0,b.jsx)("br",{}),"â€¢ Share the login URL and credentials securely"]})})]}),(0,b.jsxs)(i.DialogFooter,{children:[(0,b.jsx)(e.Button,{type:"button",variant:"outline",onClick:()=>K(!1),disabled:R,children:"Cancel"}),(0,b.jsxs)(e.Button,{type:"submit",disabled:R,children:[R&&(0,b.jsx)(l.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Add Team Member"]})]})]})})})]})}a.s(["default",()=>y],87073)}];

//# sourceMappingURL=app_dashboard_team_page_tsx_69315273._.js.map