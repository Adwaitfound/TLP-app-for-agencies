module.exports=[35112,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored["react-ssr"].ReactDOM},30553,a=>{"use strict";var b=a.i(72131);a.i(35112);var c=a.i(11011),d=a.i(87924),e=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"].reduce((a,e)=>{let f=(0,c.createSlot)(`Primitive.${e}`),g=b.forwardRef((a,b)=>{let{asChild:c,...g}=a;return(0,d.jsx)(c?f:e,{...g,ref:b})});return g.displayName=`Primitive.${e}`,{...a,[e]:g}},{});a.s(["Primitive",()=>e])},5522,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(97895);let e=c.forwardRef(({className:a,type:c,...e},f)=>(0,b.jsx)("input",{type:c,className:(0,d.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",a),ref:f,...e}));e.displayName="Input",a.s(["Input",()=>e])},17171,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(30553),e=c.forwardRef((a,c)=>(0,b.jsx)(d.Primitive.label,{...a,ref:c,onMouseDown:b=>{b.target.closest("button, input, select, textarea")||(a.onMouseDown?.(b),!b.defaultPrevented&&b.detail>1&&b.preventDefault())}}));e.displayName="Label";var f=a.i(187),g=a.i(97895);let h=(0,f.cva)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),i=c.forwardRef(({className:a,...c},d)=>(0,b.jsx)(e,{ref:d,className:(0,g.cn)(h(),a),...c}));i.displayName=e.displayName,a.s(["Label",()=>i],17171)},64791,a=>{"use strict";let b=(0,a.i(70106).default)("video",[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5",key:"ftymec"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2",key:"158x01"}]]);a.s(["Video",()=>b],64791)},27475,a=>{"use strict";var b=a.i(5050),c=(0,b.createServerReference)("40ccf2a3dde700e871dd0ca51628e0652e1064d905",b.callServer,void 0,b.findSourceMapURL,"registerPendingUser");a.s(["registerPendingUser",()=>c])},57523,a=>{"use strict";var b=a.i(5050),c=(0,b.createServerReference)("407dfc82b3267d99c51cea5a0a0ab48bad3c28a250",b.callServer,void 0,b.findSourceMapURL,"forceConfirmEmail");a.s(["forceConfirmEmail",()=>c])},83694,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50944),e=a.i(3130),f=a.i(40695),g=a.i(5522),h=a.i(17171),i=a.i(64791),j=a.i(69240),k=a.i(94861),l=a.i(57523),m=a.i(27475);function n(){let[a,n]=(0,c.useState)(""),[o,p]=(0,c.useState)(""),[q,r]=(0,c.useState)(!1),[s,t]=(0,c.useState)(null),u=(0,d.useRouter)(),v=(0,j.createClient)();(0,c.useEffect)(()=>((async()=>{try{await v.auth.signOut()}catch(a){k.debug.warn("LOGIN","Initial signOut on login mount failed",{message:a?.message})}})(),setTimeout(()=>{n(""),p("");let a=document.getElementById("email"),b=document.getElementById("password");a&&(a.value=""),b&&(b.value="")},100),()=>{n(""),p("")}),[]);let w=async b=>{b.preventDefault(),r(!0),t(null);let c=setTimeout(()=>{console.error("Login timeout - taking longer than expected"),r(!1),t("Login is taking too long. Please try again.")},1e4);try{await v.auth.signOut(),console.log("Step 1: Attempting login with:",a),k.debug.log("LOGIN","Attempting login",{email:a});let{data:b,error:d}=await v.auth.signInWithPassword({email:a,password:o});if(console.log("Step 2: Auth response received",{authError:d?.message,userId:b?.user?.id,authenticatedEmail:b?.user?.email}),d){if(d?.code==="email_not_confirmed"){k.debug.warn("LOGIN","Email not confirmed, attempting server-side confirm",{email:a});let c=await (0,l.forceConfirmEmail)(a);if(c.success){k.debug.success("LOGIN","Email confirmed server-side, retrying login",{userId:c.userId});let e=await v.auth.signInWithPassword({email:a,password:o});b=e.data,d=e.error}}if(d)throw console.error("Auth error:",d),d}if(!b.user)throw Error("No user returned from authentication");console.log("Step 3: User authenticated:",b.user.id),k.debug.success("LOGIN","User authenticated",{userId:b.user.id}),console.log("Step 4: Fetching user profile...");let{data:e,error:f}=await v.from("users").select("*").eq("id",b.user.id);console.log("Step 5: User profile response",{error:f?.message,rowCount:e?.length,role:e?.[0]?.role}),f&&console.error("User data error:",{message:f.message,code:f.code,details:f.details});let g=e&&e.length>0?e[0]:null;if(!g){console.error("User profile not found by id; trying email lookup:",b.user.id);let{data:c}=await v.from("users").select("*").eq("email",b.user.email).limit(1);if(c&&c.length>0)g=c[0];else{let c=b.user.user_metadata?.role||"project_manager",d=await (0,m.registerPendingUser)({id:b.user.id,email:b.user.email,full_name:b.user.user_metadata?.full_name||a.split("@")[0],role:c,company_name:b.user.user_metadata?.company_name||null});if(!d.success)throw console.error("Failed to create user profile via server action:",d.error),Error("Failed to create user profile. Please contact support.");let{data:e}=await v.from("users").select("*").eq("id",b.user.id).limit(1);if(!(g=e?.[0]||null))throw Error("Profile creation completed but could not load profile. Please retry.")}}if(console.log("Step 6: User data fetched, redirecting based on role:",g.role),k.debug.success("LOGIN","Profile fetched",{role:g.role,email:g.email}),"client"===g.role){let a=g.status||"pending";if("approved"!==a){k.debug.warn("LOGIN","Blocked pending/rejected client",{status:a,email:g.email}),await v.auth.signOut(),clearTimeout(c),t("rejected"===a?"Your account was rejected. Please contact support.":"Your account is pending admin approval. Please wait for an approval email.");return}}await new Promise(a=>setTimeout(a,500)),"admin"===g.role?(console.log("Redirecting to admin dashboard"),u.push("/dashboard")):"client"===g.role?(console.log("Redirecting to client dashboard"),u.push("/dashboard/client")):(console.log("Redirecting to employee dashboard"),u.push("/dashboard/employee")),clearTimeout(c)}catch(c){let a;console.error("Login error:",c);let b="invalid_grant"===(a=c?.code||c?.status)||c?.message?.toLowerCase().includes("invalid login")?"Invalid email or password":"email_not_confirmed"===a?"Please verify your email before logging in":"rate_limit_exceeded"===a?"Too many attempts. Please wait and try again.":c?.message||"Failed to log in";k.debug.error("LOGIN","Login failed",{message:b,code:c?.code}),t(b)}finally{clearTimeout(c),r(!1)}};return(0,b.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 to-indigo-100 dark:from-gray-900 dark:to-gray-800 p-4",children:(0,b.jsxs)(e.Card,{className:"w-full max-w-md",children:[(0,b.jsxs)(e.CardHeader,{className:"text-center",children:[(0,b.jsx)("div",{className:"mx-auto mb-4 w-16 h-16 rounded-full bg-primary/10 flex items-center justify-center",children:(0,b.jsx)(i.Video,{className:"w-8 h-8 text-primary"})}),(0,b.jsx)(e.CardTitle,{className:"text-2xl",children:"Welcome Back"}),(0,b.jsx)(e.CardDescription,{children:"Sign in to your video production account"})]}),(0,b.jsx)(e.CardContent,{children:(0,b.jsxs)("form",{onSubmit:w,className:"space-y-4",autoComplete:"off",children:[(0,b.jsx)("input",{type:"text",style:{display:"none"},tabIndex:-1,autoComplete:"off"}),(0,b.jsx)("input",{type:"password",style:{display:"none"},tabIndex:-1,autoComplete:"off"}),s&&(0,b.jsx)("div",{className:"p-3 text-sm text-red-500 bg-red-50 dark:bg-red-900/20 rounded-md",children:s}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(h.Label,{htmlFor:"email",children:"Email"}),(0,b.jsx)(g.Input,{id:"email",name:"user-email-login",type:"email",placeholder:"you@example.com",value:a,onChange:a=>n(a.target.value),autoComplete:"off","data-lpignore":"true","data-form-type":"other",required:!0})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(h.Label,{htmlFor:"password",children:"Password"}),(0,b.jsx)(g.Input,{id:"password",name:"user-password-login",type:"password",placeholder:"••••••••",value:o,onChange:a=>p(a.target.value),autoComplete:"new-password","data-lpignore":"true","data-form-type":"other",required:!0})]}),(0,b.jsx)(f.Button,{type:"submit",className:"w-full",disabled:q,children:q?"Signing in...":"Sign In"}),(0,b.jsxs)("div",{className:"text-center text-sm text-muted-foreground space-y-2",children:[(0,b.jsxs)("div",{children:["Don't have an account?"," ",(0,b.jsx)(f.Button,{type:"button",variant:"link",onClick:()=>u.push("/signup"),className:"text-primary p-0 h-auto font-normal",children:"Sign up here"})]}),(0,b.jsx)("div",{children:(0,b.jsx)(f.Button,{type:"button",variant:"link",onClick:()=>u.push("/"),className:"text-muted-foreground",children:"← Back to Home"})})]})]})})]})})}a.s(["default",()=>n])}];

//# sourceMappingURL=_ab736b25._.js.map