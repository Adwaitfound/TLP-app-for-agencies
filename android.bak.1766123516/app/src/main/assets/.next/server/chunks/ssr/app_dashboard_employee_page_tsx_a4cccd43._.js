module.exports=[25712,a=>{"use strict";var b=a.i(87924),c=a.i(38422),d=a.i(72131),e=a.i(50944),f=a.i(35114),g=a.i(3130),h=a.i(54161),i=a.i(40695),j=a.i(2150),k=a.i(65733),l=a.i(87682),m=a.i(5522),n=a.i(46893),o=a.i(17171),p=a.i(15618),q=a.i(67453),r=a.i(65151),s=a.i(92e3),t=a.i(81560),u=a.i(5050),v=(0,u.createServerReference)("407077dfde7a116ae486d76ab40cd50a1dba0a0bf7",u.callServer,void 0,u.findSourceMapURL,"createTask"),w=(0,u.createServerReference)("609962e915a2b373a08c0bbbfedde9f0e153e565b9",u.callServer,void 0,u.findSourceMapURL,"updateTask"),x=(0,u.createServerReference)("405aa6ef311de4fc1dcf524a8ec77eb1514a4cd5e6",u.callServer,void 0,u.findSourceMapURL,"deleteTask"),y=(0,u.createServerReference)("00572e83ec2be9ea7f5328beb33ed7049696a51b55",u.callServer,void 0,u.findSourceMapURL,"getTodayTasks"),z=(0,u.createServerReference)("002677cfdd008f5d83d9c5f60a6f9cdb9be67678b3",u.callServer,void 0,u.findSourceMapURL,"getOverdueTasks"),A=a.i(69240);let B={low:"bg-blue-100 text-blue-800",medium:"bg-yellow-100 text-yellow-800",high:"bg-orange-100 text-orange-800",urgent:"bg-red-100 text-red-800"},C={todo:r.Circle,in_progress:s.AlertCircle,completed:q.CheckCircle2,blocked:s.AlertCircle,cancelled:r.Circle};function D(){let[a,c]=(0,d.useState)([]),[e,f]=(0,d.useState)([]),[j,q]=(0,d.useState)(!0),[s,u]=(0,d.useState)(!1),[D,E]=(0,d.useState)([]),[F,G]=(0,d.useState)(!1),[H,I]=(0,d.useState)(null),[J,K]=(0,d.useState)({title:"",description:"",priority:"medium",due_date:"",project_id:"",proposed_project_name:"",proposed_project_vertical:""}),[L,M]=(0,d.useState)(!1);async function N(){G(!0);let a=(0,A.createClient)();try{let[{data:b},{data:c}]=await Promise.all([a.from("projects").select("id, name").order("created_at",{ascending:!1}).limit(50),a.from("project_team").select("projects(id, name)").limit(50)]),d=[],e=a=>{a&&!d.find(b=>b.id===a.id)&&d.push({id:a.id,name:a.name})},f=Array.isArray(b)?b:[],g=(Array.isArray(c)?c:[]).map(a=>a.projects).filter(Boolean);f.forEach(e),g.forEach(e),E(d)}catch(a){console.error("loadProjects error",a)}finally{G(!1)}}async function O(){q(!0);let[a,b]=await Promise.all([y(),z()]);console.log("[TaskManager] Today tasks response:",a),console.log("[TaskManager] Overdue tasks response:",b),a.data&&(console.log("[TaskManager] Tasks with proposals:",a.data.filter(a=>a.proposed_project_name)),console.log("[TaskManager] Setting tasks state with:",a.data),c(a.data)),b.data&&(console.log("[TaskManager] Setting overdue tasks state with:",b.data),f(b.data)),q(!1)}async function P(a){a.preventDefault();let b={title:J.title,description:J.description,priority:J.priority,due_date:J.due_date,project_id:J.project_id||void 0,proposed_project_name:L?J.proposed_project_name:void 0,proposed_project_vertical:J.proposed_project_vertical||void 0},c=await v(b);c.error?alert(c.error):(u(!1),K({title:"",description:"",priority:"medium",due_date:"",project_id:"",proposed_project_name:"",proposed_project_vertical:""}),M(!1),await O())}async function Q(a){let b="completed"===a.status?"todo":"completed",c=await w(a.id,{status:b});c.error?alert(c.error):await O()}async function R(a){if(confirm("Delete this task?")){I(a),console.log("[handleDeleteTask] ðŸ”µ START - Deleting task:",a);try{let b=await x(a);console.log("[handleDeleteTask] Result:",b),b.error?(console.error("[handleDeleteTask] âŒ Error:",b.error),alert("Failed to delete task: "+b.error)):(console.log("[handleDeleteTask] âœ… Task deleted, reloading..."),await O(),console.log("[handleDeleteTask] âœ… Tasks reloaded"))}catch(a){console.error("[handleDeleteTask] âŒ Exception:",a),alert("Error deleting task: "+String(a))}finally{I(null)}}}if((0,d.useEffect)(()=>{console.log("[TaskManager] Component mounted, loading tasks..."),O(),N()},[]),(0,d.useEffect)(()=>{console.log("[TaskManager] Tasks state changed:",a),console.log("[TaskManager] Overdue tasks state changed:",e)},[a,e]),j)return(0,b.jsx)(g.Card,{children:(0,b.jsx)(g.CardContent,{className:"pt-6",children:(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Loading tasks..."})})});let S=[...e,...a];return(0,b.jsxs)(g.Card,{children:[(0,b.jsxs)(g.CardHeader,{className:"relative",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(g.CardTitle,{children:"My Tasks"}),(0,b.jsx)(g.CardDescription,{children:"Today's priorities and overdue items"})]}),(0,b.jsxs)(k.Dialog,{open:s,onOpenChange:u,children:[(0,b.jsx)(k.DialogTrigger,{asChild:!0,children:(0,b.jsxs)(i.Button,{size:"sm",className:"absolute top-4 right-4",children:[(0,b.jsx)(p.Plus,{className:"h-4 w-4 mr-2"}),"Add Task"]})}),(0,b.jsxs)(k.DialogContent,{children:[(0,b.jsxs)(k.DialogHeader,{children:[(0,b.jsx)(k.DialogTitle,{children:"Create New Task"}),(0,b.jsx)(k.DialogDescription,{children:"Add a new task to your list. You can propose a new project if needed."})]}),(0,b.jsxs)("form",{onSubmit:P,className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(o.Label,{htmlFor:"title",children:"Task Title"}),(0,b.jsx)(m.Input,{id:"title",value:J.title,onChange:a=>K({...J,title:a.target.value}),required:!0})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(o.Label,{htmlFor:"description",children:"Description"}),(0,b.jsx)(n.Textarea,{id:"description",value:J.description,onChange:a=>K({...J,description:a.target.value}),rows:3})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(o.Label,{htmlFor:"priority",children:"Priority"}),(0,b.jsxs)(l.Select,{value:J.priority,onValueChange:a=>K({...J,priority:a}),children:[(0,b.jsx)(l.SelectTrigger,{children:(0,b.jsx)(l.SelectValue,{})}),(0,b.jsxs)(l.SelectContent,{children:[(0,b.jsx)(l.SelectItem,{value:"low",children:"Low"}),(0,b.jsx)(l.SelectItem,{value:"medium",children:"Medium"}),(0,b.jsx)(l.SelectItem,{value:"high",children:"High"}),(0,b.jsx)(l.SelectItem,{value:"urgent",children:"Urgent"})]})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(o.Label,{htmlFor:"due_date",children:"Due Date"}),(0,b.jsx)(m.Input,{id:"due_date",type:"date",value:J.due_date,onChange:a=>K({...J,due_date:a.target.value})})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(o.Label,{children:"Project"}),(0,b.jsxs)(l.Select,{value:L?"propose_new":J.project_id||"",onValueChange:a=>{"propose_new"===a?(M(!0),K({...J,project_id:"",proposed_project_name:""})):(M(!1),K({...J,project_id:a,proposed_project_name:""}))},disabled:F,children:[(0,b.jsx)(l.SelectTrigger,{children:(0,b.jsx)(l.SelectValue,{placeholder:F?"Loading projects...":"Select project"})}),(0,b.jsxs)(l.SelectContent,{children:[D.map(a=>(0,b.jsx)(l.SelectItem,{value:a.id,children:a.name},a.id)),(0,b.jsx)(l.SelectItem,{value:"propose_new",children:"+ Propose new project"})]})]}),L&&(0,b.jsxs)("div",{className:"mt-2 space-y-2",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(o.Label,{htmlFor:"proposed_project_name",children:"Proposed Project Name"}),(0,b.jsx)(m.Input,{id:"proposed_project_name",value:J.proposed_project_name,onChange:a=>K({...J,proposed_project_name:a.target.value}),placeholder:"e.g., New Client Campaign",required:!0})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(o.Label,{htmlFor:"proposed_project_vertical",children:"Vertical"}),(0,b.jsxs)(l.Select,{value:J.proposed_project_vertical,onValueChange:a=>K({...J,proposed_project_vertical:a}),children:[(0,b.jsx)(l.SelectTrigger,{id:"proposed_project_vertical",children:(0,b.jsx)(l.SelectValue,{placeholder:"Select vertical"})}),(0,b.jsxs)(l.SelectContent,{children:[(0,b.jsx)(l.SelectItem,{value:"video_production",children:"ðŸŽ¬ Video Production"}),(0,b.jsx)(l.SelectItem,{value:"social_media",children:"ðŸ“± Social Media"}),(0,b.jsx)(l.SelectItem,{value:"design_branding",children:"ðŸŽ¨ Design & Branding"})]})]})]})]})]}),(0,b.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,b.jsx)(i.Button,{type:"button",variant:"outline",onClick:()=>u(!1),children:"Cancel"}),(0,b.jsx)(i.Button,{type:"submit",children:"Create Task"})]})]})]})]})]}),(0,b.jsx)(g.CardContent,{children:0===S.length?(0,b.jsx)("p",{className:"text-sm text-muted-foreground text-center py-8",children:"No tasks for today. Create one to get started!"}):(0,b.jsx)("div",{className:"space-y-3",children:S.map(a=>{let c=C[a.status]||r.Circle,d=a.due_date&&new Date(a.due_date)<new Date&&"completed"!==a.status;return(0,b.jsxs)("div",{className:`flex items-start gap-3 p-3 border rounded-lg hover:bg-accent transition-colors ${"completed"===a.status?"opacity-60":""}`,children:[(0,b.jsx)("button",{onClick:()=>Q(a),className:"mt-1",children:(0,b.jsx)(c,{className:`h-5 w-5 ${"completed"===a.status?"text-green-600":"text-muted-foreground"}`})}),(0,b.jsx)("div",{className:"flex-1 min-w-0",children:(0,b.jsxs)("div",{className:"flex items-start justify-between gap-2",children:[(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("p",{className:`font-medium ${"completed"===a.status?"line-through":""}`,children:a.title}),a.description&&(0,b.jsx)("p",{className:"text-sm text-muted-foreground mt-1 line-clamp-2",children:a.description}),(0,b.jsxs)("div",{className:"flex items-center gap-2 mt-2",children:[(0,b.jsx)(h.Badge,{className:B[a.priority],children:a.priority}),a.due_date&&(0,b.jsxs)("span",{className:`text-xs ${d?"text-red-600 font-medium":"text-muted-foreground"}`,children:[d?"Overdue: ":"Due: ",new Date(a.due_date).toLocaleDateString()]}),a.proposed_project_name&&(0,b.jsxs)(h.Badge,{variant:"outline",className:"text-[11px]",children:["Pending project: ",a.proposed_project_name," (",a.proposed_project_status||"pending",")"]}),(a.proposed_project_name||a.proposed_project_status)&&console.log("[TaskManager] Task with proposal:",a.id,a.proposed_project_name,a.proposed_project_status),a.projects?.name&&(0,b.jsxs)("span",{className:"text-xs text-muted-foreground",children:["â€¢ ",a.projects.name]})]})]}),(0,b.jsx)(i.Button,{variant:"ghost",size:"sm",onClick:()=>R(a.id),disabled:H===a.id,children:H===a.id?(0,b.jsx)("span",{className:"text-xs",children:"Deleting..."}):(0,b.jsx)(t.Trash2,{className:"h-4 w-4 text-muted-foreground"})})]})})]},a.id)})})})]})}var E=a.i(39786),F=a.i(41800),G=a.i(41961),H=a.i(15659),I=a.i(73570),J=a.i(45842),K=a.i(63416),L=a.i(41675),M=a.i(50522),N=a.i(24669),O=a.i(41710),P=a.i(64791),Q=a.i(46864),R=a.i(60246),S=a.i(87534),T=a.i(35487);function U(){let{user:a,loading:m}=(0,c.useAuth)(),n=(0,e.useRouter)(),[o,q]=(0,d.useState)(!0),[r,t]=(0,d.useState)([]),[u,v]=(0,d.useState)([]),[w,x]=(0,d.useState)(null),[y,z]=(0,d.useState)(null),[B,C]=(0,d.useState)([]),[U,V]=(0,d.useState)([]),[W,X]=(0,d.useState)([]),[Y,Z]=(0,d.useState)([]),[$,_]=(0,d.useState)(),[aa,ab]=(0,d.useState)(!1),[ac,ad]=(0,d.useState)(!1),[ae,af]=(0,d.useState)({activeProjects:0,tasksToday:0,overdueTasks:0,upcomingMilestones:0});(0,d.useEffect)(()=>{!async function(){if(!a||m)return;q(!0);let b=(0,A.createClient)(),c=new Date().toISOString().split("T")[0];try{let[d,e]=await Promise.all([b.from("projects").select("id,name,status,deadline,progress_percentage,start_date,description,clients(company_name)").eq("created_by",a.id).limit(10),b.from("project_team").select("project_id,projects(id,name,status,deadline,progress_percentage,start_date,description,clients(company_name))").eq("user_id",a.id).limit(10)]),f=[],g=d.data||[],h=(e.data||[]).map(a=>a.projects).filter(Boolean),i=a=>({...a,clients:Array.isArray(a.clients)?a.clients[0]:a.clients});for(let a of g){let b=i(a);f.find(a=>a.id===b.id)||f.push(b)}for(let a of h){let b=i(a);f.find(a=>a.id===b.id)||f.push(b)}let j=f.map(a=>a.id),k=j.length?b.from("milestones").select("id,title,due_date,status,project_id,projects(name)").in("project_id",j).in("status",["pending","in_progress"]).order("due_date",{ascending:!0}).limit(5):Promise.resolve({data:[]}),[l,m,n]=await Promise.all([b.from("employee_tasks").select("id").eq("user_id",a.id).or(`due_date.eq.${c},status.eq.in_progress`),b.from("employee_tasks").select("id").eq("user_id",a.id).lt("due_date",c).neq("status","completed").neq("status","cancelled"),k]);t(f),v(n.data||[]),af({activeProjects:f.filter(a=>"completed"!==a.status&&"cancelled"!==a.status).length,tasksToday:l.data?.length||0,overdueTasks:m.data?.length||0,upcomingMilestones:n.data?.length||0})}catch(a){console.error("Failed to load employee dashboard",a)}finally{q(!1)}}()},[a?.id,m]),(0,d.useEffect)(()=>{y&&console.log("[employee-view] detailProject set",{id:y.id,name:y.name,drive_folder_url:y.drive_folder_url})},[y]),(0,d.useEffect)(()=>{console.log("[employee-view] detailFiles updated",Y)},[Y]),(0,d.useEffect)(()=>{console.log("[employee-view] detailTeam updated",W)},[W]);let ag=async b=>{ab(!0);let c=(0,A.createClient)();try{console.log("[employee-view] loadProjectDetails start",b);let{data:d}=await c.from("projects").select("*, clients(company_name)").eq("id",b).single();d&&(console.log("[employee-view] projectData",d),z(d));let{data:e}=await c.from("milestones").select("*").eq("project_id",b).order("due_date",{ascending:!0});e&&(console.log("[employee-view] milestonesData",e),C(e));let{data:f}=await c.from("sub_projects").select("*, assigned_user:users!sub_projects_assigned_to_fkey(id, email, full_name)").eq("parent_project_id",b);f&&(console.log("[employee-view] subProjectsData",f),V(f));let{data:g}=await c.from("project_files").select("id, project_id, file_name, file_url, file_type, file_category, storage_type, file_size, created_at, description").eq("project_id",b).order("created_at",{ascending:!1});g&&(console.log("[employee-view] filesData",g),Z(g));let{data:h,error:i}=await c.from("project_team").select("project_id, user_id, users:users!project_team_user_id_fkey(id, email, full_name, role)").eq("project_id",b);if(i&&(console.error("[employee-view] team fetch error",{projectId:b,teamError:i}),_({projectId:b,viewerId:a?.id,rows:0,error:i.message})),h){console.log("[employee-view] raw teamData",h);let c=h.map(a=>a.users).filter(Boolean);console.log("[employee-view] teamData mapped",c),X(c),0===c.length&&console.warn("[employee-view] teamData mapped is empty",{projectId:b,userId:a?.id}),_({projectId:b,viewerId:a?.id,rows:c.length,error:void 0})}}catch(c){console.error("Error loading project details:",c),_({projectId:b,viewerId:a?.id,rows:0,error:c.message})}finally{ab(!1)}},ah=async(b,c)=>{ad(!0);let d=(0,A.createClient)();try{let{error:e}=await d.from("sub_projects").update({status:c}).eq("id",b);if(!e){V(U.map(a=>a.id===b?{...a,status:c}:a));let e=U.find(a=>a.id===b);if(e&&e.assigned_to===a?.id){let b=e.project_id||e.parent_project_id||y?.id;b&&await d.from("employee_tasks").update({status:c}).eq("project_id",b).eq("user_id",a?.id).eq("title",e.name)}}}catch(a){console.error("Error updating status:",a)}finally{ad(!1)}},ai=async(b,c)=>{ad(!0);let d=(0,A.createClient)();try{let{error:e}=await d.from("sub_projects").update({progress_percentage:c}).eq("id",b);if(!e){V(U.map(a=>a.id===b?{...a,progress_percentage:c}:a));let e=U.find(a=>a.id===b);if(e&&e.assigned_to===a?.id){let b=e.project_id||e.parent_project_id||y?.id;b&&await d.from("employee_tasks").update({progress_percentage:c}).eq("project_id",b).eq("user_id",a?.id).eq("title",e.name)}}}catch(a){console.error("Error updating progress:",a)}finally{ad(!1)}};if(m||o)return(0,b.jsx)("div",{className:"flex items-center justify-center h-96",children:(0,b.jsx)("p",{className:"text-muted-foreground",children:"Loading your dashboard..."})});let aj=r.slice(0,5);return(0,b.jsxs)("div",{className:"flex flex-col gap-4 md:gap-6",children:[(0,b.jsxs)("div",{className:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-2xl md:text-3xl font-bold tracking-tight",children:"My Work"}),(0,b.jsx)("p",{className:"text-sm md:text-base text-muted-foreground mt-1",children:"Welcome back! Here's an overview of your tasks and projects."})]}),(0,b.jsxs)("div",{className:"flex flex-col sm:flex-row gap-2",children:[(0,b.jsxs)(i.Button,{onClick:()=>n.push("/dashboard/projects"),className:"w-full sm:w-auto",children:[(0,b.jsx)(K.FolderKanban,{className:"h-4 w-4 mr-2"}),"My Projects"]}),(0,b.jsxs)(i.Button,{variant:"outline",onClick:()=>n.push("/dashboard/settings"),className:"w-full sm:w-auto",children:[(0,b.jsx)(p.Plus,{className:"h-4 w-4 mr-2"}),"Settings"]})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-3",children:[(0,b.jsx)(f.StatCard,{title:"Active Projects",value:ae.activeProjects.toString(),icon:G.Briefcase}),(0,b.jsx)(f.StatCard,{title:"Today's Tasks",value:ae.tasksToday.toString(),icon:H.ListTodo}),(0,b.jsx)(f.StatCard,{title:"Overdue Tasks",value:ae.overdueTasks.toString(),icon:I.AlertTriangle,iconClassName:"text-amber-500"}),(0,b.jsx)(f.StatCard,{title:"Upcoming Milestones",value:ae.upcomingMilestones.toString(),icon:J.CalendarClock})]}),(0,b.jsx)(D,{}),(0,b.jsxs)(g.Card,{children:[(0,b.jsxs)(g.CardHeader,{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(g.CardTitle,{className:"text-lg md:text-xl",children:"My Projects"}),(0,b.jsx)(g.CardDescription,{className:"text-xs md:text-sm",children:"Projects you're currently assigned to"})]}),(0,b.jsxs)(i.Button,{variant:"ghost",size:"sm",className:"self-start sm:self-auto",onClick:()=>n.push("/dashboard/projects"),children:["View All",(0,b.jsx)(M.ChevronRight,{className:"h-4 w-4 ml-1"})]})]}),(0,b.jsx)(g.CardContent,{children:0===aj.length?(0,b.jsxs)("div",{className:"text-center py-8",children:[(0,b.jsx)(K.FolderKanban,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"No projects assigned yet"})]}):(0,b.jsx)("div",{className:"space-y-3",children:aj.map(a=>(0,b.jsxs)("div",{className:"flex items-center justify-between p-3 rounded-lg border hover:bg-accent cursor-pointer transition-colors",onClick:()=>{x(a),ag(a.id)},children:[(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsx)("p",{className:"font-medium truncate",children:a.name}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground truncate",children:a.clients?.company_name||"No client"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-3 flex-shrink-0",children:[null!==a.progress_percentage&&void 0!==a.progress_percentage&&(0,b.jsxs)("div",{className:"text-right",children:[(0,b.jsxs)("p",{className:"text-xs font-medium",children:[a.progress_percentage,"%"]}),(0,b.jsx)(j.Progress,{value:a.progress_percentage,className:"h-1.5 w-16 mt-1"})]}),(0,b.jsx)(E.StatusBadge,{status:a.status||"planning"})]})]},a.id))})})]}),u.length>0&&(0,b.jsxs)(g.Card,{children:[(0,b.jsxs)(g.CardHeader,{children:[(0,b.jsx)(g.CardTitle,{children:"Upcoming Milestones"}),(0,b.jsx)(g.CardDescription,{children:"Important deadlines to track"})]}),(0,b.jsx)(g.CardContent,{children:(0,b.jsx)("div",{className:"space-y-3",children:u.map(a=>(0,b.jsxs)("div",{className:"flex items-center justify-between p-3 rounded-lg border",children:[(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[(0,b.jsx)(L.Calendar,{className:"h-4 w-4 mt-1 text-muted-foreground flex-shrink-0"}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsx)("p",{className:"font-medium truncate",children:a.title}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground truncate",children:a.projects?.name||"No project"})]})]}),(0,b.jsxs)("div",{className:"text-right flex-shrink-0",children:[(0,b.jsx)("p",{className:"text-sm font-medium",children:a.due_date?new Date(a.due_date).toLocaleDateString():"No date"}),(0,b.jsx)(h.Badge,{variant:"outline",className:"text-xs mt-1",children:a.status})]})]},a.id))})})]}),ae.overdueTasks>0&&(0,b.jsxs)(g.Card,{className:"border-red-500/50 bg-red-500/5",children:[(0,b.jsxs)(g.CardHeader,{children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(s.AlertCircle,{className:"h-5 w-5 text-red-500"}),(0,b.jsx)(g.CardTitle,{className:"text-red-500",children:"Overdue Tasks"})]}),(0,b.jsxs)(g.CardDescription,{children:["You have ",ae.overdueTasks," task",1!==ae.overdueTasks?"s":""," past their due date"]})]}),(0,b.jsx)(g.CardContent,{children:(0,b.jsx)(i.Button,{variant:"outline",className:"w-full border-red-500/20 text-red-500 hover:bg-red-500/10",onClick:()=>n.push("/dashboard/employee?tab=tasks"),children:"View Overdue Tasks"})})]}),(0,b.jsx)(k.Dialog,{open:!!w,onOpenChange:a=>{a||(x(null),z(null),C([]),V([]),X([]),Z([]))},children:(0,b.jsx)(k.DialogContent,{className:"max-w-4xl max-h-[85vh] overflow-y-auto",children:w&&(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsx)(k.DialogHeader,{children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(k.DialogTitle,{className:"text-2xl",children:y?.name||w.name}),(0,b.jsxs)(k.DialogDescription,{className:"mt-2",children:["Client: ",y?.clients?.company_name||w.clients?.company_name||"No client"]})]}),(0,b.jsx)(E.StatusBadge,{status:y?.status||w.status||"planning"})]})}),aa?(0,b.jsx)("div",{className:"flex items-center justify-center py-10",children:(0,b.jsx)("div",{className:"text-sm text-muted-foreground",children:"Loading project details..."})}):y?(0,b.jsxs)("div",{className:"space-y-6 pb-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"font-semibold mb-3",children:"Project Overview"}),(0,b.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[y.start_date&&(0,b.jsxs)("div",{className:"p-3 rounded-lg border",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 text-xs text-muted-foreground mb-1",children:[(0,b.jsx)(L.Calendar,{className:"h-3 w-3"}),"Start Date"]}),(0,b.jsx)("p",{className:"font-semibold text-sm",children:new Date(y.start_date).toLocaleDateString()})]}),y.deadline&&(0,b.jsxs)("div",{className:"p-3 rounded-lg border",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 text-xs text-muted-foreground mb-1",children:[(0,b.jsx)(O.Clock,{className:"h-3 w-3"}),"Deadline"]}),(0,b.jsx)("p",{className:"font-semibold text-sm",children:new Date(y.deadline).toLocaleDateString()})]}),(0,b.jsxs)("div",{className:"p-3 rounded-lg border",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 text-xs text-muted-foreground mb-1",children:[(0,b.jsx)(N.TrendingUp,{className:"h-3 w-3"}),"Progress"]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(j.Progress,{value:y.progress_percentage??0,className:"h-2 flex-1"}),(0,b.jsxs)("span",{className:"font-semibold text-sm",children:[y.progress_percentage??0,"%"]})]})]})]})]}),y.description&&(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"font-semibold mb-2",children:"Description"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:y.description})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"flex items-center justify-between mb-3",children:(0,b.jsxs)("h3",{className:"font-semibold flex items-center gap-2",children:[(0,b.jsx)(H.ListTodo,{className:"h-4 w-4"}),"Sub-Projects / Tasks"]})}),U.length>0?(0,b.jsx)("div",{className:"space-y-2",children:U.map(c=>(0,b.jsx)(g.Card,{className:"hover:border-primary/50 transition-colors",children:(0,b.jsx)(g.CardContent,{className:"p-4",children:(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsxs)("div",{className:"flex items-start justify-between",children:[(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,b.jsx)("h4",{className:"font-medium",children:c.name}),(0,b.jsx)(E.StatusBadge,{status:c.status||"planning"})]}),c.description&&(0,b.jsx)("p",{className:"text-sm text-muted-foreground mb-2",children:c.description}),c.video_url&&(0,b.jsx)("div",{className:"mb-2",children:(0,b.jsxs)("a",{href:c.video_url,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 text-sm text-primary hover:underline",children:[(0,b.jsx)(P.Video,{className:"h-3 w-3"}),"View Video"]})}),(0,b.jsxs)("div",{className:"flex flex-wrap gap-3 text-xs text-muted-foreground",children:[c.assigned_user&&(0,b.jsxs)("div",{className:"flex items-center gap-1",children:[(0,b.jsx)(Q.UserCheck,{className:"h-3 w-3"}),c.assigned_user.full_name||c.assigned_user.email]}),c.due_date&&(0,b.jsxs)("div",{className:"flex items-center gap-1",children:[(0,b.jsx)(L.Calendar,{className:"h-3 w-3"}),new Date(c.due_date).toLocaleDateString()]})]})]}),c.assigned_to===a?.id&&(0,b.jsxs)(l.Select,{value:c.status||"planning",onValueChange:a=>ah(c.id,a),disabled:ac,children:[(0,b.jsx)(l.SelectTrigger,{className:"w-[130px]",children:(0,b.jsx)(l.SelectValue,{})}),(0,b.jsxs)(l.SelectContent,{children:[(0,b.jsx)(l.SelectItem,{value:"planning",children:"Planning"}),(0,b.jsx)(l.SelectItem,{value:"in_progress",children:"In Progress"}),(0,b.jsx)(l.SelectItem,{value:"in_review",children:"In Review"}),(0,b.jsx)(l.SelectItem,{value:"completed",children:"Completed"}),(0,b.jsx)(l.SelectItem,{value:"stuck",children:"Stuck"})]})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(j.Progress,{value:c.progress_percentage??0,className:"h-2 flex-1"}),(0,b.jsxs)("span",{className:"text-xs font-medium w-10 text-right",children:[c.progress_percentage??0,"%"]})]}),c.assigned_to===a?.id&&(0,b.jsx)("input",{type:"range",min:0,max:100,step:1,value:c.progress_percentage??0,onChange:a=>ai(c.id,Number(a.target.value)),className:"w-full cursor-pointer",disabled:ac})]})]})})},c.id))}):(0,b.jsx)(g.Card,{children:(0,b.jsx)(g.CardContent,{className:"pt-6",children:(0,b.jsxs)("div",{className:"text-center py-8 text-muted-foreground text-sm",children:[(0,b.jsx)(H.ListTodo,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),"No tasks yet for this project."]})})})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"flex items-center justify-between mb-3",children:(0,b.jsx)("h3",{className:"font-semibold",children:"Milestones"})}),B.length>0?(0,b.jsx)("div",{className:"space-y-2",children:B.map(a=>(0,b.jsx)(g.Card,{children:(0,b.jsx)(g.CardContent,{className:"p-4",children:(0,b.jsx)("div",{className:"flex items-start justify-between",children:(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,b.jsx)("h4",{className:"font-medium",children:a.title}),(0,b.jsx)(E.StatusBadge,{status:a.status})]}),a.description&&(0,b.jsx)("p",{className:"text-sm text-muted-foreground mb-2",children:a.description}),a.due_date&&(0,b.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Due: ",new Date(a.due_date).toLocaleDateString()]})]})})})},a.id))}):(0,b.jsx)(g.Card,{children:(0,b.jsx)(g.CardContent,{className:"pt-6",children:(0,b.jsxs)("div",{className:"text-center py-8 text-muted-foreground text-sm",children:[(0,b.jsx)(S.CheckSquare,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),"No milestones yet for this project."]})})})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"flex items-center justify-between mb-3",children:(0,b.jsx)("h3",{className:"font-semibold",children:"Team Members"})}),W.length>0?(0,b.jsx)("div",{className:"space-y-2",children:W.map(a=>(0,b.jsx)(g.Card,{children:(0,b.jsx)(g.CardContent,{className:"p-4",children:(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:"h-10 w-10 rounded-full bg-primary/10 flex items-center justify-center",children:(0,b.jsx)("span",{className:"text-sm font-medium",children:a.full_name?.charAt(0)||a.email.charAt(0)})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-medium",children:a.full_name||a.email}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground capitalize",children:a.role?.replace("_"," ")})]})]})})},a.id))}):(0,b.jsx)(g.Card,{children:(0,b.jsx)(g.CardContent,{className:"pt-6",children:(0,b.jsxs)("div",{className:"text-center py-8 text-muted-foreground text-sm",children:[(0,b.jsx)(R.Users,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),"No team members assigned yet.",(0,b.jsxs)("div",{className:"mt-2 text-xs",children:["Debug: projectId ",y?.id||w.id,", viewer ",a?.id,", rows ",$?.rows??"n/a",$?.error?`, error ${$.error}`:""]})]})})})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"flex items-center justify-between mb-3",children:(0,b.jsxs)("h3",{className:"font-semibold flex items-center gap-2",children:[(0,b.jsx)(T.File,{className:"h-4 w-4"}),"Files"]})}),(0,b.jsx)(F.FileManager,{projectId:y.id,driveFolderUrl:y.drive_folder_url,onDriveFolderUpdate:a=>{console.log("[employee-view] Drive folder updated:",a),y.id&&ag(y.id)}})]})]}):(0,b.jsx)("div",{className:"flex items-center justify-center py-10",children:(0,b.jsx)("div",{className:"text-sm text-muted-foreground",children:"Project not found."})})]})})})]})}function V(){let{loading:a}=(0,c.useAuth)();return a?(0,b.jsx)("div",{className:"flex items-center justify-center h-96",children:(0,b.jsx)("p",{className:"text-muted-foreground",children:"Loading..."})}):(0,b.jsx)(U,{})}a.s(["default",()=>V],25712)}];

//# sourceMappingURL=app_dashboard_employee_page_tsx_a4cccd43._.js.map