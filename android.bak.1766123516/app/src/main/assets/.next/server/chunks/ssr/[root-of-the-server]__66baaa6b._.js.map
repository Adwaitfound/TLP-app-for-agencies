{"version":3,"sources":["../../../../app/actions/register-pending-user.ts","../../../../app/actions/force-confirm-email.ts","../../../../.next-internal/server/app/login/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["'use server'\n\nimport { createServiceClient } from '@/lib/supabase/server'\n\nexport async function registerPendingUser(params: {\n    id: string\n    email: string\n    full_name?: string\n    role: 'client' | 'project_manager' | 'admin'\n    company_name?: string | null\n}) {\n    try {\n        const supabase = createServiceClient()\n\n        // Upsert minimal user profile with pending status\n        const { error: upsertError } = await supabase\n            .from('users')\n            .upsert({\n                id: params.id,\n                email: params.email,\n                full_name: params.full_name || params.email.split('@')[0],\n                role: params.role,\n                company_name: params.company_name || null,\n                status: params.role === 'client' ? 'pending' : 'approved',\n            }, { onConflict: 'id' })\n\n        if (upsertError) {\n            return { success: false, error: upsertError.message }\n        }\n\n        return { success: true }\n    } catch (err: any) {\n        return { success: false, error: err?.message || 'Unexpected error registering pending user' }\n    }\n}\n","'use server'\n\nimport { createServiceClient } from '@/lib/supabase/server'\n\nexport async function forceConfirmEmail(email: string) {\n    try {\n        const supabase = createServiceClient()\n        // Find user id in our users table\n        const { data, error } = await supabase\n            .from('users')\n            .select('id, email, status, role')\n            .eq('email', email)\n            .limit(1)\n            .single()\n\n        if (error) {\n            return { success: false, error: error.message }\n        }\n        let targetUserId = data?.id\n\n        // If not found in users table, fallback to admin listUsers and match by email\n        if (!targetUserId) {\n            const { data: listData, error: listError } = await (supabase as any).auth.admin.listUsers({ perPage: 200 })\n            if (listError) {\n                return { success: false, error: listError.message }\n            }\n            const match = listData?.users?.find((u: any) => (u?.email || '').toLowerCase() === email.toLowerCase())\n            if (!match?.id) {\n                return { success: false, error: 'User not found for provided email' }\n            }\n            targetUserId = match.id\n        }\n\n        const { error: confirmError } = await (supabase as any).auth.admin.updateUserById(targetUserId, {\n            email_confirm: true,\n        })\n        if (confirmError) {\n            return { success: false, error: confirmError.message }\n        }\n\n        return { success: true, userId: targetUserId }\n    } catch (err: any) {\n        return { success: false, error: err?.message || 'Unexpected error while confirming email' }\n    }\n}\n","export {logAuditEvent as '4001860d967ff1d29143ee49c09c9bbdff4d1af8fb'} from 'ACTIONS_MODULE0'\nexport {forceConfirmEmail as '407dfc82b3267d99c51cea5a0a0ab48bad3c28a250'} from 'ACTIONS_MODULE1'\nexport {registerPendingUser as '40ccf2a3dde700e871dd0ca51628e0652e1064d905'} from 'ACTIONS_MODULE2'\n"],"names":[],"mappings":"wDAEA,EAAA,EAAA,CAAA,CAAA,OAEO,eAAe,EAAoB,CAMzC,EACG,GAAI,CACA,IAAM,EAAW,CAAA,EAAA,EAAA,mBAAA,AAAmB,IAG9B,CAAE,MAAO,CAAW,CAAE,CAAG,MAAM,EAChC,IAAI,CAAC,SACL,MAAM,CAAC,CACJ,GAAI,EAAO,EAAE,CACb,MAAO,EAAO,KAAK,CACnB,UAAW,EAAO,SAAS,EAAI,EAAO,KAAK,CAAC,KAAK,CAAC,IAAI,CAAC,EAAE,CACzD,KAAM,EAAO,IAAI,CACjB,aAAc,EAAO,YAAY,EAAI,KACrC,OAAwB,WAAhB,EAAO,IAAI,CAAgB,UAAY,UACnD,EAAG,CAAE,WAAY,IAAK,GAE1B,GAAI,EACA,MAAO,CAAE,IADI,KACK,EAAO,MAAO,EAAY,OAAO,AAAC,EAGxD,MAAO,CAAE,SAAS,CAAK,CAC3B,CAAE,MAAO,EAAU,CACf,MAAO,CAAE,QAAS,GAAO,MAAO,GAAK,SAAW,2CAA4C,CAChG,CACJ,0CA9BsB,IAAA,CAAA,EAAA,EAAA,uBAAA,EAAA,EAAA,6CAAA,kFCFtB,EAAA,EAAA,CAAA,CAAA,OAEO,eAAe,EAAkB,CAAa,EACjD,GAAI,CACA,IAAM,EAAW,CAAA,EAAA,EAAA,mBAAA,AAAmB,IAE9B,MAAE,CAAI,OAAE,CAAK,CAAE,CAAG,MAAM,EACzB,IAAI,CAAC,SACL,MAAM,CAAC,2BACP,EAAE,CAAC,QAAS,GACZ,KAAK,CAAC,GACN,MAAM,GAEX,GAAI,EACA,KADO,CACA,CAAE,QAAS,GAAO,MAAO,EAAM,OAAO,AAAC,EAElD,IAAI,EAAe,GAAM,GAGzB,GAAI,CAAC,EAAc,CACf,GAAM,CAAE,KAAM,CAAQ,CAAE,MAAO,CAAS,CAAE,CAAG,MAAO,EAAiB,IAAI,CAAC,KAAK,CAAC,SAAS,CAAC,CAAE,QAAS,GAAI,GACzG,GAAI,EACA,MAAO,CAAE,EADE,OACO,EAAO,MAAO,EAAU,OAAO,AAAC,EAEtD,IAAM,EAAQ,GAAU,OAAO,KAAK,AAAC,GAAW,CAAC,GAAG,OAAS,EAAA,CAAE,CAAE,WAAW,KAAO,EAAM,WAAW,IACpG,GAAI,CAAC,GAAO,GACR,CADY,KACL,CAAE,SAAS,EAAO,MAAO,mCAAoC,EAExE,EAAe,EAAM,EACzB,AAD2B,CAG3B,GAAM,CAAE,MAAO,CAAY,CAAE,CAAG,MAAO,EAAiB,IAAI,CAAC,KAAK,CAAC,cAAc,CAAC,EAAc,CAC5F,eAAe,CACnB,GACA,GAAI,EACA,MAAO,CAAE,KADK,IACI,EAAO,MAAO,EAAa,OAAO,AAAC,EAGzD,MAAO,CAAE,QAAS,GAAM,OAAQ,CAAa,CACjD,CAAE,MAAO,EAAU,CACf,MAAO,CAAE,SAAS,EAAO,MAAO,GAAK,SAAW,yCAA0C,CAC9F,CACJ,0CAxCsB,IAAA,CAAA,EAAA,EAAA,uBAAA,EAAA,EAAA,6CAAA,+DCJtB,IAAA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA"}