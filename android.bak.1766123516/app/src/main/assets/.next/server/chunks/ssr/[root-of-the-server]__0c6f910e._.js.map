{"version":3,"sources":["../../../../app/actions/register-pending-user.ts","../../../../.next-internal/server/app/signup/page/actions.js%20%28server%20actions%20loader%29","../../../../app/actions/admin-signup.ts"],"sourcesContent":["'use server'\n\nimport { createServiceClient } from '@/lib/supabase/server'\n\nexport async function registerPendingUser(params: {\n    id: string\n    email: string\n    full_name?: string\n    role: 'client' | 'project_manager' | 'admin'\n    company_name?: string | null\n}) {\n    try {\n        const supabase = createServiceClient()\n\n        // Upsert minimal user profile with pending status\n        const { error: upsertError } = await supabase\n            .from('users')\n            .upsert({\n                id: params.id,\n                email: params.email,\n                full_name: params.full_name || params.email.split('@')[0],\n                role: params.role,\n                company_name: params.company_name || null,\n                status: params.role === 'client' ? 'pending' : 'approved',\n            }, { onConflict: 'id' })\n\n        if (upsertError) {\n            return { success: false, error: upsertError.message }\n        }\n\n        return { success: true }\n    } catch (err: any) {\n        return { success: false, error: err?.message || 'Unexpected error registering pending user' }\n    }\n}\n","export {logAuditEvent as '4001860d967ff1d29143ee49c09c9bbdff4d1af8fb'} from 'ACTIONS_MODULE0'\nexport {registerPendingUser as '40ccf2a3dde700e871dd0ca51628e0652e1064d905'} from 'ACTIONS_MODULE1'\nexport {adminCreateUserSignup as '402c6d535aade73d322b5373083d5b4b6b869c009c'} from 'ACTIONS_MODULE2'\n","'use server'\n\nimport { createServiceClient } from '@/lib/supabase/server'\n\ntype SignupParams = {\n    email: string\n    password: string\n    full_name: string\n    company_name?: string | null\n    role: 'client' | 'project_manager' | 'admin'\n}\n\nexport async function adminCreateUserSignup(params: SignupParams) {\n    const { email, password, full_name, company_name, role } = params\n    try {\n        const supabase = createServiceClient()\n\n        // Create auth user via admin API, auto-confirm email to avoid login blocker\n        const { data: authData, error: authError } = await (supabase as any).auth.admin.createUser({\n            email,\n            password,\n            email_confirm: true,\n            user_metadata: { full_name, company_name: company_name || null, role }\n        })\n\n        if (authError) {\n            return { success: false, error: authError.message }\n        }\n        const userId = authData?.user?.id\n        if (!userId) {\n            return { success: false, error: 'Auth user creation failed' }\n        }\n\n        // Upsert user profile with pending status for clients\n        const { error: upsertError } = await supabase\n            .from('users')\n            .upsert({\n                id: userId,\n                email,\n                full_name,\n                role,\n                company_name: company_name || null,\n                status: role === 'client' ? 'pending' : 'approved',\n            }, { onConflict: 'id' })\n\n        if (upsertError) {\n            return { success: false, error: upsertError.message }\n        }\n\n        return { success: true, userId }\n    } catch (err: any) {\n        return { success: false, error: err?.message || 'Unexpected error during admin signup' }\n    }\n}\n"],"names":[],"mappings":"wDAEA,EAAA,EAAA,CAAA,CAAA,OAEO,eAAe,EAAoB,CAMzC,EACG,GAAI,CACA,IAAM,EAAW,CAAA,EAAA,EAAA,mBAAA,AAAmB,IAG9B,CAAE,MAAO,CAAW,CAAE,CAAG,MAAM,EAChC,IAAI,CAAC,SACL,MAAM,CAAC,CACJ,GAAI,EAAO,EAAE,CACb,MAAO,EAAO,KAAK,CACnB,UAAW,EAAO,SAAS,EAAI,EAAO,KAAK,CAAC,KAAK,CAAC,IAAI,CAAC,EAAE,CACzD,KAAM,EAAO,IAAI,CACjB,aAAc,EAAO,YAAY,EAAI,KACrC,OAAwB,WAAhB,EAAO,IAAI,CAAgB,UAAY,UACnD,EAAG,CAAE,WAAY,IAAK,GAE1B,GAAI,EACA,MAAO,CAAE,IADI,KACK,EAAO,MAAO,EAAY,OAAO,AAAC,EAGxD,MAAO,CAAE,SAAS,CAAK,CAC3B,CAAE,MAAO,EAAU,CACf,MAAO,CAAE,SAAS,EAAO,MAAO,GAAK,SAAW,2CAA4C,CAChG,CACJ,0CA9BsB,IAAA,CAAA,EAAA,EAAA,uBAAA,EAAA,EAAA,6CAAA,iECJtB,IAAA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,oBCCA,EAAA,EAAA,CAAA,CAAA,OAUO,eAAe,EAAsB,CAAoB,EAC5D,GAAM,OAAE,CAAK,CAAE,UAAQ,WAAE,CAAS,CAAE,cAAY,MAAE,CAAI,CAAE,CAAG,EAC3D,GAAI,CACA,IAAM,EAAW,CAAA,EAAA,EAAA,mBAAA,AAAmB,IAG9B,CAAE,KAAM,CAAQ,CAAE,MAAO,CAAS,CAAE,CAAG,MAAO,EAAiB,IAAI,CAAC,KAAK,CAAC,UAAU,CAAC,OACvF,WACA,EACA,eAAe,EACf,cAAe,WAAE,EAAW,aAAc,GAAgB,KAAM,MAAK,CACzE,GAEA,GAAI,EACA,MAAO,CAAE,EADE,OACO,EAAO,MAAO,EAAU,OAAO,AAAC,EAEtD,IAAM,EAAS,GAAU,MAAM,GAC/B,GAAI,CAAC,EACD,MADS,AACF,CAAE,QAAS,GAAO,MAAO,2BAA4B,EAIhE,GAAM,CAAE,MAAO,CAAW,CAAE,CAAG,MAAM,EAChC,IAAI,CAAC,SACL,MAAM,CAAC,CACJ,GAAI,QACJ,YACA,OACA,EACA,aAAc,GAAgB,KAC9B,OAAiB,WAAT,EAAoB,UAAY,UAC5C,EAAG,CAAE,WAAY,IAAK,GAE1B,GAAI,EACA,MAAO,CAAE,IADI,KACK,EAAO,MAAO,EAAY,OAAO,AAAC,EAGxD,MAAO,CAAE,SAAS,SAAM,CAAO,CACnC,CAAE,MAAO,EAAU,CACf,MAAO,CAAE,SAAS,EAAO,MAAO,GAAK,SAAW,sCAAuC,CAC3F,CACJ,0CAzCsB,IAAA,CAAA,EAAA,EAAA,uBAAA,EAAA,EAAA,6CAAA"}