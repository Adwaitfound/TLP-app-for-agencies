module.exports=[68609,a=>{"use strict";var b=a.i(37936),c=a.i(98310),d=a.i(13095);async function e(a,b,d,e,f){let g=(0,c.createServiceClient)();await g.from("audit_logs").insert({action:a,entity_type:b,entity_id:d,user_id:e,metadata:f||{}})}async function f(a,b){if(!a.length)return;let d=(0,c.createServiceClient)(),{error:e}=await d.from("notifications").insert(a.map(a=>({user_id:a,type:b.type,message:b.message,metadata:b.metadata})));e&&console.warn("notifyUsers insert failed",e.message)}async function g(a){let{projectId:b,authorUserId:d,text:g}=a;try{let a=(0,c.createServiceClient)(),{data:h,error:i}=await a.from("project_comments").insert({project_id:b,user_id:d,comment_text:g}).select("id, project_id, user_id, comment_text, status, created_at, assigned_user_id").single();if(i)return{success:!1,error:i.message};e("create","project_comment",h.id,d,{project_id:b,comment_text:g});let{data:j}=await a.from("users").select("id").in("role",["admin","project_manager"]),k=(j||[]).map(a=>a.id);return await f(k,{type:"comment_created",message:`New comment on a project: ${g.slice(0,80)}`,metadata:{project_id:b,comment_id:h.id}}),{success:!0,comment:h}}catch(a){return{success:!1,error:a?.message||"Unexpected error creating comment"}}}async function h(a){try{let b=(0,c.createServiceClient)(),{data:d,error:e}=await b.from("project_comments").select(`
                id,
                project_id,
                user_id,
                comment_text,
                status,
                created_at,
                assigned_user_id,
                author:user_id(full_name, email),
                assignee:assigned_user_id(full_name, email)
            `).eq("project_id",a).order("created_at",{ascending:!1});if(e)return{success:!1,error:e.message};return{success:!0,comments:d||[]}}catch(a){return{success:!1,error:a?.message||"Unexpected error listing comments"}}}async function i(a){try{let b=(0,c.createServiceClient)(),{data:d,error:g}=await b.from("project_comments").update({assigned_user_id:a.userId}).eq("id",a.commentId).select("id, assigned_user_id, assignee:assigned_user_id(full_name, email)").single();if(g)return{success:!1,error:g.message};e("assign","project_comment",a.commentId,a.userId,{assigned_user_id:a.userId});let{data:h}=await b.from("users").select("id").in("role",["admin","project_manager"]),i=new Set((h||[]).map(a=>a.id));return a.userId&&i.add(a.userId),await f(Array.from(i),{type:"comment_assigned",message:"A comment was assigned",metadata:{comment_id:a.commentId,assigned_user_id:a.userId}}),{success:!0,comment:d}}catch(a){return{success:!1,error:a?.message||"Unexpected error assigning comment"}}}async function j(a){try{let b=(0,c.createServiceClient)(),{error:d}=await b.from("projects").update({client_approved:!0,client_approved_at:new Date().toISOString()}).eq("id",a.projectId);if(d)return{success:!1,error:d.message};return{success:!0}}catch(a){return{success:!1,error:a?.message||"Unexpected error approving project"}}}async function k(a){try{let b=(0,c.createServiceClient)(),{error:d}=await b.from("projects").update({client_approved:!0,client_approved_at:new Date().toISOString()}).eq("id",a.projectId);if(d)return{success:!1,error:d.message};return{success:!0}}catch(a){return{success:!1,error:a?.message||"Unexpected error approving project (admin)"}}}(0,d.ensureServerEntryExports)([e]),(0,b.registerServerReference)(e,"7ccf2ba5d3624f4afaa1cee52562f6e33e69395511",null),(0,d.ensureServerEntryExports)([g,h,i,j,k]),(0,b.registerServerReference)(g,"40a6382be664f50ea66fe39a98d1462f3f57004b5a",null),(0,b.registerServerReference)(h,"40bb02f9168fd9109458766923437b569718746a1e",null),(0,b.registerServerReference)(i,"405c5bdfe2a43767b9832e1c2375adb8b49762ba71",null),(0,b.registerServerReference)(j,"4057388ae1c8d7ff911fc03a5fdfae99a64813f401",null),(0,b.registerServerReference)(k,"409a440394bf231764b61107b4c9d94e82718a164b",null),a.s(["assignCommentToEmployee",()=>i,"clientApproveProject",()=>j,"createProjectComment",()=>g,"listProjectComments",()=>h],68609)},18026,a=>{"use strict";var b=a.i(74779),c=a.i(68609);a.s([],50725),a.i(50725),a.s(["4001860d967ff1d29143ee49c09c9bbdff4d1af8fb",()=>b.logAuditEvent,"405c5bdfe2a43767b9832e1c2375adb8b49762ba71",()=>c.assignCommentToEmployee],18026)},85685,a=>{a.v(b=>Promise.all(["server/chunks/ssr/[externals]_crypto_c412f66b._.js"].map(b=>a.l(b))).then(()=>b(54799)))}];

//# sourceMappingURL=%5Broot-of-the-server%5D__4a6f7e6c._.js.map