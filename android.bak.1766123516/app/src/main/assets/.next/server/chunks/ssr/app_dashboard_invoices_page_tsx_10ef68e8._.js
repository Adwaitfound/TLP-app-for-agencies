module.exports=[22485,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(3130),e=a.i(40695),f=a.i(5522),g=a.i(17171),h=a.i(54161),i=a.i(87682),j=a.i(65733),k=a.i(88237),l=a.i(77156),m=a.i(4720),n=a.i(96221),o=a.i(15618),p=a.i(81560),q=a.i(84505),r=a.i(69240),s=a.i(38422),t=a.i(5050),u=(0,t.createServerReference)("40f54ce617644a4784493e827870e17a65e9273ef2",t.callServer,void 0,t.findSourceMapURL,"uploadInvoiceFile"),v=(0,t.createServerReference)("005e4c4e42c0c2763b1f47fcf35b742542a8e3595f",t.callServer,void 0,t.findSourceMapURL,"fetchInvoicesData"),w=(0,t.createServerReference)("60a1647e99863c4a9ca254b5e3376492d2265241a0",t.callServer,void 0,t.findSourceMapURL,"updateInvoiceStatus"),x=(0,t.createServerReference)("6080e6bd584b0a9051540e8465bc2512b088944e84",t.callServer,void 0,t.findSourceMapURL,"deleteInvoice"),y=(0,t.createServerReference)("400ac50675809b5125de28467cacbc1423e833b418",t.callServer,void 0,t.findSourceMapURL,"getSignedInvoiceUrl");let z={draft:{label:"Draft",variant:"secondary"},sent:{label:"Sent",variant:"default"},paid:{label:"Paid",variant:"default"},overdue:{label:"Overdue",variant:"destructive"},cancelled:{label:"Cancelled",variant:"secondary"}};function A(){let{user:a,loading:t}=(0,s.useAuth)(),[A,B]=(0,c.useState)([]),[C,D]=(0,c.useState)([]),[E,F]=(0,c.useState)([]),[G,H]=(0,c.useState)(!0),[I,J]=(0,c.useState)(!1),[K,L]=(0,c.useState)(!1),M=(0,c.useRef)(!1),N=(0,c.useRef)(null),[O,P]=(0,c.useState)(null),[Q,R]=(0,c.useState)(null),[S,T]=(0,c.useState)(""),[U,V]=(0,c.useState)(""),[W,X]=(0,c.useState)(""),Y=a?.email==="adwait@thelostproject.in";function Z(a,b="success"){N.current&&clearTimeout(N.current),P({message:a,type:b}),N.current=setTimeout(()=>P(null),3e3)}(0,c.useEffect)(()=>{if(!t){if(!Y)return void H(!1);aa()}},[t,Y]);let $=E.filter(a=>!S||a.client_id===S);async function _(a,b){let c=await y(a);if(c.error||!c.signedUrl)return void Z(c.error||"Unable to generate signed URL","error");if(b){let a=document.createElement("a");a.href=c.signedUrl,a.download="invoice.pdf",document.body.appendChild(a),a.click(),document.body.removeChild(a),Z("Download started","success")}else window.open(c.signedUrl,"_blank"),Z("Opening invoice","success")}async function aa(){H(!0);try{let a=await v();if(a.error)throw console.error("Fetch error:",a.error),Error(a.error);B(a.invoices||[]),D(a.clients||[]),F(a.projects||[])}catch(a){console.error("Error loading invoices:",a),Z(a.message||"Failed to load invoices","error")}finally{H(!1)}}async function ab(a){if(a.preventDefault(),!Y)return void alert("Access restricted to adwait@thelostproject.in");if(M.current)return;if(!Q)return void alert("Please select an invoice PDF to upload");if(!S||!W.trim())return void alert("Please fill in all required fields");if(!Q.name.toLowerCase().endsWith(".pdf"))return void alert("Please upload a PDF file");M.current=!0,L(!0);let b=(0,r.createClient)();try{let a=new FormData;a.append("file",Q),a.append("invoiceNumber",W);let c=await u(a);if(!c.success||c.error)throw Error(c.error||"Upload failed");let{publicUrl:d}=c,e=new Date().toISOString().split("T")[0],{data:f,error:g}=await b.from("invoices").insert({client_id:S,project_id:U||null,invoice_number:W,invoice_file_url:d,issue_date:e,due_date:e,status:"draft"}).select("*, clients(company_name), projects(name)").single();if(g)throw console.error("DB insert error details:",g),g;f&&B(a=>[f,...a]),Z("Invoice uploaded","success"),J(!1),R(null),T(""),V(""),X("")}catch(a){console.error("Error uploading invoice:",a),Z(a.message||"Failed to upload invoice","error")}finally{L(!1),M.current=!1}}async function ac(a,b){if(confirm("Are you sure you want to delete this invoice?"))try{let c=await x(a,b);if(c.error)throw Error(c.error);B(b=>b.filter(b=>b.id!==a)),Z("Invoice deleted","success")}catch(a){console.error("Error deleting invoice:",a),Z(a.message||"Failed to delete invoice","error")}}return t?(0,b.jsx)("div",{className:"flex h-96 items-center justify-center",children:(0,b.jsx)("p",{className:"text-muted-foreground",children:"Loading..."})}):Y?(0,b.jsxs)("div",{className:"space-y-6",children:[O?(0,b.jsx)("div",{className:`fixed bottom-4 right-4 z-50 rounded-md px-4 py-3 shadow-lg text-sm text-white ${"success"===O.type?"bg-green-600":"bg-red-600"}`,role:"status",children:O.message}):null,(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h2",{className:"text-3xl font-bold tracking-tight",children:"Invoices"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:"Upload and manage client invoices"})]}),(0,b.jsxs)(e.Button,{onClick:()=>J(!0),children:[(0,b.jsx)(o.Plus,{className:"mr-2 h-4 w-4"}),"Upload Invoice"]})]}),(0,b.jsx)("div",{className:"grid gap-4 md:grid-cols-3",children:(0,b.jsxs)(d.Card,{children:[(0,b.jsxs)(d.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,b.jsx)(d.CardTitle,{className:"text-sm font-medium",children:"Total Invoices"}),(0,b.jsx)(m.FileText,{className:"h-4 w-4 text-muted-foreground"})]}),(0,b.jsx)(d.CardContent,{children:(0,b.jsx)("div",{className:"text-2xl font-bold",children:A.length})})]})}),(0,b.jsxs)(d.Card,{children:[(0,b.jsxs)(d.CardHeader,{children:[(0,b.jsx)(d.CardTitle,{children:"All Invoices"}),(0,b.jsx)(d.CardDescription,{children:"View and manage uploaded invoices"})]}),(0,b.jsx)(d.CardContent,{children:G?(0,b.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,b.jsx)(n.Loader2,{className:"h-8 w-8 animate-spin text-muted-foreground"})}):0===A.length?(0,b.jsxs)("div",{className:"py-12 text-center",children:[(0,b.jsx)(m.FileText,{className:"mx-auto mb-4 h-12 w-12 text-muted-foreground opacity-50"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:"No invoices uploaded yet"})]}):(0,b.jsxs)(k.Table,{children:[(0,b.jsx)(k.TableHeader,{children:(0,b.jsxs)(k.TableRow,{children:[(0,b.jsx)(k.TableHead,{children:"Invoice #"}),(0,b.jsx)(k.TableHead,{children:"Client"}),(0,b.jsx)(k.TableHead,{children:"Project"}),(0,b.jsx)(k.TableHead,{children:"Status"}),(0,b.jsx)(k.TableHead,{children:"Uploaded"}),(0,b.jsx)(k.TableHead,{className:"text-right",children:"Actions"})]})}),(0,b.jsx)(k.TableBody,{children:A.map(a=>(0,b.jsxs)(k.TableRow,{children:[(0,b.jsx)(k.TableCell,{className:"font-medium",children:a.invoice_number}),(0,b.jsx)(k.TableCell,{children:a.clients?.company_name}),(0,b.jsx)(k.TableCell,{children:a.projects?.name||(0,b.jsx)("span",{className:"text-muted-foreground",children:"â€”"})}),(0,b.jsx)(k.TableCell,{children:(0,b.jsxs)(i.Select,{value:a.status,onValueChange:b=>w(a.id,b).then(b=>{b.error?Z(b.error,"error"):b.data&&(B(c=>c.map(c=>c.id===a.id?b.data:c)),Z("Status updated","success"))}),children:[(0,b.jsx)(i.SelectTrigger,{className:"w-auto border-0 bg-transparent",children:(0,b.jsx)(h.Badge,{variant:z[a.status].variant,children:z[a.status].label})}),(0,b.jsxs)(i.SelectContent,{children:[(0,b.jsx)(i.SelectItem,{value:"draft",children:"Draft"}),(0,b.jsx)(i.SelectItem,{value:"sent",children:"Sent"}),(0,b.jsx)(i.SelectItem,{value:"paid",children:"Paid"}),(0,b.jsx)(i.SelectItem,{value:"overdue",children:"Overdue"}),(0,b.jsx)(i.SelectItem,{value:"cancelled",children:"Cancelled"})]})]})}),(0,b.jsx)(k.TableCell,{children:new Date(a.created_at).toLocaleDateString()}),(0,b.jsx)(k.TableCell,{className:"text-right",children:(0,b.jsxs)("div",{className:"flex items-center justify-end gap-2",children:[(0,b.jsx)(e.Button,{variant:"ghost",size:"sm",onClick:()=>_(a.invoice_file_url),title:"View PDF",children:(0,b.jsx)(l.Eye,{className:"h-4 w-4"})}),(0,b.jsx)(e.Button,{variant:"ghost",size:"sm",onClick:()=>_(a.invoice_file_url,!0),title:"Download PDF",children:(0,b.jsx)(q.Download,{className:"h-4 w-4"})}),(0,b.jsx)(e.Button,{variant:"ghost",size:"sm",onClick:()=>ac(a.id,a.invoice_file_url),title:"Delete invoice",children:(0,b.jsx)(p.Trash2,{className:"h-4 w-4"})})]})})]},a.id))})]})})]}),(0,b.jsx)(j.Dialog,{open:I,onOpenChange:a=>{a||(R(null),T(""),V(""),X(""),L(!1),M.current=!1),J(a)},children:(0,b.jsx)(j.DialogContent,{className:"max-w-md",children:(0,b.jsxs)("form",{onSubmit:ab,children:[(0,b.jsxs)(j.DialogHeader,{children:[(0,b.jsx)(j.DialogTitle,{children:"Upload Invoice"}),(0,b.jsx)(j.DialogDescription,{children:"Upload an invoice PDF and select the client and project"})]}),(0,b.jsxs)("div",{className:"space-y-4 py-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(g.Label,{children:"Invoice PDF *"}),(0,b.jsx)(f.Input,{type:"file",accept:".pdf",onChange:a=>R(a.target.files?.[0]||null),className:"mt-1",required:!0}),Q&&(0,b.jsxs)("p",{className:"mt-1 text-xs text-muted-foreground",children:[Q.name," (",(Q.size/1024).toFixed(2)," KB)"]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(g.Label,{children:"Invoice Number *"}),(0,b.jsx)(f.Input,{value:W,onChange:a=>X(a.target.value),className:"mt-1",placeholder:"INV-2024-001",required:!0})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(g.Label,{children:"Client *"}),(0,b.jsxs)(i.Select,{value:S,onValueChange:a=>{T(a),V("")},required:!0,children:[(0,b.jsx)(i.SelectTrigger,{className:"mt-1",children:(0,b.jsx)(i.SelectValue,{placeholder:"Select client"})}),(0,b.jsx)(i.SelectContent,{children:C.map(a=>(0,b.jsx)(i.SelectItem,{value:a.id,children:a.company_name},a.id))})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(g.Label,{children:"Project (Optional)"}),(0,b.jsxs)(i.Select,{value:U,onValueChange:V,disabled:!S,children:[(0,b.jsx)(i.SelectTrigger,{className:"mt-1",children:(0,b.jsx)(i.SelectValue,{placeholder:S?"Select project":"Select client first"})}),(0,b.jsx)(i.SelectContent,{children:$.map(a=>(0,b.jsx)(i.SelectItem,{value:a.id,children:a.name},a.id))})]})]})]}),(0,b.jsxs)(j.DialogFooter,{children:[(0,b.jsx)(e.Button,{type:"button",variant:"outline",onClick:()=>J(!1),disabled:K,children:"Cancel"}),(0,b.jsxs)(e.Button,{type:"submit",disabled:K||!Q,children:[K&&(0,b.jsx)(n.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),K?"Uploading...":"Upload Invoice"]})]})]})})})]}):(0,b.jsx)("div",{className:"flex h-96 items-center justify-center",children:(0,b.jsxs)("div",{className:"max-w-md space-y-2 text-center",children:[(0,b.jsx)("h2",{className:"text-xl font-semibold",children:"Access restricted"}),(0,b.jsx)("p",{className:"text-muted-foreground text-sm",children:"Only adwait@thelostproject.in can manage invoices here."})]})})}a.s(["default",()=>A],22485)}];

//# sourceMappingURL=app_dashboard_invoices_page_tsx_10ef68e8._.js.map