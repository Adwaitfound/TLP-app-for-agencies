module.exports=[67453,a=>{"use strict";let b=(0,a.i(70106).default)("circle-check",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);a.s(["CheckCircle2",()=>b],67453)},46893,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(97895);let e=c.forwardRef(({className:a,...c},e)=>(0,b.jsx)("textarea",{className:(0,d.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",a),ref:e,...c}));e.displayName="Textarea",a.s(["Textarea",()=>e])},39239,a=>{"use strict";var b=a.i(5050),c=(0,b.createServerReference)("405c5bdfe2a43767b9832e1c2375adb8b49762ba71",b.callServer,void 0,b.findSourceMapURL,"assignCommentToEmployee");a.s(["assignCommentToEmployee",()=>c])},73570,a=>{"use strict";let b=(0,a.i(70106).default)("triangle-alert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);a.s(["AlertTriangle",()=>b],73570)},27289,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50944),e=a.i(3130),f=a.i(40695),g=a.i(46893),h=a.i(84505),i=a.i(67453),j=a.i(73570),k=a.i(69240),l=a.i(38422),m=a.i(5050),n=(0,m.createServerReference)("40a6382be664f50ea66fe39a98d1462f3f57004b5a",m.callServer,void 0,m.findSourceMapURL,"createProjectComment"),o=(0,m.createServerReference)("40bb02f9168fd9109458766923437b569718746a1e",m.callServer,void 0,m.findSourceMapURL,"listProjectComments"),p=(0,m.createServerReference)("4057388ae1c8d7ff911fc03a5fdfae99a64813f401",m.callServer,void 0,m.findSourceMapURL,"clientApproveProject"),q=a.i(39239);function r(){let{id:a}=(0,d.useParams)();(0,d.useRouter)();let{user:m}=(0,l.useAuth)(),[r,s]=(0,c.useState)(null),[t,u]=(0,c.useState)([]),[v,w]=(0,c.useState)([]),[x,y]=(0,c.useState)([]),[z,A]=(0,c.useState)([]),[B,C]=(0,c.useState)({}),[D,E]=(0,c.useState)(""),[F,G]=(0,c.useState)(null),[H,I]=(0,c.useState)([]),[J,K]=(0,c.useState)(!1),[L,M]=(0,c.useState)(null),[N,O]=(0,c.useState)(!1),[P,Q]=(0,c.useState)(!0);(0,c.useEffect)(()=>{!async function(){if(!m||!a)return;let b=(0,k.createClient)();try{let{data:c,error:d}=await b.from("projects").select("*, clients(company_name)").eq("id",a).single();if(d)throw d;s(c);let{data:e}=await b.from("project_files").select("*").eq("project_id",a).order("created_at",{ascending:!1});u(e||[]);let{data:f}=await b.from("invoices").select("*").eq("project_id",a).order("due_date",{ascending:!0});w(f||[]);let g=(f||[]).some(a=>"paid"!==a.status&&a.due_date&&new Date(a.due_date).getTime()<Date.now()-2592e6);O(g);let h=await o(a);h.success&&y(h.comments||[])}catch(a){console.error("Client project fetch failed:",a?.message)}finally{Q(!1)}}()},[a,m?.id]);let R=async()=>{M(null),K(!0);try{let b=D.trim();if(!b){M("Please add a comment before submitting"),K(!1);return}let c=await n({projectId:a,authorUserId:m.id,text:b});if(c.success){let b=await o(a);b.success?y(b.comments||[]):y(a=>[c.comment,...a]),E(""),I([])}c.success||M(c.error||"Could not submit comment")}catch(a){console.error("Submit comment failed:",a?.message),M(a?.message||"Unexpected error submitting comment")}finally{K(!1)}},S=async()=>{(await p({projectId:a})).success&&s(a=>({...a,client_approved:!0,client_approved_at:new Date().toISOString()}))},T=async(a,b)=>{if(!b)return;let c=await (0,q.assignCommentToEmployee)({commentId:a,userId:b});c.success&&y(d=>d.map(d=>d.id===a?{...d,assigned_user_id:b,assignee:c.comment?.assignee}:d))};return P||!r?(0,b.jsx)("div",{className:"flex items-center justify-center h-96",children:(0,b.jsx)("p",{className:"text-muted-foreground",children:"Loading…"})}):(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)(e.Card,{children:[(0,b.jsxs)(e.CardHeader,{children:[(0,b.jsx)(e.CardTitle,{children:r.name}),(0,b.jsx)(e.CardDescription,{children:r.clients?.company_name})]}),(0,b.jsxs)(e.CardContent,{children:[N&&(0,b.jsxs)("div",{className:"p-3 rounded-md bg-destructive/10 border border-destructive/20 mb-4 flex items-center gap-2",children:[(0,b.jsx)(j.AlertTriangle,{className:"h-4 w-4 text-destructive"}),(0,b.jsx)("p",{className:"text-sm text-destructive",children:"Access restricted: invoice overdue by 30+ days. Please settle dues to continue."})]}),(0,b.jsx)("div",{className:"space-y-3",children:0===t.length?(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"No files yet"}):t.map(a=>(0,b.jsxs)("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-medium text-sm",children:a.file_name}),(0,b.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Uploaded ",new Date(a.created_at).toLocaleString()]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(f.Button,{size:"sm",variant:"outline",disabled:N,onClick:()=>window.open(a.file_url,"_blank","noopener"),children:"View"}),(0,b.jsx)(f.Button,{size:"sm",variant:"ghost",disabled:N,onClick:()=>window.open(a.file_url,"_blank","noopener"),children:(0,b.jsx)(h.Download,{className:"h-4 w-4"})})]})]},a.id))})]})]}),(0,b.jsxs)(e.Card,{children:[(0,b.jsxs)(e.CardHeader,{children:[(0,b.jsx)(e.CardTitle,{children:"Comments"}),(0,b.jsx)(e.CardDescription,{children:"Leave change requests or feedback. Admins are notified."})]}),(0,b.jsxs)(e.CardContent,{className:"space-y-3",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(g.Textarea,{placeholder:"Type your comment",value:D,onChange:a=>E(a.target.value)}),(0,b.jsx)("div",{className:"flex gap-2",children:(0,b.jsx)(f.Button,{size:"sm",onClick:R,disabled:J||!D.trim(),children:J?"Submitting…":"Submit"})}),L&&(0,b.jsx)("p",{className:"text-xs text-destructive",children:L})]}),(0,b.jsx)("div",{className:"space-y-3",children:0===x.length?(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"No comments yet"}):x.map(a=>(0,b.jsxs)("div",{className:"p-3 border rounded-lg space-y-2",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between text-xs text-muted-foreground",children:[(0,b.jsx)("span",{children:a.author?.full_name||a.author?.email||"Unknown user"}),(0,b.jsx)("span",{children:new Date(a.created_at).toLocaleString()})]}),(0,b.jsx)("p",{className:"text-sm",children:a.comment_text}),a.assignee&&(0,b.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Assigned to ",a.assignee.full_name||a.assignee.email]}),(m?.role==="admin"||m?.role==="project_manager")&&z.length>0&&(0,b.jsxs)("div",{className:"flex items-center gap-2 pt-1",children:[(0,b.jsxs)("select",{className:"border rounded px-2 py-1 text-sm",value:B[a.id]??a.assigned_user_id??"",onChange:b=>C(c=>({...c,[a.id]:b.target.value})),children:[(0,b.jsx)("option",{value:"",children:"Select assignee"}),z.map(a=>(0,b.jsx)("option",{value:a.user_id,children:a.users?.full_name||a.users?.email||"Member"},a.user_id))]}),(0,b.jsx)(f.Button,{size:"sm",variant:"outline",onClick:()=>B[a.id]&&T(a.id,B[a.id]),children:"Assign"})]})]},a.id))})]})]}),(0,b.jsxs)(e.Card,{children:[(0,b.jsxs)(e.CardHeader,{children:[(0,b.jsx)(e.CardTitle,{children:"Approval"}),(0,b.jsx)(e.CardDescription,{children:"Approve the project when ready."})]}),(0,b.jsx)(e.CardContent,{children:r.client_approved?(0,b.jsxs)("div",{className:"flex items-center gap-2 text-green-600",children:[(0,b.jsx)(i.CheckCircle2,{className:"h-5 w-5"})," Approved on ",new Date(r.client_approved_at).toLocaleString()]}):(0,b.jsxs)(f.Button,{onClick:S,children:[(0,b.jsx)(i.CheckCircle2,{className:"h-4 w-4 mr-1"})," Mark Approved"]})})]})]})}a.s(["default",()=>r],27289)}];

//# sourceMappingURL=_18fa996e._.js.map